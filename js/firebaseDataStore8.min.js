(function(){window.firebaseDataStore8=function(n,t){var o=1.04,u,c,s,l=function(n,i){i&&!i.length&&i.toString&&(i=i.toString());window.jQuery(r).trigger("error",{error:String.format("Error accessing Firebase data-store {0}{1}",t,i&&i.length?String.format(": {0}",i):".")});n.reject(i)},f=function(n){return window.jQuery.Deferred(function(t){var i=window.setTimeout(function(){l(t)},r.timeout||2*window.jQuery.ajaxSetup().timeout);try{return n(function(n,r,u,f){window.clearTimeout(i);v(r,u,f);t.resolve(n)},function(n,r){window.clearTimeout(i);r?t.reject():l(t,n)})}catch(u){window.clearTimeout(i);l(t,u)}}).promise()},e,r,v=function(n,t,i){window.jQuery(r).trigger("message",{length:i,message:r.messages[n]||String.format("Firebase data-store: call to '{0}' successful ({1} received).",t,window.formatFileSize(i))})},y=function(n,t){var i=[],r;s&&s.length?(a||(a=new FirebaseTokenGenerator(s)),i.push(a.createToken({uid:window.jQuery.now()})),r="signInWithCustomToken"):h&&h.length&&_password&&_password.length?(i.push(h),i.push(_password),r="signInWithEmailAndPassword"):r="signInAnonymously";c[r].apply(c,i).then(function(){n(e=u.database())},function(n){t(n)})},a,i={authDomain:"{0}.firebaseapp.com".format(t),rootURL:"https://{0}.firebaseio.com/".format(t),storageBucket:"{0}.appspot.com".format(t)},h;return c=(u=firebase.initializeApp({apiKey:n,authDomain:i.authDomain,databaseURL:i.rootURL,storageBucket:i.storageBucket},window.guid())).auth(),r={addItem:function(n,t){return n?r.setItem(n,t):(t===undefined&&(t=null),t!==null?f(function(n,i){var r=e.push(t,function(t){t?i():n(r.key,"updated","push",-1)})}):r.removeItem(n))},getItem:function(n,t){if(t){var e,r=n.split("/");return r.length>1&&(n=r.pop(),e=r.join("/")),window.jQuery.when(this.list(e)).then(function(t){return t[n]})}return f(function(t,r){u.database().refFromURL(i.url+n+"/").once("value").then(function(n){if(n.exists()){var i=n.val()||{};t(i,"downloaded","value",window.JSON.stringify(i).length*o)}else r()},function(n){r(n)})})},getItems:function(n){return f(function(t){var r=[];window.jQuery.when.apply(u.database().ref(),window.jQuery.map(n,function(n,t){return window.jQuery.Deferred(function(f){u.database().refFromURL(i.url+n+"/").once("value").then(function(n){r[t]=n.val();f.resolve()},f.reject)}).promise()})).always(function(){t(r,"downloaded","value",window.JSON.stringify(r).length*o)})})},hasItem:function(n){return f(function(t,r){u.database().refFromURL(i.url+n+"/").once("value").then(function(n){if(n.exists()){var i=n.val()||{};t(i,"downloaded","value",window.JSON.stringify("value").length*o)}else r(undefined,!0)},function(n){r(n)})})},close:function(){e=null},isOpen:function(){return!!e},list:function(n){return f(function(t,i){var r=e;n&&n.length&&(r=r.child(n));r.once("value").then(function(n){if(n.exists){var r=n.val()||{};t(r,"downloaded","value",window.JSON.stringify(r).length*o)}else i(undefined,!0)},function(n){i(n)})})},messages:{changingPassword:"Changing password...",connected:"Connected",connecting:"Connecting...",downloaded:"Data downloaded",downloading:"Downloading latest data",invalidPassword:"Invalid password",invalidUsername:"Invalid user name",passwordChanged:"Password changed successfully",reset:"Data storage reset",updated:"Data storage updated"},open:function(n,t,r,u){var o=i.rootURL;return s=r,h=(n||"").toLowerCase(),_password=t,u&&(o+=u+"/"),f(function(n,t){v("connecting");y(function(){e=e.refFromURL(i.url=o);n(undefined,"downloading","open",-1)},t)})},removeItem:function(n){return r.setItem(n,null)},setItem:function(n,t){return t===undefined&&(t=null),f(function(r,f){u.database().refFromURL(i.url+n+"/").set(t).then(function(n){n?f():r(undefined,t?"updated":"reset","set",-1)})})}}};window.firebaseDataStore8.cleanup=function(n){var t,i,r,u;if(window.localStorage&&window.localStorage.removeItem){n=n||864e5;now=window.jQuery.now();i=[];for(r in window.localStorage)if(r.match(/firebase:authUser:*./i)&&(t=window.localStorage[r])&&t.length&&(t=window.jQuery.parseJSON(t),t.stsTokenManager&&t.stsTokenManager.expirationTime))try{now-new Date(t.stsTokenManager.expirationTime).getTime()>=n&&i.push(r)}catch(f){}for(u=0;u<i.length;u++)window.localStorage.removeItem(i[u])}};window.firebaseDataStore8.getKey=function(n){return n.replace(/(\.|\#|\$|\/|\[|\]|\@)/g,"_")}})()