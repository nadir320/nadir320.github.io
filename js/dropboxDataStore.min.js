(function(){window.dropboxDataStore=function(c,j){var d="vq_DLZMaMyAAAAAAAAAAPigwDvc6GjgiAUKFCge7V2kzxriKFjhmj9fOGIpbj-rT",i="D",g="I",b="U";var h,a,k,f;var e=function(q,p,n,l){p=window.jQuery.extend({},p);for(var m in p){var o=p[m];if(window.jQuery.isPlainObject(o)||window.jQuery.isArray(o)){p[m]=window.JSON.stringify(o)}}if(a){p.handle=a}if(!n&&f){p.rev=f}return window.jQuery.ajax({data:p,dataType:"json",headers:{authorization:"Bearer "+d},type:"POST",url:"https://api.dropbox.com/1/datastores/"+q}).then(function(r,t,s){return $.Deferred(function(u){if(r.conflict){return u.reject(s,t,r.conflict)}return u.resolve(r,t,s)}).promise()}).then(function(s,w,v){var r,u=k.messages[l],t=0;if(v.responseText){t=v.responseText.length}if(s.conflict){window.jQuery(k).trigger("error",{error:String.format("Error accessing Dropbox datastore: {0}.",s.conflict)})}else{window.jQuery(k).trigger("message",{length:t,message:u||String.format("Dropbox datastore: call to '{0}' successful ({1} received).",q,window.formatFileSize(t))})}if(s.handle){a=s.handle}if(s.rev){f=s.rev}return s},function(s,u,t){var r;if(s.responseJSON){r=s.responseJSON.error}window.jQuery(k).trigger("error",{error:String.format("Error accessing Dropbox datastore ({0}): {1}.",q,window.formatAjaxError(u,r||t))})})};return k={addItem:function(l,m){return e("put_delta",{changes:[[g,j,l,m]]},undefined,"updated")},close:function(){a=f=undefined},getItem:function(l){return window.jQuery.when(this.list()).then(function(n){for(var m in n.rows){var o=n.rows[m];if(o.tid===j&&o.rowid===l){return o.data}}})},isOpen:function(){return a!==undefined},list:function(){return e("get_snapshot",undefined,true,"downloaded")},messages:{downloaded:"Data downloaded",downloading:"Downloading latest data",reset:"Data storage reset",updated:"Data storage updated"},open:function(){return e("get_or_create_datastore",{dsid:c},undefined,"downloading")},removeItem:function(l){return e("put_delta",{changes:[[i,j,l]]},undefined,"reset")},setItem:function(m,o){var n={};for(var l in o){n[l]=["P",o[l]]}return e("put_delta",{changes:[[b,j,m,n]]},undefined,"updated")}}}})();