"use strict";(function(){var t={depth:6,height:40,padding:4,width:30},i=function(n){for(var i=[],r,t=0,u=n.length;t<u,r=n[t];t++)i.push(r);return i},r=document.getElementsByClassName("board")[0],f=document.getElementById("message"),e=document.getElementsByClassName("scaler")[0],u=document.getElementsByClassName("status")[0],n;(function(){var w,a,d,b,v,h,s,y,k,p,g,c,nt,o,l;(function(){typeof ShadowRoot=="undefined"&&f.classList.add("compatible")})(),function(){var s=2,a,n,i,h,r,v,u,f,c,l=0,y=0,e;if(!!window.location.search.match(/shadow/i))for(f=[],(c=window.location.search.match(/blur(\d+)/i))&&c.length>1&&(s=c[1]||s),n=0;n<t.depth;n++)f.push((n===t.depth-1?"black ":"")+(n+1)+"px "+(n+1)+"px "+s+"px");for(o=[],o.width=(t.width+2*t.padding)*15+t.depth,o.height=(t.height+2*t.padding)*8+t.depth,o.width+=4*t.padding,o.height+=4*t.padding,u=[".wrapper { max-width: "+o.width+"px; max-height:"+o.height+"px; }",".board { width: "+o.width+"px; height: "+o.height+"px; }",".face { padding: "+t.padding+"px; width: "+(t.width+2*t.padding)+"px; height: "+(t.height+2*t.padding)+"px; }"],f&&f.length?u.push(".tile { box-shadow: "+f.join(", ")+"; }"):u.push(".tile { width: "+(t.width+2*t.padding+t.depth)+"px; height: "+(t.height+2*t.padding+t.depth)+'px; background-image: url("images/shadow'+t.width+"x"+t.height+'.png"); background-position: bottom right; background-repeat: no-repeat; clip-path: polygon('+(t.width+2*t.padding)+"px 0, 100% "+t.depth+"px, 100% 100%, "+t.depth+"px 100%, 0 "+(t.height+2*t.padding)+"px, 0 0); }"),n=0;n<5;n++)for(a=n===3?8:n===4?7:9,i=0;i<a;i++){for(u.push(".t"+l+"{ background-position: -"+t.width*i+"px -"+t.height*n+"px }"),r=n>2&&i<4?1:4,(r!==1||v!==r)&&y++,h=0;h<r;h++)o.push({face:l,index:o.length,type:y});l++;v=r}e=document.createElement("style");e.setAttribute("type","text/css");e.innerText=u.join("\n");document.getElementsByTagName("head")[0].appendChild(e)}();w=function(){f.classList.contains("hidden")?n&&n.history&&n.history.length?c(document.getElementById("askNewMessage").value):y():(v(),y())};a=function(){u.classList.add("working2");var t=0,f;p&&p();n&&(i(document.querySelectorAll(".undo, .restart")).forEach(function(t){n.history.length?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}),i(document.getElementsByClassName("hint")).forEach(function(t){n.end?t.setAttribute("disabled","disabled"):t.removeAttribute("disabled")})),function(){var n=function(n){var t;if(!n.classList.contains("hidden")){switch(t=parseInt(n.dataset.index)){case 31:return!0;case 32:case 44:if(s(31)&&h(parseInt(n.dataset.x)+1,n.dataset.y,n.dataset.z))return!1;break;case 43:case 55:if(s(56)&&h(parseInt(n.dataset.x)-1,n.dataset.y,n.dataset.z))return!1;break;case 56:if(s(43)&&s(55)&&s(57))return!1;break;case 57:return!0;case 140:case 141:case 142:case 143:if(s(144))return!1;break;case 144:return!0;default:if(h(parseInt(n.dataset.x)+1,n.dataset.y,n.dataset.z)&&h(parseInt(n.dataset.x)-1,n.dataset.y,n.dataset.z)||h(n.dataset.x,n.dataset.y,parseInt(n.dataset.z)+1))return!1}return!0}return!1};i(r.getElementsByClassName("tile")).forEach(function(t){t.classList[n(t)?"add":"remove"]("free")})}(),function(){var i=[],r=[];n.end||(d().forEach(function(n,u){var h=!0,o,c,e=b(n,!0),s=e.length;if(s){for(e.push(n),f=!0,o=0;u<s,c=e[o];o++)if(r[c.dataset.index]){h=!1;break}h&&(e.forEach(function(n){r[n.dataset.index]=!0}),i.push(e),t+=s)}}),i.sort(function(n,t){var i=function(n){var t=parseInt(n.x),i=parseInt(n.y),r=parseInt(n.z);return r*1e6+i*1e3+t},r=i(n[0].dataset),u=i(t[0].dataset);return r<u?1:r>u?-1:0}));n.hints=i}();document.getElementById("tiles").innerText=r.querySelectorAll(".tile:not(.hidden)").length.toLocaleString();document.getElementById("freeTiles").innerText=t;r.getElementsByClassName("tile").length===r.getElementsByClassName("hidden").length?n.end||(c(document.getElementById("wonMessage").value),n.end=Date.now()):f||!n.history.length&&document.getElementsByClassName("tile").length<o.length||n.end||(c(document.getElementById("lostMessage").value),n.end=Date.now());u.classList.remove("working2")};d=function(){return i(r.getElementsByClassName("free"))};b=function(n,t){var u=n.dataset.type;return i(r.getElementsByClassName("tile")).filter(function(i){return i!==n&&i.dataset.type===u&&(!t||i.classList.contains("free"))})};v=function(){f.classList.add("hidden");document.getElementById("messageBackdrop").classList.add("hidden")};h=function(t,i,r){var u=n.filter(function(n){return parseInt(n.dataset.x)===parseInt(t)&&parseInt(n.dataset.y)===parseInt(i)&&parseInt(n.dataset.z)===parseInt(r)})[0];return u&&!u.classList.contains("hidden")};s=function(t){var i=n.filter(function(n){return parseInt(n.dataset.index)===t});if(i.length)return!i[0].classList.contains("hidden")};y=function(){var c,l,v=function(n){var t,i,r;return n<=12?(t=n,i=0,r=0):n<=20?(t=n-10,i=1,r=0):n<=30?(t=n-19,i=2,r=0):n===31?(t=0,i=3.5,r=0):n<=43?(t=n-31,i=3,r=0):n<=55?(t=n-43,i=4,r=0):n===56?(t=13,i=3.5,r=0):n===57?(t=14,i=3.5,r=0):n<=67?(t=n-56,i=5,r=0):n<=75?(t=n-65,i=6,r=0):n<=87?(t=n-75,i=7,r=0):n<=123?(t=4+n%88%6,i=1+Math.floor((n-88)/6),r=1):n<=139?(t=5+(n-124)%4,i=2+Math.floor((n-124)/4),r=2):n<=143?(t=6+(n-140)%2,i=3+Math.floor((n-140)/2),r=3):(t=6.5,i=3.5,r=4),{i:n+1,x:t,y:i,z:r}},f,y,p=o.length,b=function(){var n,t;if(s.length)while(!n){t=v(parseInt(s[Math.floor(Math.random()*s.length)].dataset.index));switch(Math.floor(Math.random()*4)){}n=!0}return Math.floor(Math.random()*e.length)},u,w,e=o.slice(0),h=!!window.location.search.match(/smart/i),i,s=[],k=0;for(h&&(p=2);r.childNodes.length;)r.removeChild(r.childNodes[0]);while(e.length&&e.length>o.length-p)f=h&&l?y:Math.floor(Math.random()*e.length),h&&f%2&&f--,y=f,l=!l,i=document.createElement("div"),i.classList.add("tile"),i.classList.add("fade"),u=v(w=h?b():s.length+1),i.style.left=u.x*(t.width+2*t.padding)-u.z*t.depth+2*t.padding+"px",i.style.top=u.y*(t.height+2*t.padding)-u.z*t.depth+2*t.padding+"px",i.style.zIndex=h?u.i:k++,i.dataset.index=w,i.dataset.type=e[f].type,i.dataset.x=u.x,i.dataset.y=u.y,i.dataset.z=u.z,i.addEventListener("click",function(){nt(this)}),c=document.createElement("div"),c.classList.add("face"),c.classList.add("t"+e[f].face),i.appendChild(c),r.appendChild(i),s.push(i),e.splice(f,1);n=s;n.history=[];a()};k=function(){var t;i(r.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")});typeof n.hint!="undefined"&&n.hint===n.hints.length-1&&delete n.hint;n.hints&&n.hints.length&&(t=typeof n.hint!="undefined"?n.hint+1:0,n.hints[t].forEach(function(n){n.classList.add("hint")}),n.hint=t)};p=function(){var t=0,i,r="";n&&n.start&&(t=(n.end||Date.now())-n.start);t=Math.floor(t/1e3);t>=3600&&(r=Math.floor(t/3600)+":",t%=3600);i=Math.floor(t/60);t%=60;r.length&&i<10&&(i="0"+i);r+=i+":";t<10&&(t="0"+t);document.getElementById("time").innerText=r+t};c=function(n){document.getElementById("messageText").innerText=n;document.getElementById("messageBackdrop").classList.remove("hidden");f.classList.remove("hidden")};l=function(t){var u;n&&n.history&&n.history.length&&(i(r.getElementsByClassName("clicked")).forEach(function(n){n.classList.remove("clicked")}),i(r.getElementsByClassName("matching")).forEach(function(n){n.classList.remove("matching")}),(u=n.history.pop()).forEach(function(n){n.classList.remove("hidden")}),i(r.getElementsByClassName("last")).forEach(function(n){n.classList.remove("last")}),u.length>1&&delete n.end,t&&n.history.length?l(t):a())};i(u.getElementsByClassName("newGame")).forEach(function(n){n.addEventListener("click",function(){w()})});i(u.getElementsByClassName("restart")).forEach(function(n){n.addEventListener("click",function(){c(document.getElementById("restartMessage").value)})});i(document.getElementsByClassName("undo")).forEach(function(n){n.addEventListener("click",function(){l()})});i(document.getElementsByClassName("hint")).forEach(function(n){n.addEventListener("click",function(){k()})});document.getElementById("messageBackdrop").addEventListener("click",function(){v()});i(f.getElementsByTagName("button")).forEach(function(n){n.addEventListener("click",function(){v()})});i(f.getElementsByClassName("newGame")).forEach(function(n){n.addEventListener("click",function(){y()})});i(f.getElementsByClassName("restart")).forEach(function(n){n.addEventListener("click",function(){l(!0)})});document.addEventListener("keydown",function(n){switch(n.which){case 27:v();break;case 68:c((new Date).toLocaleString());break;case 72:k();break;case 90:n.ctrlKey&&l();break;case 113:w();break;case 221:n.ctrlKey&&l(!0)}});window.addEventListener("resize",g=function(){var i=(window.innerWidth-(2*t.padding+t.depth))/o.width,u=(window.innerHeight-(2*t.padding+t.depth))/o.height,n=1;r.clientHeight&&((i<1||u<1)&&(n=Math.min(i,u)),e.style["-ms-transform"]=e.style["-moz-transform"]=e.style["-o-transform"]=e.style["-webkit-transform"]=e.style.transform=n<1?"scale("+n+")":"")});g();window.setInterval(p,100);nt=function(t){u.classList.add("working");u.classList.add("working1");var e=!0,f=i(r.getElementsByClassName("clicked")),s=i(r.getElementsByClassName("hint")),o,h=i(r.getElementsByClassName("matching"));(t.classList.contains("free")||n.end)&&(n.start||(n.start=Date.now()),h.forEach(function(n){n.classList.remove("matching")}),f.length===1&&f[0]!==t&&f[0].dataset.type===t.dataset.type?(f[0].classList.add("hidden"),t.classList.add("hidden"),f[0].classList.remove("clicked"),t.classList.remove("clicked"),n.history.push([f[0],t]),a()):n.end?(t.classList.add("hidden"),t.classList.remove("clicked"),n.history.push([t]),a()):(u.classList.add("working3"),f.forEach(function(n){n!==t&&n.classList.remove("clicked")}),t.classList.toggle("clicked"),t.classList.contains("clicked")&&(e=!t.classList.contains("hint"),(o=i(r.getElementsByClassName("hidden")).filter(function(n){return n.dataset.type===t.dataset.type}).length)&&t.classList.add("last"),b(t).forEach(function(n){n.classList.add("matching");o&&n.classList.add("last")})),u.classList.remove("working3")),e&&(u.classList.add("working4"),delete n.hint,s.forEach(function(n){n.classList.remove("hint")}),u.classList.remove("working4")));u.classList.remove("working1");u.classList.remove("working")};y()})()})()