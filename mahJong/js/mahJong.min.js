"use strict";(function(){var l="mahjong-map-name",k="map-style",a="mahjong-game-state",o="session",f=Array.prototype.slice.call(window.document.getElementsByTagName("script")).pop();(function(){Array.prototype.findIndex||(Array.prototype.findIndex=function(n){for(var i=this,t=0,r=this.length;t<r;t++)if(n.call(i,this[t],t))return t;return-1});Array.from||(Array.from=function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i});var n=f.getAttribute("storage");n&&n.length&&(o=n);o+="Storage"})();var v=function(n,t){Array.from(typeof n.length!="undefined"?n:[n]).forEach(function(n){n.addEventListener("click",t)})},t=function(n,t,i){v(n.querySelectorAll("."+t),i)},y=function(n,t,i){v(n.getElementsByTagName(t),i)},it=function(n){var t={};return Object.keys(n).forEach(function(i){t[i]=n[i]}),t},i=function(n){n.classList.add("hidden")},n=function(n){return!n.classList.contains("hidden")},r=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.max(t,i);return t},e=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.min(t,i);return t},h=function(n){return Object.keys(s()).findIndex(function(t){return t.toLowerCase()===n.toLowerCase()})>=0},s=function(n){var t=(n=n||window.location.href).indexOf("?"),i={};return t>=0&&(n=n.substr(t+1),t=n.indexOf("#"),t>=0&&(n=n.substr(0,t)),n.split("&").forEach(function(n){var t=n.indexOf("="),r=n.substr(0,t),u=n.substr(t+1);i[r||u]=r?window.decodeURIComponent(u):undefined})),i},d=function(n){var t=p(n);if(t&&t.length)try{return window.JSON.parse(t)}catch(i){}},p=function(n){try{var t=window[o];if(t&&t.getItem)return t.getItem(n)}catch(i){}},c=function(n,t){var i;t&&(i=document.getElementById(t))?i.innerText=n:(i=document.createElement("style"),i.setAttribute("type","text/css"),t&&i.setAttribute("id",t),i.innerText=n,document.querySelector("head").appendChild(i))},u=function(n){n.classList.remove("hidden")},g=function(n,t){n.completed?t():n.executing?n.callbacks.push(t):(n.callbacks=[t],n.executing=!0,n(function(){n.completed=!0;n.executing=!1;for(var t=0,i=n.callbacks.length;t<i;t++)n.callbacks[t]()}))},nt=function(n,t){typeof t!="undefined"&&(t=window.JSON.stringify(t));w(n,t)},w=function(n,t){try{var i=window[o];i&&(typeof t!="undefined"?i.setItem&&i.setItem(n,t):i.removeItem&&i.removeItem(n))}catch(r){}},tt=h("debug"),b;(function(){var t={get depth(){return 6},get padding(){return 8}},h,l=function(n,i){var o=document.createElement("canvas"),u,f=n+t.depth,e=i+t.depth,r;return o.setAttribute("width",f),o.setAttribute("height",e),r=o.getContext("2d"),r.fillStyle="",u=r.createLinearGradient(0,i,0,e),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(0,i),r.lineTo(t.depth,e),r.lineTo(f,e),r.lineTo(n,i),r.closePath(),r.fill(),u=r.createLinearGradient(n,0,f,0),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(n,0),r.lineTo(n,i),r.lineTo(f,e),r.lineTo(f,t.depth),r.closePath(),r.fill(),o.toDataURL()},y=function(n){g(p,n)},p=function(n){var i=new Image,r;i.onload=function(){var y=this.width/9,p=this.height/5;Object.defineProperty(t,"width",{get:function(){return y}});Object.defineProperty(t,"height",{get:function(){return p}});var f,w="polygon("+t.width+"px 0, 100% "+t.depth+"px, 100% 100%, "+t.depth+"px 100%, 0 "+t.height+"px, 0 0)",s,i,r,e,u,a,o=0,v=0;for(f=['.face { background-image: url("'+this.src+'") !important; width: '+t.width+"px; height: "+t.height+"px; }",".tile { width: "+(t.width+t.depth)+"px; height: "+(t.height+t.depth)+"px; background-image: url("+l(t.width,t.height)+"); background-repeat: no-repeat; "+["","ms","moz","o","webkit"].map(function(n){return(n?"-"+n+"-":"")+"clip-path: "+w}).join("; ")+"}"],h=[],i=0;i<5;i++)for(s=i===3?8:i===4?7:9,r=0;r<s;r++){for(f.push(".t"+o+"{ background-position: -"+t.width*r+"px -"+t.height*i+"px }"),u=i>2&&r<4?1:4,(u!==1||a!==u)&&v++,e=0;e<u;e++)h.push({background:{x:-(t.width*r),y:-(t.height*i)},face:o,index:h.length,type:v});o++;a=u}c(f.join("\n"));n()};r=f.getAttribute("palette")||s(f.getAttribute("src")).palette||s(window.location.href).palette;i.src=r},w=function(n,t){var i=[],r,f,u,e;for(t.forEach(function(t){i.push({x:t.x,y:n.y,w:t.w,h:n.h});i.push({x:n.x,y:t.y,w:n.w,h:t.h})}),r=0;f=i[r];r++)for(u=0;e=t[u];u++)if(!d(f,e))return!1;return!0},v=function(n,i){var p=e(n.map(function(n){return n.x})),d=r(n.map(function(n){return n.x+n.w})),w=e(n.map(function(n){return n.y})),g=r(n.map(function(n){return n.y+n.h})),b=e(n.map(function(n){return n.z})),nt=r(n.map(function(n){return n.z})),tt=r(n.map(function(n){return n.w})),it=r(n.map(function(n){return n.h})),f=d-p,s=g-w,a=n.length%4,y,u;return a?(function(){var i=n.slice(),t;i.sort(function(n,t){return t.z-n.z});a=i.slice(0,a);t=n.filter(function(n){return a.findIndex(function(t){return t===n})<0});t.splice(0,0,0,n.length);n.splice.apply(n,t)}(),v(n)):((p!==0||w!==0)&&n.forEach(function(n){n.x-=p;n.y-=w}),b!==0&&n.forEach(function(n){n.z-=b}),f*=t.width,f+=t.depth,f+=2*t.padding,n.width=f,s*=t.height,s+=t.depth,s+=2*t.padding,n.height=s,y=[".wrapper { max-width: "+f+"px; max-height:"+s+"px; }",".board { width: "+f+"px; height: "+s+"px; }"],function(){for(var n,u,r,i=1;i<=tt;i++)for(n=1;n<=it;n++)(i!==1||n!==1)&&(r=[],r.push('background-image: url("'+l(t.width*i,t.height*n)+'")'),r.push("width: "+(i*t.width+t.depth)+"px"),r.push("height: "+(n*t.height+t.depth)+"px"),r.push("clip-path: polygon("+i*t.width+"px 0, 100% "+t.depth+"px, 100% 100%, "+t.depth+"px 100%, 0 "+n*t.height+"px, 0 0)"),y.push(".tile.w-"+i+".h-"+n+" { "+r.join("; ")+" }"),u=[],u.push("background-size: "+t.width*9*i+"px "+t.height*5*n+"px"),u.push("width: "+i*t.width+"px"),u.push("height: "+n*t.height+"px"),y.push(".tile.w-"+i+".h-"+n+" .face { "+u.join("; ")+" }"))}(),c(y.join("\n"),k),i?function(){var a=0,s,f=n.findIndex(function(n){return typeof n.faceIndex!="undefined"})<0,e=f?"type":"faceIndex",i,t,v,r,c,l;do{if(t=h.slice(),c={},a++,f){while(n.length<t.length)i=Math.floor(Math.random()*t.length),i=t[i].type,v=c[i]?0:2,c[i]=!0,r=0,t=t.filter(function(n){return n.type!==i||r++<v});while(n.length>t.length)i=Math.floor(Math.random()*t.length),i=t[i].type,r=t.length,s=t.filter(function(n){return n.type===i}).slice(0,2).map(function(n){return{background:{x:n.background.x,y:n.background.y},face:n.face,index:r++,type:n.type}}),s.splice(0,0,0,0),t.splice.apply(t,s);l=t}else l=n;u={};l.forEach(function(n){typeof u[n[e]]!="undefined"?u[n[e]]++:u[n[e]]=1});n.forEach(function(n,i){n.index=i;var u=f?Math.floor(Math.random()*t.length):n.faceIndex,r=t[u];n.background=r.background;n.face=r.face;n.type=r.type;f&&t.splice(u,1)})}while(function(){var t,s,h,c,r,f,i;for(r=n.filter(function(n){return n.z}),t=0,h=r.length;t<h;t++)for(f=r[t],c=u[f[e]]/2,s=0,i=b;i<=nt;i++)if(i!==f.z&&n.findIndex(function(n){return n.z===i&&n.type===f.type&&o(r[t],n)})>=0&&++s>=c){if(a>Math.pow(n.length,2))throw new Error;return!0}}())}():(u={},h.forEach(function(n){typeof u[n.type]!="undefined"?u[n.type]++:u[n.type]=1})),u)},d=function(n,t){return t.x<=n.x&&t.x+t.w>=n.x+n.w&&t.y<=n.y&&t.y+t.h>=n.y+n.h},o=function(n,t){return n!==t&&n.y+n.h>t.y&&n.y<t.y+t.h&&n.x+n.w>t.x&&n.x<t.x+t.w};b=function(f,s,h,c){var ft=0,l,et=0,k,it=[],p=[],rt,d,ot,g=function(n,t){var i=n.dataset.type;return Array.from(f.getElementsByClassName("tile")).filter(function(r){return r!==n&&r.dataset.type===i&&(!t||r.classList.contains("free"))})},b=function(n){return{index:parseInt(n.dataset.index),x:parseFloat(n.dataset.x),y:parseFloat(n.dataset.y),z:parseFloat(n.dataset.z),w:parseFloat(n.dataset.w),h:parseFloat(n.dataset.h)}},ut=function(){var t;ft=0;et=0,function(){var t=Array.from(f.getElementsByClassName("tile")).map(function(t){var i=b(t);return i.index=parseInt(t.dataset.index),i.visible=n(t),i}),u=t.filter(function(n){var i=t.filter(function(t){return t.index!==n.index&&t.visible&&t.z===n.z&&t.y+t.h>n.y&&t.y<n.y+n.h});return i.length&&i.filter(function(t){return t.x+t.w===n.x}).length&&i.filter(function(t){return t.x===n.x+n.w}).length?!1:t.findIndex(function(t){return t.visible&&t.z===n.z+1&&o(t,n)})>=0?!1:!0}),i=Array.from(f.getElementsByClassName("tile"));i.forEach(function(n){n.classList[u.findIndex(function(t){return t.visible&&t.index===parseInt(n.dataset.index)})>=0?"add":"remove"]("free")});i.forEach(function(i){var f=n(i),r=f?b(i):undefined,u=g(i).filter(function(t){return n(t)});i.classList.remove("fatal");i.classList[l||u.length>1?"remove":"add"]("last");i.classList[u.length&&u.findIndex(function(n){return!n.classList.contains("free")})<0?"add":"remove"]("all"),function(){if(f){var i=!0,u,e,n=t.filter(function(n){return n.index!==r.index&&n.visible&&n.z===r.z&&n.x===r.x+r.w&&n.y+n.h>r.y&&n.y<r.y+r.h});n.length&&(n.sort(function(n,t){return t.y-n.y}),u=n[0].y,n.forEach(function(n,t){i&&t>0&&n.y>u&&(i=!1);u=n.y}),i&&(n=t.filter(function(n){return n.index!==r.index&&n.visible&&n.z===r.z&&n.y===r.y+r.h&&n.x+n.w>r.x&&n.x<r.x+r.w}),n.length&&(n.sort(function(n,t){return t.x-n.x}),u=n[0].x,n.forEach(function(n,t){i&&t>0&&n.x>u&&(i=!1)}),i&&(e=t.filter(function(n){return n.visible&&n.z===r.z+1&&o(n,r)}),e.length&&w(r,e)&&et++))))}}();!l&&i.classList.contains("sandwich")&&function(){var n,e,t,h,s;f&&(t=[],e=[],u.forEach(function(n){(o(r,b(n))?t:e).push(n)}),t.length>ot[parseInt(i.dataset.type)]/2?n=!0:e.length===0&&(n=!0),n||(h=parseInt(i.dataset.type),s=!t.length));i.classList[n?"add":"remove"]("fatal");i.classList[s?"add":"remove"]("uncovered");stop|=n}()});l||(function(){var t=function(t,i,r){return!!g(t).filter(function(t){if(n(t)){var u=b(t);return i.filter(function(n){var t=b(n);return o(t,u)&&(r?u.z<t.z:u.z>t.z)}).length}}).length};i.filter(function(t){return n(t)&&t.classList.contains("last")}).forEach(function(r){var u=b(r),f,e=g(r).filter(function(t){return n(t)}),s=[],h=[];i.forEach(function(n){if(n!==r&&n.classList.contains("last")){var t=b(n);o(u,t)&&(u.z>t.z?s:h).push(n)}});f=s.filter(function(n){return t(n,e)}).length+h.filter(function(n){return t(n,e,!0)}).length;f&&r.classList.add("fatal")})}(),function(){i.filter(function(n){return n.classList.contains("last")}).forEach(function(t){var u=b(t),c,l=g(t).filter(function(t){return n(t)}),o,s,h,f={};o=b(l[0]);o.y===u.y&&o.z===u.z&&(i.forEach(function(i){var r=b(i);n(i)&&r.x!==u.x&&r.x!==o.x&&r.y===u.y&&r.z===u.z&&i.dataset.type!==t.dataset.type&&g(i).filter(function(t){return n(t)}).length===1&&(f[i.dataset.type]=(f[i.dataset.type]||[]).concat([i]))}),f=Object.keys(f).map(function(n){return f[n]}).filter(function(n){return n.length>1}).map(function(n){return n.map(function(n){return b(n).x})}),f.length&&(h=e([u.x,o.x]),s=r([u.x,o.x]),c=f.filter(function(n){var t=e(n),i=r(n);return h<t&&s<i?!0:h>t&&s>i?!0:h<t&&s<t?!0:h>i&&s>i?!0:void 0}).length));c&&t.classList.add("fatal")})}())}(),function(){var n=[],i=[];l||(Array.from(f.getElementsByClassName("free")).forEach(function(r,u){var s=!0,e,h,f=g(r,!0),o=f.length;if(o){for(f.push(r),t=!0,e=0;u<o,h=f[e];e++)if(i[h.dataset.index]){s=!1;break}s&&(f.forEach(function(n){i[n.dataset.index]=!0}),n.push(f),ft+=Math.floor((o+1)/2))}}),n.sort(function(n,t){var i=function(n){var t=b(n[0]);return(n[0].classList.contains("last")?1:0)*1e12+n.length*1e9+t.z*1e6+t.y*1e3+t.x},r=i(n),u=i(t);return r<u?1:r>u?-1:0}));it=n}();f.dispatchEvent(new Event("game.changed"));f.getElementsByClassName("tile").length===f.getElementsByClassName("hidden").length?l||(l=Date.now(),f.dispatchEvent(new Event("game.won"))):(f.querySelector(".tile.fatal")||!t)&&(l||(l=Date.now(),f.dispatchEvent(new Event("game.lost"))));nt(a,l?undefined:{hintIndex:k,history:p.map(function(n){return n.map(function(n){return parseInt(n.dataset.index)})}),start:rt,tileSet:d,tilesPerType:ot})};return y(function(){try{Array.from(f.childNodes).forEach(function(n){n.parentElement.removeChild(n)});c&&(k=c.hintIndex,rt=c.start,s=c.tileSet);ot=v(d=s,!c),function(){var n=0;d.forEach(function(r){var u=document.createElement("div"),o,e;u.classList.add("tile");u.classList.add("fade");(r.w!==1||r.h!==1)&&(u.classList.add("w-"+r.w),u.classList.add("h-"+r.h));u.style.left=r.x*t.width-r.z*t.depth+t.padding+"px";u.style.top=r.y*t.height-r.z*t.depth+t.padding+"px";u.style.zIndex=n++;u.dataset.index=r.index;u.dataset.type=r.type;u.dataset.x=r.x;u.dataset.y=r.y;u.dataset.z=r.z;u.dataset.w=r.w;u.dataset.h=r.h;u.addEventListener("click",function(){(function(n){var r=!0,t=Array.from(f.getElementsByClassName("clicked")),u=Array.from(f.getElementsByClassName("matching"));(n.classList.contains("free")||l)&&(u.forEach(function(n){n.classList.remove("matching")}),t.length===1&&t[0]!==n&&t[0].dataset.type===n.dataset.type?(i(t[0]),i(n),t[0].classList.remove("clicked"),n.classList.remove("clicked"),p.push([t[0],n]),rt||(rt=Date.now()),ut()):l?(i(n),n.classList.remove("clicked"),p.push([n]),ut()):(t.forEach(function(t){t!==n&&t.classList.remove("clicked")}),n.classList.toggle("clicked"),n.classList.contains("clicked")&&(r=!n.classList.contains("hint"),g(n).forEach(function(n){n.classList.add("matching")}))),r&&(k=undefined,Array.from(f.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")})))})(this)});o=document.createElement("div");o.classList.add("face");o.classList.add("t"+r.face);(r.w!==1||r.h!==1)&&(o.style.backgroundPosition=r.background.x*r.w+"px "+r.background.y*r.h+"px");tt&&(e=document.createElement("span"),e.style.color="red",e.style.fontSize="7pt",e.style.fontWeight="bold",e.style.pointerEvents="none",e.innerText=[r.index,r.x,r.y,r.z].join(", "),o.appendChild(e));u.appendChild(o);f.appendChild(u);r.tile=u}),function(){d.forEach(function(n){g(n.tile).filter(function(t){return o(b(t),n)}).forEach(function(n){n.classList.add("sandwich")})})}();ut()}();c&&c.history&&c.history.length&&(p=c.history.map(function(n){return n.map(function(n){var t=f.querySelector("[data-index='"+n+"']");return i(t),t})}),ut());h&&h()}catch(n){f.dispatchEvent(new Event("game.wrong"))}}),{get availableMoves(){return ft},board:{get width(){return d?d.width:0},get height(){return d?d.height:0}},get constants(){return t},get end(){return l},get hiddenTiles(){return et},get hints(){return it},get history(){return p},nextHint:function(){var n;Array.from(f.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")});typeof k!="undefined"&&k===it.length-1&&(k=undefined);it.length&&(n=typeof k!="undefined"?k+1:0,it[n].forEach(function(n){n.classList.add("hint")}),k=n)},get start(){return rt},undo:function(n){p.length&&(Array.from(f.querySelectorAll(".clicked, .matching")).forEach(function(n){n.classList.remove("clicked");n.classList.remove("matching")}),l&&(n||p[p.length-1].length>1)&&(l=undefined),(n?p:[p.pop()]).forEach(function(n){n.forEach(function(n){u(n)})}),n&&p.length&&p.splice(0,p.length),k=undefined,ut())},get visibleTiles(){return f.querySelectorAll(".tile:not(.hidden)").length}}}})(),function(){var pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",wt=decodeURIComponent("%E3%85%A4"),o=document.querySelector(".board"),k=document.getElementById("menu"),v=document.getElementById("message"),tt=document.querySelector(".scaler"),g=document.querySelector(".status");(function(){typeof ShadowRoot=="undefined"&&(v.classList.add("compatible"),k.classList.add("compatible"));h("animate")&&document.querySelector("body").classList.add("animate")})();var ft,et,r,lt,e,ht,at,bt=function(){u(k);u(messageBackdrop)},vt=function(){n(v)?(rt(),ut()):r&&r.history.length?nt(document.getElementById("askNewMessage").value):ut()},kt=function(){nt(document.getElementById("restartMessage").value)},ot=function(n){if(Array.from(document.getElementsByClassName("boss")).forEach(function(t){(n?u:i)(t)}),ft!==n){var t=document.querySelector("[rel='shortcut icon']");(ft=n)?(at=document.title,document.title=wt,t&&(lt=t.getAttribute("href"),t.setAttribute("href",pt))):(document.title=at,t&&t.setAttribute("href",lt))}},dt=function(){e=document.getElementById("mapList").querySelector("input[type=radio]:checked").value;w(l,e);ut()},it=function(){ct&&ct();Array.from(document.querySelectorAll(".undo, .restart")).forEach(function(n){r&&r.history.length?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")});Array.from(document.getElementsByClassName("hint")).forEach(function(n){!r||r.end?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled")});document.getElementById("tiles").innerText=r?r.visibleTiles.toLocaleString():"";document.getElementById("availableMoves").innerText=r?r.availableMoves.toLocaleString():"";document.getElementById("hiddenTiles").innerText=r?r.hiddenTiles.toLocaleString():""},rt=function(){i(v);i(k);i(document.getElementById("messageBackdrop"))},ut=function(n){e&&(r&&(r=undefined,o.removeEventListener("game.changed",it)),r=new b(o,new window.maps[e],function(){o.addEventListener("game.changed",it);setTimeout(function(){ht();it()})},n))},yt=function(){r.nextHint()},ct=function(){var n=0,t,i="";r&&r.start&&(n=(r.end||Date.now())-r.start);n=Math.floor(n/1e3);n>=3600&&(i=Math.floor(n/3600)+":",n%=3600);t=Math.floor(n/60);n%=60;i.length&&t<10&&(t="0"+t);i+=t+":";n<10&&(n="0"+n);document.getElementById("time").innerText=i+n},gt=function(){st(!0)},nt=function(n){ft||(document.getElementById("messageText").innerText=n,u(document.getElementById("messageBackdrop")),u(v))},st=function(n){r.undo(n);it()};(function(){o.addEventListener("game.changed",it);o.addEventListener("game.won",function(){nt(document.getElementById("wonMessage").value)});o.addEventListener("game.lost",function(){nt(document.getElementById("lostMessage").value)});o.addEventListener("game.wrong",function(){nt(document.getElementById("wrongGameMessage").value)});t(g,"newGame",vt);t(g,"undo",function(){st()});t(g,"hint",yt);t(g,"restart",kt);t(g,"map",bt);document.getElementById("messageBackdrop").addEventListener("click",function(){rt()});y(v,"button",rt);t(v,"newGame",function(){ut()});t(v,"restart",gt);y(k,"button",rt);t(k,"accept",dt);et=h("boss")||!!parseInt(f.getAttribute("boss"));var n=s()["boss-color"]||f.getAttribute("boss-color");typeof n!="undefined"&&c(".boss { background-color: "+n+" !important; }"),function(){var t,i,n;(t=window.maps)&&(n=Object.keys(t)).length&&((e=p(l))&&n.indexOf(e)<0&&(e=undefined),e=e||n[0]);n&&n.length>1?(i=document.getElementById("mapList"),Array.from(i.childNodes).forEach(function(n){n.parentElement.removeChild(n)}),n.forEach(function(n){var f=document.createElement("li"),u=document.createElement("label"),r=document.createElement("input"),o=document.createTextNode(t[n].displayName);u.addEventListener("dblclick",function(n){n.which===1&&k.querySelector(".accept").click()});r.setAttribute("name","map");r.setAttribute("type","radio");r.value=n;n===e&&r.setAttribute("checked","checked");u.appendChild(r);u.appendChild(o);f.appendChild(u);i.appendChild(f)})):g.querySelector(".map").style.display="none"}()})();document.addEventListener("keydown",function(t){switch(t.which){case 27:n(v)?rt():et&&ot(!0);break;case 66:ot(!ft);break;case 68:nt((new Date).toLocaleString());break;case 72:yt();break;case 90:t.ctrlKey&&st();break;case 113:vt();break;case 221:t.ctrlKey&&st(!0)}});(ht=function(){if(r){var t=(window.innerWidth-2*r.constants.padding)/r.board.width,i=(window.innerHeight-2*r.constants.padding)/r.board.height,n=1;o.clientHeight&&((t<1||i<1)&&(n=Math.min(t,i)),tt.style["-ms-transform"]=tt.style["-moz-transform"]=tt.style["-o-transform"]=tt.style["-webkit-transform"]=tt.style.transform=n<1?"scale("+n+")":"")}})();window.addEventListener("resize",ht);window.addEventListener("blur",function(){et&&ot(!0)});document.addEventListener("visibilitychange",function(){document.hidden&&et&&ot(!0)},!1);window.setInterval(ct,100);document.addEventListener("DOMContentLoaded",function(){ut(d(a))})}()})()