"use strict";(function(){var l="mahjong-map-name",k="map-style",a="mahjong-game-state",o="session",r=Array.prototype.slice.call(window.document.getElementsByTagName("script")).pop();(function(){Array.prototype.findIndex||(Array.prototype.findIndex=function(n){for(var i=this,t=0,r=this.length;t<r;t++)if(n.call(i,this[t],t))return t;return-1});Array.from||(Array.from=function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i});var n=r.getAttribute("storage");n&&n.length&&(o=n);o+="Storage"})();var v=function(n,t){Array.from(typeof n.length!="undefined"?n:[n]).forEach(function(n){n.addEventListener("click",t)})},t=function(n,t,i){v(n.querySelectorAll("."+t),i)},y=function(n,t,i){v(n.getElementsByTagName(t),i)},it=function(n){var t={};return Object.keys(n).forEach(function(i){t[i]=n[i]}),t},i=function(n){n.classList.add("hidden")},n=function(n){return!n.classList.contains("hidden")},f=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.max(t,i);return t},s=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.min(t,i);return t},h=function(n){return Object.keys(e()).findIndex(function(t){return t.toLowerCase()===n.toLowerCase()})>=0},e=function(n){var t=(n=n||window.location.href).indexOf("?"),i={};return t>=0&&(n=n.substr(t+1),t=n.indexOf("#"),t>=0&&(n=n.substr(0,t)),n.split("&").forEach(function(n){var t=n.indexOf("="),r=n.substr(0,t),u=n.substr(t+1);i[r||u]=r?window.decodeURIComponent(u):undefined})),i},d=function(n){var t=p(n);if(t&&t.length)try{return window.JSON.parse(t)}catch(i){}},p=function(n){try{var t=window[o];if(t&&t.getItem)return t.getItem(n)}catch(i){}},c=function(n,t){var i;t&&(i=document.getElementById(t))?i.innerText=n:(i=document.createElement("style"),i.setAttribute("type","text/css"),t&&i.setAttribute("id",t),i.innerText=n,document.querySelector("head").appendChild(i))},u=function(n){n.classList.remove("hidden")},g=function(n,t){n.completed?t():n.executing?n.callbacks.push(t):(n.callbacks=[t],n.executing=!0,n(function(){n.completed=!0;n.executing=!1;for(var t=0,i=n.callbacks.length;t<i;t++)n.callbacks[t]()}))},nt=function(n,t){typeof t!="undefined"&&(t=window.JSON.stringify(t));w(n,t)},w=function(n,t){try{var i=window[o];i&&(typeof t!="undefined"?i.setItem&&i.setItem(n,t):i.removeItem&&i.removeItem(n))}catch(r){}},tt=h("debug"),b;(function(){var t={get depth(){return 6},get padding(){return 8}},h,l=function(n,i){var o=document.createElement("canvas"),u,f=n+t.depth,e=i+t.depth,r;return o.setAttribute("width",f),o.setAttribute("height",e),r=o.getContext("2d"),r.fillStyle="",u=r.createLinearGradient(0,i,0,e),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(0,i),r.lineTo(t.depth,e),r.lineTo(f,e),r.lineTo(n,i),r.closePath(),r.fill(),u=r.createLinearGradient(n,0,f,0),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(n,0),r.lineTo(n,i),r.lineTo(f,e),r.lineTo(f,t.depth),r.closePath(),r.fill(),o.toDataURL()},y=function(n){g(p,n)},p=function(n){var i=new Image,u;i.onload=function(){var y=this.width/9,p=this.height/5;Object.defineProperty(t,"width",{get:function(){return y}});Object.defineProperty(t,"height",{get:function(){return p}});var f,w="polygon("+t.width+"px 0, 100% "+t.depth+"px, 100% 100%, "+t.depth+"px 100%, 0 "+t.height+"px, 0 0)",s,i,r,e,u,a,o=0,v=0;for(f=['.face { background-image: url("'+this.src+'") !important; width: '+t.width+"px; height: "+t.height+"px; }",".tile { width: "+(t.width+t.depth)+"px; height: "+(t.height+t.depth)+"px; background-image: url("+l(t.width,t.height)+"); background-repeat: no-repeat; "+["","ms","moz","o","webkit"].map(function(n){return(n?"-"+n+"-":"")+"clip-path: "+w}).join("; ")+"}"],h=[],i=0;i<5;i++)for(s=i===3?8:i===4?7:9,r=0;r<s;r++){for(f.push(".t"+o+"{ background-position: -"+t.width*r+"px -"+t.height*i+"px }"),u=i>2&&r<4?1:4,(u!==1||a!==u)&&v++,e=0;e<u;e++)h.push({background:{x:-(t.width*r),y:-(t.height*i)},face:o,index:h.length,type:v});o++;a=u}c(f.join("\n"));n()};u=r.getAttribute("palette")||e(r.getAttribute("src")).palette||e(window.location.href).palette;i.src=u},w=function(n,t){var i=[],r,f,u,e;for(t.forEach(function(t){i.push({x:t.x,y:n.y,w:t.w,h:n.h});i.push({x:n.x,y:t.y,w:n.w,h:t.h})}),r=0;f=i[r];r++)for(u=0;e=t[u];u++)if(!d(f,e))return!1;return!0},v=function(n,i){var p=s(n.map(function(n){return n.x})),d=f(n.map(function(n){return n.x+n.w})),w=s(n.map(function(n){return n.y})),g=f(n.map(function(n){return n.y+n.h})),b=s(n.map(function(n){return n.z})),nt=f(n.map(function(n){return n.z})),tt=f(n.map(function(n){return n.w})),it=f(n.map(function(n){return n.h})),u=d-p,e=g-w,a=n.length%4,y,r;return a?(function(){var i=n.slice(),t;i.sort(function(n,t){return t.z-n.z});a=i.slice(0,a);t=n.filter(function(n){return a.findIndex(function(t){return t===n})<0});t.splice(0,0,0,n.length);n.splice.apply(n,t)}(),v(n)):((p!==0||w!==0)&&n.forEach(function(n){n.x-=p;n.y-=w}),b!==0&&n.forEach(function(n){n.z-=b}),u*=t.width,u+=t.depth,u+=2*t.padding,n.width=u,e*=t.height,e+=t.depth,e+=2*t.padding,n.height=e,y=[".wrapper { max-width: "+u+"px; max-height:"+e+"px; }",".board { width: "+u+"px; height: "+e+"px; }"],function(){for(var n,u,r,i=1;i<=tt;i++)for(n=1;n<=it;n++)(i!==1||n!==1)&&(r=[],r.push('background-image: url("'+l(t.width*i,t.height*n)+'")'),r.push("width: "+(i*t.width+t.depth)+"px"),r.push("height: "+(n*t.height+t.depth)+"px"),r.push("clip-path: polygon("+i*t.width+"px 0, 100% "+t.depth+"px, 100% 100%, "+t.depth+"px 100%, 0 "+n*t.height+"px, 0 0)"),y.push(".tile.w-"+i+".h-"+n+" { "+r.join("; ")+" }"),u=[],u.push("background-size: "+t.width*9*i+"px "+t.height*5*n+"px"),u.push("width: "+i*t.width+"px"),u.push("height: "+n*t.height+"px"),y.push(".tile.w-"+i+".h-"+n+" .face { "+u.join("; ")+" }"))}(),c(y.join("\n"),k),i?function(){var a=0,s,f=n.findIndex(function(n){return typeof n.faceIndex!="undefined"})<0,e=f?"type":"faceIndex",i,t,v,u,c,l;do{if(t=h.slice(),c={},a++,f){while(n.length<t.length)i=Math.floor(Math.random()*t.length),i=t[i].type,v=c[i]?0:2,c[i]=!0,u=0,t=t.filter(function(n){return n.type!==i||u++<v});while(n.length>t.length)i=Math.floor(Math.random()*t.length),i=t[i].type,u=t.length,s=t.filter(function(n){return n.type===i}).slice(0,2).map(function(n){return{background:{x:n.background.x,y:n.background.y},face:n.face,index:u++,type:n.type}}),s.splice(0,0,0,0),t.splice.apply(t,s);l=t}else l=n;r={};l.forEach(function(n){typeof r[n[e]]!="undefined"?r[n[e]]++:r[n[e]]=1});n.forEach(function(n,i){n.index=i;var u=f?Math.floor(Math.random()*t.length):n.faceIndex,r=t[u];n.background=r.background;n.face=r.face;n.type=r.type;f&&t.splice(u,1)})}while(function(){var t,s,h,c,u,f,i;for(u=n.filter(function(n){return n.z}),t=0,h=u.length;t<h;t++)for(f=u[t],c=r[f[e]]/2,s=0,i=b;i<=nt;i++)if(i!==f.z&&n.findIndex(function(n){return n.z===i&&n.type===f.type&&o(u[t],n)})>=0&&++s>=c){if(a>Math.pow(n.length,2))throw new Error;return!0}}())}():(r={},h.forEach(function(n){typeof r[n.type]!="undefined"?r[n.type]++:r[n.type]=1})),r)},d=function(n,t){return t.x<=n.x&&t.x+t.w>=n.x+n.w&&t.y<=n.y&&t.y+t.h>=n.y+n.h},o=function(n,t){return n!==t&&n.y+n.h>t.y&&n.y<t.y+t.h&&n.x+n.w>t.x&&n.x<t.x+t.w};b=function(r,f,e,s){var rt=0,h,ut=0,p,d=[],c=[],g,b,ft,k=function(n,t){var i=n.dataset.type;return Array.from(r.getElementsByClassName("tile")).filter(function(r){return r!==n&&r.dataset.type===i&&(!t||r.classList.contains("free"))})},l=function(n){return{index:parseInt(n.dataset.index),x:parseFloat(n.dataset.x),y:parseFloat(n.dataset.y),z:parseFloat(n.dataset.z),w:parseFloat(n.dataset.w),h:parseFloat(n.dataset.h)}},it=function(){var t;rt=0;ut=0,function(){var t=Array.from(r.getElementsByClassName("tile")).map(function(t){var i=l(t);return i.index=parseInt(t.dataset.index),i.visible=n(t),i}),u=t.filter(function(n){var i=t.filter(function(t){return t.index!==n.index&&t.visible&&t.z===n.z&&t.y+t.h>n.y&&t.y<n.y+n.h});return i.length&&i.filter(function(t){return t.x+t.w===n.x}).length&&i.filter(function(t){return t.x===n.x+n.w}).length?!1:t.findIndex(function(t){return t.visible&&t.z===n.z+1&&o(t,n)})>=0?!1:!0}),i=Array.from(r.getElementsByClassName("tile"));i.forEach(function(n){n.classList[u.findIndex(function(t){return t.visible&&t.index===parseInt(n.dataset.index)})>=0?"add":"remove"]("free")});i.forEach(function(i){var f=n(i),r=f?l(i):undefined,u=k(i).filter(function(t){return n(t)});h||(i.classList.remove("fatal"),delete i.dataset.fatalType);i.classList[h||u.length>1?"remove":"add"]("last");i.classList[i.classList.contains("free")&&u.length&&u.findIndex(function(n){return!n.classList.contains("free")})<0?"add":"remove"]("all"),function(){if(f){var i=!0,u,e,n=t.filter(function(n){return n.index!==r.index&&n.visible&&n.z===r.z&&n.x===r.x+r.w&&n.y+n.h>r.y&&n.y<r.y+r.h});n.length&&(n.sort(function(n,t){return t.y-n.y}),u=n[0].y,n.forEach(function(n,t){i&&t>0&&n.y>u&&(i=!1);u=n.y}),i&&(n=t.filter(function(n){return n.index!==r.index&&n.visible&&n.z===r.z&&n.y===r.y+r.h&&n.x+n.w>r.x&&n.x<r.x+r.w}),n.length&&(n.sort(function(n,t){return t.x-n.x}),u=n[0].x,n.forEach(function(n,t){i&&t>0&&n.x>u&&(i=!1)}),i&&(e=t.filter(function(n){return n.visible&&n.z===r.z+1&&o(n,r)}),e.length&&w(r,e)&&ut++))))}}();!h&&i.classList.contains("sandwich")&&function(){var n,e,t,h,s;f&&(t=[],e=[],u.forEach(function(n){(o(r,l(n))?t:e).push(n)}),t.length>ft[parseInt(i.dataset.type)]/2?n=!0:e.length===0&&(n=!0),n||(h=parseInt(i.dataset.type),s=!t.length));i.classList[n?"add":"remove"]("fatal");i.classList[s?"add":"remove"]("uncovered");n&&(i.dataset.fatalType=1)}()});h||(function(){var t=function(t,i,r){return!!k(t).filter(function(t){if(n(t)){var u=l(t);return i.filter(function(n){var t=l(n);return o(t,u)&&(r?u.z<t.z:u.z>t.z)}).length}}).length};i.filter(function(t){return n(t)&&t.classList.contains("last")&&!t.classList.contains("fatal")}).forEach(function(r){var u=l(r),f,e=k(r).filter(function(t){return n(t)}),s=[],h=[];i.forEach(function(n){if(n!==r&&n.classList.contains("last")){var t=l(n);o(u,t)&&(u.z>t.z?s:h).push(n)}});f=s.filter(function(n){return t(n,e)}).length+h.filter(function(n){return t(n,e,!0)}).length;f&&(r.classList.add("fatal"),r.dataset.fatalType=2)})}(),function(){var t=function(n,t){return[n,t].join()},r=i.filter(function(t){return n(t)&&t.classList.contains("last")&&!t.classList.contains("fatal")}).map(function(t){var i=k(t).filter(function(t){return n(t)})[0],r=l(t),u=l(i),f;return u.x<r.x&&(f=t,t=i,i=f,f=r,r=u,u=f),{box:r,otherBox:u,otherTile:i,tile:t}}).filter(function(n){return n.box.y===n.otherBox.y}).reduce(function(n,i){var r=t(i.tile.dataset.index,i.otherTile.dataset.index),u=t(i.otherTile.dataset.index,i.tile.dataset.index);return typeof n[r]=="undefined"&&typeof n[u]=="undefined"&&(n[r]=i),n},{}),u=Object.keys(r).map(function(n){return r[n]}).reduce(function(n,t){var i=t.box.y;return typeof n[i]=="undefined"&&(n[i]=[]),n[i].push(t),n},[]).filter(function(n){return n.length>1});u.forEach(function(n){n.map(function(t,i){var r=n[(i+1)%n.length],u;return r.box.x<t.box.x&&(u=t,t=r,r=u),{firstPair:{firstTile:{x:t.box.x,z:t.box.z},secondTile:{x:t.otherBox.x,z:t.otherBox.z}},secondPair:{firstTile:{x:r.box.x,z:r.box.z},secondTile:{x:r.otherBox.x,z:r.otherBox.z}},tiles:[t.tile,t.otherTile,r.tile,r.otherTile]}}).forEach(function(n){var f,e;if(n.firstPair.firstTile.z===n.firstPair.secondTile.z&&n.firstPair.secondTile.z===n.secondPair.firstTile.z&&n.secondPair.firstTile.z===n.secondPair.secondTile.z){var t=Math.min(n.firstPair.firstTile.x,n.firstPair.secondTile.x),i=Math.max(n.firstPair.firstTile.x,n.firstPair.secondTile.x),r=Math.min(n.secondPair.firstTile.x,n.secondPair.secondTile.x),u=Math.max(n.secondPair.firstTile.x,n.secondPair.secondTile.x);(f=function(){return t<r&&i<u?!0:t>r&&i>u?!0:t<r&&i<r?!0:t>u&&i>u?!0:void 0}())&&(e=3)}else(function(){(f=[function(n,t){if(n.firstTile.x<t.firstTile.x&&n.firstTile.z>=t.firstTile.z&&n.secondTile.x>t.firstTile.x&&n.secondTile.z<=t.firstTile.z&&n.secondTile.x<=t.secondTile.x&&n.secondTile.z<t.secondTile.z)return!0},function(n,t){if(n.firstTile.x>=t.firstTile.x&&n.firstTile.z<t.firstTile.z&&t.secondTile.x>n.firstTile.x&&t.secondTile.z<=n.firstTile.z&&t.secondTile.x<n.secondTile.x&&t.secondTile.z>=n.secondTile.z)return!0},function(n,t){if(n.firstTile.x>=t.firstTile.x&&n.firstTile.z<t.firstTile.z&&t.secondTile.x>t.firstTile.x&&t.secondTile.z<=t.firstTile.z&&t.secondTile.x<n.secondTile.x&&t.secondTile.z<=n.secondTile.z)return!0},function(n,t){if(n.firstTile.x<t.firstTile.x&&n.firstTile.z>=t.firstTile.z&&t.firstTile.x<=n.secondTile.x&&t.firstTile.z>n.secondTile.z&&t.secondTile.x>=n.secondTile.x&&t.secondTile.z>n.secondTile.z)return!0}].findIndex(function(t){return t(n.firstPair,n.secondPair)||t(n.secondPair,n.firstPair)})>=0)&&(e=4)})();f&&n.tiles.forEach(function(n){n.classList.add("fatal");n.dataset.fatalType=e})})})}())}();Array.from(r.querySelectorAll(".tile.fatal")).forEach(function(n){n.classList.remove("last-sandwich");n.classList.remove("cross-sandwich");n.classList.remove("flat-crossed");n.classList.remove("cross-fatal");switch(parseInt(n.dataset.fatalType)){case 1:n.classList.add("last-sandwich");break;case 2:n.classList.add("cross-sandwich");break;case 3:n.classList.add("flat-crossed");break;case 4:n.classList.add("cross-fatal")}}),function(){var n=[],i=[];h||(Array.from(r.getElementsByClassName("free")).forEach(function(r,u){var s=!0,e,h,f=k(r,!0),o=f.length;if(o){for(f.push(r),t=!0,e=0;u<o,h=f[e];e++)if(i[h.dataset.index]){s=!1;break}s&&(f.forEach(function(n){i[n.dataset.index]=!0}),n.push(f),rt+=Math.floor((o+1)/2))}}),n.sort(function(n,t){var i=function(n){var t=l(n[0]);return(n[0].classList.contains("last")?1:0)*1e12+n.length*1e9+t.z*1e6+t.y*1e3+t.x},r=i(n),u=i(t);return r<u?1:r>u?-1:0}));d=n}();r.dispatchEvent(new Event("game.changed")),function(){var n;r.getElementsByClassName("tile").length===r.getElementsByClassName("hidden").length?h||(h=Date.now(),r.dispatchEvent(new Event("game.won"))):((n=r.querySelectorAll(".tile.fatal")).length||!t)&&(h||(h=Date.now(),r.dispatchEvent(new CustomEvent("game.lost",{detail:{fatal:!!n.length}}))))}();nt(a,h?undefined:{hintIndex:p,history:c.map(function(n){return n.map(function(n){return parseInt(n.dataset.index)})}),start:g,tileSet:b,tilesPerType:ft})};return y(function(){try{Array.from(r.childNodes).forEach(function(n){n.parentElement.removeChild(n)});s&&(p=s.hintIndex,g=s.start,f=s.tileSet);ft=v(b=f,!s),function(){var n=0;b.forEach(function(u){var f=document.createElement("div"),o,e;f.classList.add("tile");f.classList.add("fade");(u.w!==1||u.h!==1)&&(f.classList.add("w-"+u.w),f.classList.add("h-"+u.h));f.style.left=u.x*t.width-u.z*t.depth+t.padding+"px";f.style.top=u.y*t.height-u.z*t.depth+t.padding+"px";f.style.zIndex=n++;f.dataset.index=u.index;f.dataset.type=u.type;f.dataset.x=u.x;f.dataset.y=u.y;f.dataset.z=u.z;f.dataset.w=u.w;f.dataset.h=u.h;f.addEventListener("click",function(){(function(n){var u=!0,t=Array.from(r.getElementsByClassName("clicked")),f=Array.from(r.getElementsByClassName("matching"));(n.classList.contains("free")||h)&&(f.forEach(function(n){n.classList.remove("matching")}),t.length===1&&t[0]!==n&&t[0].dataset.type===n.dataset.type?(i(t[0]),i(n),t[0].classList.remove("clicked"),n.classList.remove("clicked"),c.push([t[0],n]),g||(g=Date.now()),it()):h?(i(n),n.classList.remove("clicked"),c.push([n]),it()):(t.forEach(function(t){t!==n&&t.classList.remove("clicked")}),n.classList.toggle("clicked"),n.classList.contains("clicked")&&(u=!n.classList.contains("hint"),k(n).forEach(function(n){n.classList.add("matching")}))),u&&(p=undefined,Array.from(r.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")})))})(this)});o=document.createElement("div");o.classList.add("face");o.classList.add("t"+u.face);(u.w!==1||u.h!==1)&&(o.style.backgroundPosition=u.background.x*u.w+"px "+u.background.y*u.h+"px");tt&&(e=document.createElement("span"),e.style.color="red",e.style.fontSize="7pt",e.style.fontWeight="bold",e.style.pointerEvents="none",e.innerText=[u.index,u.x,u.y,u.z].join(", "),o.appendChild(e));f.appendChild(o);r.appendChild(f);u.tile=f}),function(){b.forEach(function(n){k(n.tile).filter(function(t){return o(l(t),n)}).forEach(function(n){n.classList.add("sandwich")})})}();it()}();s&&s.history&&s.history.length&&(c=s.history.map(function(n){return n.map(function(n){var t=r.querySelector("[data-index='"+n+"']");return i(t),t})}),it());e&&e()}catch(n){r.dispatchEvent(new Event("game.wrong"))}}),{get availableMoves(){return rt},board:{get width(){return b?b.width:0},get height(){return b?b.height:0}},get constants(){return t},get end(){return h},get hiddenTiles(){return ut},get hints(){return d},get history(){return c},nextHint:function(){var n;Array.from(r.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")});typeof p!="undefined"&&p===d.length-1&&(p=undefined);d.length&&(n=typeof p!="undefined"?p+1:0,d[n].forEach(function(n){n.classList.add("hint")}),p=n)},get start(){return g},undo:function(n){c.length&&(Array.from(r.querySelectorAll(".clicked, .matching")).forEach(function(n){n.classList.remove("clicked");n.classList.remove("matching")}),h&&(n||c[c.length-1].length>1)&&(h=undefined),(n?c:[c.pop()]).forEach(function(n){n.forEach(function(n){u(n)})}),n&&c.length&&c.splice(0,c.length),p=undefined,it())},get visibleTiles(){return r.querySelectorAll(".tile:not(.hidden)").length}}}})(),function(){var pt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",wt=decodeURIComponent("%E3%85%A4"),v=document.querySelector(".board"),k=document.getElementById("menu"),o=document.getElementById("message"),it=document.querySelector(".scaler"),g=document.querySelector(".status");(function(){typeof ShadowRoot=="undefined"&&(o.classList.add("compatible"),k.classList.add("compatible"));h("animate")&&document.querySelector("body").classList.add("animate")})();var nt,st,f,lt,s,ht,at,bt=function(){u(k);u(messageBackdrop)},vt=function(){n(o)?(ut(),ft()):f&&f.history.length?tt(document.getElementById("askNewMessage").value):ft()},kt=function(){tt(document.getElementById("restartMessage").value)},et=function(n){if(Array.from(document.getElementsByClassName("boss")).forEach(function(t){(n?u:i)(t)}),nt!==n){var t=document.querySelector("[rel='shortcut icon']");(nt=n)?(at=document.title,document.title=wt,t&&(lt=t.getAttribute("href"),t.setAttribute("href",pt))):(document.title=at,t&&t.setAttribute("href",lt))}},dt=function(){s=document.getElementById("mapList").querySelector("input[type=radio]:checked").value;w(l,s);ft()},rt=function(){ct&&ct();Array.from(document.querySelectorAll(".undo, .restart")).forEach(function(n){f&&f.history.length?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")});Array.from(document.getElementsByClassName("hint")).forEach(function(n){!f||f.end?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled")});document.getElementById("tiles").innerText=f?f.visibleTiles.toLocaleString():"";document.getElementById("availableMoves").innerText=f?f.availableMoves.toLocaleString():"";document.getElementById("hiddenTiles").innerText=f?f.hiddenTiles.toLocaleString():""},ut=function(){i(o);i(k);i(document.getElementById("messageBackdrop"))},ft=function(n){s&&(f&&(f=undefined,v.removeEventListener("game.changed",rt)),f=new b(v,new window.maps[s],function(){v.addEventListener("game.changed",rt);setTimeout(function(){ht();rt()})},n))},yt=function(){f.nextHint()},ct=function(){var n=0,t,i="";f&&f.start&&(n=(f.end||Date.now())-f.start);n=Math.floor(n/1e3);n>=3600&&(i=Math.floor(n/3600)+":",n%=3600);t=Math.floor(n/60);n%=60;i.length&&t<10&&(t="0"+t);i+=t+":";n<10&&(n="0"+n);document.getElementById("time").innerText=i+n},gt=function(){ot(!0)},tt=function(n){nt||(document.getElementById("messageText").innerText=n,u(document.getElementById("messageBackdrop")),u(o))},ot=function(n){f.undo(n);rt()};(function(){var n,i;v.addEventListener("game.changed",rt);v.addEventListener("game.won",function(){tt(document.getElementById("wonMessage").value)});v.addEventListener("game.lost",function(n){var t=[];n&&n.detail&&n.detail.fatal&&(t=Array.from(document.getElementsByClassName("newGame")).concat(Array.from(document.getElementsByClassName("restart"))));t.length&&t.forEach(function(n){n.disabled="disabled"});tt(document.getElementById("lostMessage").value);t.length&&window.setTimeout(function(){t.forEach(function(n){n.disabled=""})},1e3)});v.addEventListener("game.wrong",function(){tt(document.getElementById("wrongGameMessage").value)});t(g,"newGame",vt);t(g,"undo",function(){ot()});t(g,"hint",yt);t(g,"restart",kt);t(g,"map",bt);document.getElementById("messageBackdrop").addEventListener("click",function(){ut()});y(o,"button",ut);t(o,"newGame",function(){ft()});t(o,"restart",gt);y(k,"button",ut);t(k,"accept",dt);st=h("boss")||!!parseInt(r.getAttribute("boss"));n=e()["boss-color"]||r.getAttribute("boss-color");typeof n!="undefined"&&c(".boss { background-color: "+n+" !important; }");i=e().version||r.getAttribute("version");i&&Array.from(document.getElementsByClassName("version")).forEach(function(n){n.innerText=i}),function(){var t,i,n;(t=window.maps)&&(n=Object.keys(t)).length&&((s=p(l))&&n.indexOf(s)<0&&(s=undefined),s=s||n[0]);n&&n.length>1?(i=document.getElementById("mapList"),Array.from(i.childNodes).forEach(function(n){n.parentElement.removeChild(n)}),n.forEach(function(n){var f=document.createElement("li"),u=document.createElement("label"),r=document.createElement("input"),e=document.createTextNode(t[n].displayName);u.addEventListener("dblclick",function(n){n.which===1&&k.querySelector(".accept").click()});r.setAttribute("name","map");r.setAttribute("type","radio");r.value=n;n===s&&r.setAttribute("checked","checked");u.appendChild(r);u.appendChild(e);f.appendChild(u);i.appendChild(f)})):g.querySelector(".map").style.display="none"}()})();document.addEventListener("keydown",function(t){switch(t.which){case 13:n(o)&&o.getElementsByTagName("button")[0].click();break;case 27:!nt&&n(o)?ut():st&&!nt&&et(!0);break;case 66:et(!nt);break;case 68:tt((new Date).toLocaleString());break;case 72:yt();break;case 90:t.ctrlKey&&ot();break;case 113:vt();break;case 221:t.ctrlKey&&ot(!0)}});(ht=function(){if(f){var t=(window.innerWidth-2*f.constants.padding)/f.board.width,i=(window.innerHeight-2*f.constants.padding)/f.board.height,n=1;v.clientHeight&&((t<1||i<1)&&(n=Math.min(t,i)),it.style["-ms-transform"]=it.style["-moz-transform"]=it.style["-o-transform"]=it.style["-webkit-transform"]=it.style.transform=n<1?"scale("+n+")":"")}})();window.addEventListener("resize",ht);st&&(window.addEventListener("blur",function(){et(!0)}),document.addEventListener("visibilitychange",function(){document.hidden&&et(!0)},!1));window.setInterval(ct,100);document.addEventListener("DOMContentLoaded",function(){ft(d(a))})}()})()