"use strict";(function(){(function(){Array.prototype.findIndex||(Array.prototype.findIndex=function(n){for(var i=this,t=0,r=this.length;t<r;t++)if(n.call(i,this[t],t))return t;return-1});Array.from||(Array.from=function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i})})();var e=function(n,t){Array.from(typeof n.length!="undefined"?n:[n]).forEach(function(n){n.addEventListener("click",t)})},n=function(n,t,i){e(n.querySelectorAll("."+t),i)},l=function(n,t,i){e(n.getElementsByTagName(t),i)},a=function(n){var t={};return Object.keys(n).forEach(function(i){t[i]=n[i]}),t},t=function(n){n.classList.add("hidden")},r=function(n){return!n.classList.contains("hidden")},i=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.max(t,i);return t},u=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.min(t,i);return t},o=function(n){return Object.keys(s()).findIndex(function(t){return t.toLowerCase()===n.toLowerCase()})>=0},s=function(n){var t=(n=n||window.location.href).indexOf("?"),i={};return t>=0&&(n=n.substr(t+1),t=n.indexOf("#"),t>=0&&(n=n.substr(0,t)),n.split("&").forEach(function(n){var t=n.indexOf("="),r=n.substr(0,t),u=n.substr(t+1);i[r||u]=r?window.decodeURIComponent(u):undefined})),i},h=function(n,t){var i;t&&(i=document.getElementById(t))?i.innerText=n:(i=document.createElement("style"),i.setAttribute("type","text/css"),t&&i.setAttribute("id",t),i.innerText=n,document.querySelector("head").appendChild(i))},f=function(n){n.classList.remove("hidden")},v=function(n,t){n.completed?t():n.executing?n.callbacks.push(t):(n.callbacks=[t],n.executing=!0,n(function(){n.completed=!0;n.executing=!1;for(var t=0,i=n.callbacks.length;t<i;t++)n.callbacks[t]()}))},y=o("debug"),c;(function(){var n={get depth(){return 6},get padding(){return 8}},o,l=function(t,i){var o=document.createElement("canvas"),u,f=t+n.depth,e=i+n.depth,r;return o.setAttribute("width",f),o.setAttribute("height",e),r=o.getContext("2d"),r.fillStyle="",u=r.createLinearGradient(0,i,0,e),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(0,i),r.lineTo(n.depth,e),r.lineTo(f,e),r.lineTo(t,i),r.closePath(),r.fill(),u=r.createLinearGradient(t,0,f,0),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(t,0),r.lineTo(t,i),r.lineTo(f,e),r.lineTo(f,n.depth),r.closePath(),r.fill(),o.toDataURL()},w=function(n){v(b,n)},b=function(t){var r=new Image,i,u;r.onload=function(){var y=this.width/9,p=this.height/5;Object.defineProperty(n,"width",{get:function(){return y}});Object.defineProperty(n,"height",{get:function(){return p}});var f,w="polygon("+n.width+"px 0, 100% "+n.depth+"px, 100% 100%, "+n.depth+"px 100%, 0 "+n.height+"px, 0 0)",c,i,r,e,u,a,s=0,v=0;for(f=['.face { background-image: url("'+this.src+'") !important; width: '+n.width+"px; height: "+n.height+"px; }",".tile { width: "+(n.width+n.depth)+"px; height: "+(n.height+n.depth)+"px; background-image: url("+l(n.width,n.height)+"); background-repeat: no-repeat; "+["","ms","moz","o","webkit"].map(function(n){return(n?"-"+n+"-":"")+"clip-path: "+w}).join("; ")+"}"],o=[],i=0;i<5;i++)for(c=i===3?8:i===4?7:9,r=0;r<c;r++){for(f.push(".t"+s+"{ background-position: -"+n.width*r+"px -"+n.height*i+"px }"),u=i>2&&r<4?1:4,(u!==1||a!==u)&&v++,e=0;e<u;e++)o.push({background:{x:-(n.width*r),y:-(n.height*i)},face:s,index:o.length,type:v});s++;a=u}h(f.join("\n"));t()};i=Array.prototype.slice.call(window.document.getElementsByTagName("script")).pop();u=i.getAttribute("palette")||s(i.getAttribute("src")).palette;r.src=u},k=function(n,t){var i=[],r,f,u,e;for(t.forEach(function(t){i.push({x:t.x,y:n.y,w:t.w,h:n.h});i.push({x:n.x,y:t.y,w:n.w,h:t.h})}),r=0;f=i[r];r++)for(u=0;e=t[u];u++)if(!d(f,e))return!1;return!0},p=function(t){var v=u(t.map(function(n){return n.x})),b=i(t.map(function(n){return n.x+n.w})),y=u(t.map(function(n){return n.y})),k=i(t.map(function(n){return n.y+n.h})),w=u(t.map(function(n){return n.z})),d=i(t.map(function(n){return n.z})),g=i(t.map(function(n){return n.w})),nt=i(t.map(function(n){return n.h})),r=b-v,f=k-y,s=t.length%4,c;if(s)return function(){var i=t.slice(),n;i.sort(function(n,t){return t.z-n.z});s=i.slice(0,s);n=t.filter(function(n){return s.findIndex(function(t){return t===n})<0});n.splice(0,0,0,t.length);t.splice.apply(t,n)}(),p(t);(v!==0||y!==0)&&t.forEach(function(n){n.x-=v;n.y-=y});w!==0&&t.forEach(function(n){n.z-=w});r*=n.width;r+=n.depth;r+=2*n.padding;t.width=r;f*=n.height;f+=n.depth;f+=2*n.padding;t.height=f;c=[".wrapper { max-width: "+r+"px; max-height:"+f+"px; }",".board { width: "+r+"px; height: "+f+"px; }"],function(){for(var t,u,r,i=1;i<=g;i++)for(t=1;t<=nt;t++)(i!==1||t!==1)&&(r=[],r.push('background-image: url("'+l(n.width*i,n.height*t)+'")'),r.push("width: "+(i*n.width+n.depth)+"px"),r.push("height: "+(t*n.height+n.depth)+"px"),r.push("clip-path: polygon("+i*n.width+"px 0, 100% "+n.depth+"px, 100% 100%, "+n.depth+"px 100%, 0 "+t*n.height+"px, 0 0)"),c.push(".tile.w-"+i+".h-"+t+" { "+r.join("; ")+" }"),u=[],u.push("background-size: "+n.width*9*i+"px "+n.height*5*t+"px"),u.push("width: "+i*n.width+"px"),u.push("height: "+t*n.height+"px"),c.push(".tile.w-"+i+".h-"+t+" .face { "+u.join("; ")+" }"))}();h(c.join("\n"),"map-style"),function(){var r={},i,n,f,s,u;do{for(n=o.slice(),u={};t.length<n.length;){if(!n.length)break;i=Math.floor(Math.random()*n.length);i=n[i].type;f=u[i]?0:2;u[i]=!0;s=0;n=n.filter(function(n){return n.type!==i||s++<f})}while(t.length>n.length){if(!n.length)break;i=Math.floor(Math.random()*n.length);i=n[i].type;i=n.filter(function(n){return n.type===i}).slice(0,2).map(function(n){return a(n)});i.splice(0,0,0,n.length);n.splice.apply(n,i)}n.forEach(function(n){typeof r[n.type]!="undefined"?r[n.type]++:r[n.type]=1});t.forEach(function(t,i){t.index=i;var u=Math.floor(Math.random()*n.length),r=n[u];t.background=r.background;t.face=r.face;t.type=r.type;n.splice(u,1)})}while(function(){var n,o,s,h,u,f,i;for(u=t.filter(function(n){return n.z}),n=0,s=u.length;n<s;n++)for(f=u[n],h=r[f.type]/2,o=0,i=w;i<=d;i++)if(i!==f.z&&t.findIndex(function(t){return t.z===i&&t.type===f.type&&e(u[n],t)})>=0&&++o>=h)return!0}())}()},d=function(n,t){return t.x<=n.x&&t.x+t.w>=n.x+n.w&&t.y<=n.y&&t.y+t.h>=n.y+n.h},e=function(n,t){return n!==t&&n.y+n.h>t.y&&n.y<t.y+t.h&&n.x+n.w>t.x&&n.x<t.x+t.w};c=function(i,u,o){var nt=0,h,tt=0,l,a=[],s=[],b,c,d=function(n,t){var r=n.dataset.type;return Array.from(i.getElementsByClassName("tile")).filter(function(i){return i!==n&&i.dataset.type===r&&(!t||i.classList.contains("free"))})},v=function(n){return{index:parseInt(n.dataset.index),x:parseFloat(n.dataset.x),y:parseFloat(n.dataset.y),z:parseFloat(n.dataset.z),w:parseFloat(n.dataset.w),h:parseFloat(n.dataset.h)}},g=function(){var n;nt=0;tt=0,function(){var n=Array.from(i.getElementsByClassName("tile")).map(function(n){var t=v(n);return t.index=parseInt(n.dataset.index),t.visible=r(n),t}),u=n.filter(function(t){var i=n.filter(function(n){return n.index!==t.index&&n.visible&&n.z===t.z&&n.y+n.h>t.y&&n.y<t.y+t.h});return i.length&&i.filter(function(n){return n.x+n.w===t.x}).length&&i.filter(function(n){return n.x===t.x+t.w}).length?!1:n.findIndex(function(n){return n.visible&&n.z===t.z+1&&e(n,t)})>=0?!1:!0}),t=Array.from(i.getElementsByClassName("tile"));t.forEach(function(n){n.classList[u.findIndex(function(t){return t.visible&&t.index===parseInt(n.dataset.index)})>=0?"add":"remove"]("free")});t.forEach(function(t){var f=r(t),i=f?v(t):undefined,u=d(t).filter(function(n){return r(n)});t.classList[u.length>1?"remove":"add"]("last");t.classList[u.length&&u.findIndex(function(n){return!n.classList.contains("free")})<0?"add":"remove"]("all"),function(){if(f){var r=!0,u,o,t=n.filter(function(n){return n.index!==i.index&&n.visible&&n.z===i.z&&n.x===i.x+i.w&&n.y+n.h>i.y&&n.y<i.y+i.h});t.length&&(t.sort(function(n,t){return t.y-n.y}),u=t[0].y,t.forEach(function(n,t){r&&t>0&&n.y>u&&(r=!1);u=n.y}),r&&(t=n.filter(function(n){return n.index!==i.index&&n.visible&&n.z===i.z&&n.y===i.y+i.h&&n.x+n.w>i.x&&n.x<i.x+i.w}),t.length&&(t.sort(function(n,t){return t.x-n.x}),u=t[0].x,t.forEach(function(n,t){r&&t>0&&n.x>u&&(r=!1)}),r&&(o=n.filter(function(n){return n.visible&&n.z===i.z+1&&e(n,i)}),o.length&&k(i,o)&&tt++))))}}();t.classList.contains("sandwich")&&function(){var n,r,o,h,c;f&&(o=[],r=[],u.forEach(function(n){(e(i,v(n))?o:r).push(n)}),o.length>1?n=!0:r.length===0&&(n=!0),n||(h=parseInt(t.dataset.type),c=s.findIndex(function(n){return parseInt(n[0].dataset.type)===h})>=0));t.classList[n?"add":"remove"]("fatal");t.classList[c?"add":"remove"]("uncovered")}()})}(),function(){var t=[],r=[];h||(Array.from(i.getElementsByClassName("free")).forEach(function(i,u){var s=!0,e,h,f=d(i,!0),o=f.length;if(o){for(f.push(i),n=!0,e=0;u<o,h=f[e];e++)if(r[h.dataset.index]){s=!1;break}s&&(f.forEach(function(n){r[n.dataset.index]=!0}),t.push(f),nt+=o)}}),t.sort(function(n,t){var i=function(n){var t=v(n[0]);return n.length*1e9+t.z*1e6+t.y*1e3+t.x},r=i(n),u=i(t);return r<u?1:r>u?-1:0}));a=t}();i.dispatchEvent(new Event("game.changed"));i.getElementsByClassName("tile").length===i.getElementsByClassName("hidden").length?h||(h=Date.now(),i.dispatchEvent(new Event("game.won"))):!i.querySelector(".tile.fatal")&&(n||!s.length&&i.getElementsByClassName("tile").length<c.length)||h||(h=Date.now(),b&&i.dispatchEvent(new Event("game.lost")))};return w(function(){p(c=u);Array.from(i.childNodes).forEach(function(n){n.parentElement.removeChild(n)}),function(){var r=0;c.forEach(function(u){var f=document.createElement("div"),o,e;f.classList.add("tile");f.classList.add("fade");(u.w!==1||u.h!==1)&&(f.classList.add("w-"+u.w),f.classList.add("h-"+u.h));f.style.left=u.x*n.width-u.z*n.depth+n.padding+"px";f.style.top=u.y*n.height-u.z*n.depth+n.padding+"px";f.style.zIndex=r++;f.dataset.index=u.index;f.dataset.type=u.type;f.dataset.x=u.x;f.dataset.y=u.y;f.dataset.z=u.z;f.dataset.w=u.w;f.dataset.h=u.h;f.addEventListener("click",function(){(function(n){var u=!0,r=Array.from(i.getElementsByClassName("clicked")),f=Array.from(i.getElementsByClassName("matching"));(n.classList.contains("free")||h)&&(f.forEach(function(n){n.classList.remove("matching")}),r.length===1&&r[0]!==n&&r[0].dataset.type===n.dataset.type?(t(r[0]),t(n),r[0].classList.remove("clicked"),n.classList.remove("clicked"),s.push([r[0],n]),b||(b=Date.now()),g()):h?(t(n),n.classList.remove("clicked"),s.push([n]),g()):(r.forEach(function(t){t!==n&&t.classList.remove("clicked")}),n.classList.toggle("clicked"),n.classList.contains("clicked")&&(u=!n.classList.contains("hint"),d(n).forEach(function(n){n.classList.add("matching")}))),u&&(l=undefined,Array.from(i.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")})))})(this)});o=document.createElement("div");o.classList.add("face");o.classList.add("t"+u.face);(u.w!==1||u.h!==1)&&(o.style.backgroundPosition=u.background.x*u.w+"px "+u.background.y*u.h+"px");y&&(e=document.createElement("span"),e.style.color="red",e.style.fontSize="7pt",e.style.fontWeight="bold",e.style.pointerEvents="none",e.innerText=[u.index,u.x,u.y,u.z].join(", "),o.appendChild(e));f.appendChild(o);i.appendChild(f);u.tile=f}),function(){c.forEach(function(n){d(n.tile).filter(function(t){return e(v(t),n)}).forEach(function(n){n.classList.add("sandwich")})})}();g()}();o&&o()}),{get availableMoves(){return nt},board:{get width(){return c?c.width:0},get height(){return c?c.height:0}},get constants(){return n},get end(){return h},get hiddenTiles(){return tt},get hints(){return a},get history(){return s},nextHint:function(){var n;Array.from(i.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")});typeof l!="undefined"&&l===a.length-1&&(l=undefined);a.length&&(n=typeof l!="undefined"?l+1:0,a[n].forEach(function(n){n.classList.add("hint")}),l=n)},get start(){return b},undo:function(n){s.length&&(Array.from(i.querySelectorAll(".clicked, .matching")).forEach(function(n){n.classList.remove("clicked");n.classList.remove("matching")}),h&&(n||s[s.length-1].length>1)&&(h=undefined),(n?s:[s.pop()]).forEach(function(n){n.forEach(function(n){f(n)})}),n&&s.length&&s.splice(0,s.length),g())},get visibleTiles(){return i.querySelectorAll(".tile:not(.hidden)").length}}}})(),function(){var e=document.querySelector(".board"),u=document.getElementById("message"),s=document.querySelector(".scaler"),a=document.querySelector(".status");(function(){typeof ShadowRoot=="undefined"&&u.classList.add("compatible");o("no-media")&&document.querySelector("body").classList.add("no-media")})();var i,w,d=function(){r(u)?(v(),y()):i.history.length?h(document.getElementById("askNewMessage").value):y()},nt=function(){h(document.getElementById("restartMessage").value)},b=function(){k&&k();i&&(Array.from(document.querySelectorAll(".undo, .restart")).forEach(function(n){i.history.length?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")}),Array.from(document.getElementsByClassName("hint")).forEach(function(n){i.end?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled")}));document.getElementById("tiles").innerText=i?i.visibleTiles.toLocaleString():"";document.getElementById("availableMoves").innerText=i?i.availableMoves.toLocaleString():"";document.getElementById("hiddenTiles").innerText=i?i.hiddenTiles.toLocaleString():""},v=function(){t(u);t(document.getElementById("messageBackdrop"))},y=function(){var t,r=window.maps,n;r&&(n=Object.keys(r)).length&&(n.length===1&&(t=new window.maps[n[0]]),i=new c(e,t,function(){w();b()}))},g=function(){i.nextHint()},k=function(){var n=0,t,r="";i&&i.start&&(n=(i.end||Date.now())-i.start);n=Math.floor(n/1e3);n>=3600&&(r=Math.floor(n/3600)+":",n%=3600);t=Math.floor(n/60);n%=60;r.length&&t<10&&(t="0"+t);r+=t+":";n<10&&(n="0"+n);document.getElementById("time").innerText=r+n},tt=function(){p(!0)},h=function(n){document.getElementById("messageText").innerText=n;f(document.getElementById("messageBackdrop"));f(u)},p=function(n){i.undo(n);b()};(function(){e.addEventListener("game.changed",b);e.addEventListener("game.won",function(){h(document.getElementById("wonMessage").value)});e.addEventListener("game.lost",function(){h(document.getElementById("lostMessage").value)});n(a,"newGame",d);n(a,"hint",g);n(a,"restart",nt);n(a,"undo",function(){p()});document.getElementById("messageBackdrop").addEventListener("click",function(){v()});l(u,"button",v);n(u,"newGame",y);n(u,"restart",tt)})();document.addEventListener("keydown",function(n){switch(n.which){case 27:v();break;case 68:h((new Date).toLocaleString());break;case 72:g();break;case 90:n.ctrlKey&&p();break;case 113:d();break;case 221:n.ctrlKey&&p(!0)}});(w=function(){if(i){var t=(window.innerWidth-2*i.constants.padding)/i.board.width,r=(window.innerHeight-2*i.constants.padding)/i.board.height,n=1;e.clientHeight&&((t<1||r<1)&&(n=Math.min(t,r)),s.style["-ms-transform"]=s.style["-moz-transform"]=s.style["-o-transform"]=s.style["-webkit-transform"]=s.style.transform=n<1?"scale("+n+")":"")}})();window.addEventListener("resize",w);window.setInterval(k,100);document.addEventListener("DOMContentLoaded",y)}()})()