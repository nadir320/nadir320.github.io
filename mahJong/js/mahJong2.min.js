"use strict";(function(){var i=function(n,t){Array.from(typeof n.length!="undefined"?n:[n]).forEach(function(n){n.addEventListener("click",t)})},n=function(n,t,r){i(n.querySelectorAll("."+t),r)},e=function(n,t,r){i(n.getElementsByTagName(t),r)},t=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.max(t,i);return t},r=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.min(t,i);return t},o=function(n){var t=n.indexOf("?"),i={};return t>=0&&(n=n.substr(t+1),t=n.indexOf("#"),t>=0&&(n=n.substr(0,t)),n.split("&").forEach(function(n){var t=n.indexOf("=");i[n.substr(0,t)]=window.decodeURIComponent(n.substr(t+1))})),i},u=function(n,t){var i;t&&(i=document.getElementById(t))?i.innerText=n:(i=document.createElement("style"),i.setAttribute("type","text/css"),i.innerText=n,document.querySelector("head").appendChild(i))},s=function(n,t){n.completed?t():n.executing?n.callbacks.push(t):(n.callbacks=[t],n.executing=!0,n(function(){n.completed=!0;n.executing=!1;for(var t in n.callbacks)n.callbacks[t]()}))},h=!!window.location.search.match(/debug/i),f;(function(){var n={get depth(){return 6},get padding(){return 8}},i,l=function(){for(var i=[],t=function(n,t,r,u,f){i.push({x:n||0,y:t||0,z:r||0,w:u||1,h:f||1})},n=1;n<=12;n++)t(+n,0);for(n=13;n<=20;n++)t(n-10,1);for(n=21;n<=30;n++)t(n-19,2);for(t(0,3.5),n=32;n<=43;n++)t(n-31,3);for(n=44;n<=55;n++)t(n-43,4);for(t(13,3.5),t(14,3.5),n=58;n<=67;n++)t(n-56,5);for(n=68;n<=75;n++)t(n-65,6);for(n=76;n<=87;n++)t(n-75,7);for(n=88;n<=123;n++)t(4+(n-88)%6,1+Math.floor((n-88)/6),1);for(n=124;n<=139;n++)t(5+(n-124)%4,2+Math.floor((n-124)/4),2);for(n=140;n<=143;n++)t(6+(n-140)%2,3+Math.floor((n-140)/2),3);return t(6.5,3.5,4),i},c=function(t,i){var o=document.createElement("canvas"),u,f=t+n.depth,e=i+n.depth,r;return o.setAttribute("width",f),o.setAttribute("height",e),r=o.getContext("2d"),r.fillStyle="",u=r.createLinearGradient(0,i,0,e),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(0,i),r.lineTo(n.depth,e),r.lineTo(f,e),r.lineTo(t,i),r.closePath(),r.fill(),u=r.createLinearGradient(t,0,f,0),u.addColorStop(0,"rgba(0, 0, 0, 0.25)"),u.addColorStop(1,"rgba(0, 0, 0, 0.75)"),r.fillStyle=u,r.beginPath(),r.moveTo(t,0),r.lineTo(t,i),r.lineTo(f,e),r.lineTo(f,n.depth),r.closePath(),r.fill(),o.toDataURL()},a=function(n){s(v,n)},v=function(t){var f=new Image,r,e;f.onload=function(){var y=this.width/9,p=this.height/5,s,a,r,f,h,e,v,o,l;for(Object.defineProperty(n,"width",{get:function(){return y}}),Object.defineProperty(n,"height",{get:function(){return p}}),o=0,l=0,s=['.face { background-image: url("'+this.src+'") !important; width: '+n.width+"px; height: "+n.height+"px; }",".tile { width: "+(n.width+n.depth)+"px; height: "+(n.height+n.depth)+"px; background-image: url("+c(n.width,n.height)+"); background-repeat: no-repeat; clip-path: polygon("+n.width+"px 0, 100% "+n.depth+"px, 100% 100%, "+n.depth+"px 100%, 0 "+n.height+"px, 0 0); }"],i=[],r=0;r<5;r++)for(a=r===3?8:r===4?7:9,f=0;f<a;f++){for(s.push(".t"+o+"{ background-position: -"+n.width*f+"px -"+n.height*r+"px }"),e=r>2&&f<4?1:4,(e!==1||v!==e)&&l++,h=0;h<e;h++)i.push({background:{x:-(n.width*f),y:-(n.height*r)},face:o,index:i.length,type:l});o++;v=e}u(s.join("\n"));t()};r=Array.prototype.slice.call(window.document.getElementsByTagName("script")).pop();e=r.getAttribute("palette")||o(r.getAttribute("src")).palette;f.src=e},y=function(f){var l=r(f.map(function(n){return n.x})),a=t(f.map(function(n){return n.x+n.w})),v=r(f.map(function(n){return n.y})),y=t(f.map(function(n){return n.y+n.h})),p=t(f.map(function(n){return n.w})),w=t(f.map(function(n){return n.h})),e=a-l,o=y-v,s,h;e*=n.width;e+=n.depth;e+=2*n.padding;f.width=e;o*=n.height;o+=n.depth;o+=2*n.padding;f.height=o;s=[".wrapper { max-width: "+e+"px; max-height:"+o+"px; }",".board { width: "+e+"px; height: "+o+"px; }"],function(){for(var t,u,r,i=1;i<=p;i++)for(t=1;t<=w;t++)(i!==1||t!==1)&&(r=[],r.push('background-image: url("'+c(n.width*i,n.height*t)+'")'),r.push("width: "+(i*n.width+n.depth)+"px"),r.push("height: "+(t*n.height+n.depth)+"px"),r.push("clip-path: polygon("+i*n.width+"px 0, 100% "+n.depth+"px, 100% 100%, "+n.depth+"px 100%, 0 "+t*n.height+"px, 0 0)"),s.push(".tile.w-"+i+".h-"+t+" { "+r.join("; ")+" }"),u=[],u.push("background-size: "+n.width*9*i+"px "+n.height*5*t+"px"),u.push("width: "+i*n.width+"px"),u.push("height: "+t*n.height+"px"),s.push(".tile.w-"+i+".h-"+t+" .face { "+u.join("; ")+" }"))}();u(s.join("\n"),"map-style");h=i.slice();f.forEach(function(n,t){n.index=t;var r=Math.floor(Math.random()*h.length),i=h[r];n.background=i.background;n.face=i.face;n.type=i.type;h.splice(r,1)})},e=function(n,t){return n!==t&&n.y+n.h>t.y&&n.y<t.y+t.h&&n.x+n.w>t.x&&n.x<t.x+t.w};f=function(t,i){var w=0,u,f,o=[],s=[],b,r,v=function(n,i){var r=n.dataset.type;return Array.from(t.getElementsByClassName("tile")).filter(function(t){return t!==n&&t.dataset.type===r&&(!i||t.classList.contains("free"))})},c=function(n){return{x:parseFloat(n.dataset.x),y:parseFloat(n.dataset.y),z:parseFloat(n.dataset.z),w:parseFloat(n.dataset.w),h:parseFloat(n.dataset.h)}},p=function(){var n;w=0,function(){var n=Array.from(t.getElementsByClassName("tile")).map(function(n){var t=c(n);return t.index=parseInt(n.dataset.index),t.visible=!n.classList.contains("hidden"),t}),i=function(t){return n[r.findIndex(function(n){return n.index===t})].visible},u=n.filter(function(n){var t=r.filter(function(t){return t.z===n.z&&t.y+t.h>n.y&&t.y<n.y+n.h&&i(t.index)});return t.length&&t.filter(function(t){return t.x+t.w===n.x}).length&&t.filter(function(t){return t.x===n.x+n.w}).length?!1:r.findIndex(function(t){return t.z===n.z+1&&e(t,n)&&i(t.index)})>=0?!1:!0});Array.from(t.getElementsByClassName("tile")).forEach(function(n){if(n.classList[u.findIndex(function(t){return t.visible&&t.index===parseInt(n.dataset.index)})>=0?"add":"remove"]("free"),n.classList.contains("sandwich")){var f,t,o,i,r,h;n.classList.contains("hidden")||(f=c(n),r=[],i=[],v(n).forEach(function(n){n.classList.contains("hidden")||(e(f,c(n))?r:i).push(n)}),r.length>1?t=!0:i.length===0&&(t=!0),h=parseInt(n.dataset.type),o=s.findIndex(function(n){return parseInt(n[0].dataset.type)===h})>=0);n.classList[t?"add":"remove"]("f");n.classList[o&&!t?"add":"remove"]("g")}})}(),function(){var i=[],r=[];u||(Array.from(t.getElementsByClassName("free")).forEach(function(t,u){var s=!0,e,h,f=v(t,!0),o=f.length;if(o){for(f.push(t),n=!0,e=0;u<o,h=f[e];e++)if(r[h.dataset.index]){s=!1;break}s&&(f.forEach(function(n){r[n.dataset.index]=!0}),i.push(f),w+=o)}}),i.sort(function(n,t){var i=function(n){var t=c(n[0]);return n.length*1e9+t.z*1e6+t.y*1e3+t.x},r=i(n),u=i(t);return r<u?1:r>u?-1:0}));o=i}();t.dispatchEvent(new Event("game.changed"));t.getElementsByClassName("tile").length===t.getElementsByClassName("hidden").length?u||(u=Date.now(),t.dispatchEvent(new Event("game.won"))):!t.querySelector(".tile.sandwich.f")&&(n||!s.length&&t.getElementsByClassName("tile").length<r.length)||u||(u=Date.now(),t.dispatchEvent(new Event("game.lost")))};return a(function(){y(r=l());Array.from(t.childNodes).forEach(function(n){n.parentElement.removeChild(n)}),function(){var i=0;r.forEach(function(r){var e=document.createElement("div"),c,o;e.classList.add("tile");e.classList.add("fade");(r.w!==1||r.h!==1)&&(e.classList.add("w-"+r.w),e.classList.add("h-"+r.h));e.style.left=r.x*n.width-r.z*n.depth+n.padding+"px";e.style.top=r.y*n.height-r.z*n.depth+n.padding+"px";e.style.zIndex=i++;e.dataset.index=r.index;e.dataset.type=r.type;e.dataset.x=r.x;e.dataset.y=r.y;e.dataset.z=r.z;e.dataset.w=r.w;e.dataset.h=r.h;e.addEventListener("click",function(){(function(n){var r=!0,i=Array.from(t.getElementsByClassName("clicked")),o=Array.from(t.getElementsByClassName("hint")),e,h=Array.from(t.getElementsByClassName("matching"));(n.classList.contains("free")||u)&&(h.forEach(function(n){n.classList.remove("matching")}),i.length===1&&i[0]!==n&&i[0].dataset.type===n.dataset.type?(i[0].classList.add("hidden"),n.classList.add("hidden"),i[0].classList.remove("clicked"),n.classList.remove("clicked"),s.push([i[0],n]),b||(b=Date.now()),p()):u?(n.classList.add("hidden"),n.classList.remove("clicked"),s.push([n]),p()):(i.forEach(function(t){t!==n&&t.classList.remove("clicked")}),n.classList.toggle("clicked"),n.classList.contains("clicked")&&(r=!n.classList.contains("hint"),(e=Array.from(t.getElementsByClassName("hidden")).filter(function(t){return t.dataset.type===n.dataset.type}).length)&&n.classList.add("last"),v(n).forEach(function(n){n.classList.add("matching");e&&n.classList.add("last")}))),r&&(f=undefined,o.forEach(function(n){n.classList.remove("hint")})))})(this)});c=document.createElement("div");c.classList.add("face");c.classList.add("t"+r.face);(r.w!==1||r.h!==1)&&(c.style.backgroundPosition=r.background.x*r.w+"px "+r.background.y*r.h+"px");h&&(o=document.createElement("span"),o.style.color="red",o.style.fontSize="7pt",o.style.fontWeight="bold",o.style.pointerEvents="none",o.innerText=[r.index,r.x,r.y,r.z].join(", "),c.appendChild(o));e.appendChild(c);t.appendChild(e);r.tile=e}),function(){r.forEach(function(n){v(n.tile).filter(function(t){return e(c(t),n)}).forEach(function(n){n.classList.add("sandwich")})})}();p()}();i&&i()}),{get availableMoves(){return w},board:{get width(){return r?r.width:0},get height(){return r?r.height:0}},get constants(){return n},get end(){return u},get hints(){return o},get history(){return s},nextHint:function(){var n;Array.from(t.getElementsByClassName("hint")).forEach(function(n){n.classList.remove("hint")});typeof f!="undefined"&&f===o.length-1&&(f=undefined);o.length&&(n=typeof f!="undefined"?f+1:0,o[n].forEach(function(n){n.classList.add("hint")}),f=n)},get start(){return b},undo:function(n){Array.from(t.querySelectorAll(".clicked, .matching, .last")).forEach(function(n){n.classList.remove("clicked");n.classList.remove("matching");n.classList.remove("last")});u&&(n||this.history[this.history.length-1].length>1)&&(u=undefined);(n?this.history:[this.history.pop()]).forEach(function(n){n.forEach(function(n){n.classList.remove("hidden")})});n&&this.history.length&&this.history.splice(0,this.history.length);p()},get visibleTiles(){return t.querySelectorAll(".tile:not(.hidden)").length}}}})(),function(){var r=document.querySelector(".board"),i=document.getElementById("message"),u=document.querySelector(".scaler"),s=document.querySelector(".status");(function(){typeof ShadowRoot=="undefined"&&i.classList.add("compatible")})();var t,a,p=function(){i.classList.contains("hidden")?t.history.length?o(document.getElementById("askNewMessage").value):c():(h(),c())},b=function(){o(document.getElementById("restartMessage").value)},v=function(){y&&y();t&&(Array.from(document.querySelectorAll(".undo, .restart")).forEach(function(n){t.history.length?n.removeAttribute("disabled"):n.setAttribute("disabled","disabled")}),Array.from(document.getElementsByClassName("hint")).forEach(function(n){t.end?n.setAttribute("disabled","disabled"):n.removeAttribute("disabled")}));document.getElementById("tiles").innerText=t?t.visibleTiles.toLocaleString():"";document.getElementById("availableMoves").innerText=t?t.availableMoves.toLocaleString():""},h=function(){i.classList.add("hidden");document.getElementById("messageBackdrop").classList.add("hidden")},c=function(){t=new f(r,function(){a();v()})},w=function(){t.nextHint()},y=function(){var n=0,i,r="";t&&t.start&&(n=(t.end||Date.now())-t.start);n=Math.floor(n/1e3);n>=3600&&(r=Math.floor(n/3600)+":",n%=3600);i=Math.floor(n/60);n%=60;r.length&&i<10&&(i="0"+i);r+=i+":";n<10&&(n="0"+n);document.getElementById("time").innerText=r+n},k=function(){l(!0)},o=function(n){document.getElementById("messageText").innerText=n;document.getElementById("messageBackdrop").classList.remove("hidden");i.classList.remove("hidden")},l=function(n){t.undo(n);v()};(function(){r.addEventListener("game.changed",v);r.addEventListener("game.won",function(){o(document.getElementById("wonMessage").value)});r.addEventListener("game.lost",function(){o(document.getElementById("lostMessage").value)});n(s,"newGame",p);n(s,"hint",w);n(s,"restart",b);n(s,"undo",function(){l()});document.getElementById("messageBackdrop").addEventListener("click",function(){h()});e(i,"button",h);n(i,"newGame",c);n(i,"restart",k)})();document.addEventListener("keydown",function(n){switch(n.which){case 27:h();break;case 68:o((new Date).toLocaleString());break;case 72:w();break;case 90:n.ctrlKey&&l();break;case 113:p();break;case 221:n.ctrlKey&&l(!0)}});window.addEventListener("resize",a=function(){if(t){var i=(window.innerWidth-2*t.constants.padding)/t.board.width,f=(window.innerHeight-2*t.constants.padding)/t.board.height,n=1;r.clientHeight&&((i<1||f<1)&&(n=Math.min(i,f)),u.style["-ms-transform"]=u.style["-moz-transform"]=u.style["-o-transform"]=u.style["-webkit-transform"]=u.style.transform=n<1?"scale("+n+")":"")}});a();window.setInterval(y,100);c()}()})()