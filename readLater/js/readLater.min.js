"use strict";if(window.nadir||(window.nadir={}),window.nadir.readLater||(window.nadir.readLater={}),window.nadir.readLater.officeMode===undefined&&(window.nadir.readLater.officeMode=window.location.get("officeMode")),!window.nadir.readLater.database&&window.firebase&&(window.nadir.readLater.database=window.firebase.initializeApp({apiKey:"AIzaSyA58csfwsnx3CIFhx73ecGlP0dY9-s8BS4",databaseURL:"https://readlater-274ac.firebaseio.com"},(new Date).getTime().toString())),function(){var n,t;window.nadir.readLater.isNSFWUrl||(window.nadir.readLater.isNSFWUrl=function(i,r){var u=function(){for(var u=!1,t=0,f=n.length;t<f;t++)if(i.match(n[t])){u=!0;break}r(u)};n?u():t?t.then(u):t=window.nadir.readLater.database.database().ref("filters/nsfw").once("value").then(function(t){n=t.val().map(function(n){return new RegExp(n,"i")});u()})})}(),window.jQuery){if(!window.nadir.readLater.loadFavicons){var createFavicon=function(n,t){var f=window.location.noProtocol(n)[0].toUpperCase(),u=document.createElement("canvas"),i=u.getContext("2d"),r;try{r=new Image;r.onload=function(){var n=r.width,e=r.height;u.width=n;u.height=e;i.imageSmoothingEnabled=!1;i.drawImage(r,0,0);i.font=(n/2).toString()+"px Sans-Serif";i.textAlign="center";i.strokeStyle="#9A7F59";i.fillStyle="#AA9F79";i.fillText(f,n/2,e/1.55);i.strokeText(f,n/2,e/1.55);t(u.toDataURL())};r.src="./images/base48.png";return}catch(e){}t("./images/help48.png")};window.nadir.readLater.loadFavicons=function(n){window.jQuery(n).find(".favicon").each(function(){var t=window.jQuery(this),n=t.data("url");window.nadir.readLater.isNSFWUrl(n,function(i){var r=window.nadir.readLater.officeMode&&i,u=r?"./images/nsfw48.png":n.split(":")[0]+"://"+n.substring(n.indexOf(":")+3).split("/")[0]+"/favicon.ico";t.on({error:function(){var n=$(this);(n.data("fixedNSFW")?function(n,t){t("./images/help48.png")}:createFavicon)(n.attr("src"),function(t){n.attr({src:t})})}}).data({fixedNSFW:r}).attr({src:u})})})}}window.nadir.readLater.createLink||(window.nadir.readLater.createLink=function(n,t,i){return $(document.createElement("li")).append($(document.createElement("div")).addClass(t.error?"ui-state-error":undefined).append($(document.createElement("div")).addClass("title").addClass("row").append($(document.createElement("div")).addClass("title-row").append($(document.createElement("img")).addClass("favicon").data({url:t.url})).append($(document.createElement("div")).addClass("title-title").text(t.title)).append(t.category&&t.category.length?$(document.createElement("div")).addClass("category").addClass("ui-state-default").text(t.category):undefined)).append(t.date?$(document.createElement("div")).addClass("date").text(t.date.toLocaleString()):undefined)).append($(document.createElement("div")).addClass("row").append($(document.createElement("div")).addClass("link").append($(document.createElement("a")).attr({href:t.url,target:"_blank"}).text(t.url))).append($(document.createElement("div")).addClass("buttons").append(t.error?undefined:$(i||[]).map(function(){var n=this,f=(typeof n=="object"?n.id:n).toLowerCase(),i,r,u;switch(f){case"add":i="disk";r="Add to Read Later";u="highlight";break;case"go":i="extlink";r="Go";u="default";break;case"rename":i="pencil";r="Rename";u="default";break;case"remove":i="closethick";r="Remove";u="error"}return $(document.createElement("button")).addClass("ui-state-"+u).addClass(f).attr({type:"button"}).button({icons:{primary:"ui-icon-"+i},label:r}).data({id:f,link:t}).on({click:function(){var i=$(this).closest("button"),t=i.data();switch(t.id){case"add":$.confirm("Are you sure you want to add '{0}'?".format(t.link.title&&t.link.title.length?t.link.title:t.link.url)).then(function(){window.loading(function(){return $.Deferred(function(i){window.nadir.readLater.add({uid:window.nadir.readLater.uid,href:t.link.url,title:t.link.title,category:t.link.category,callback:function(t){t?(i.reject(),n.click?n.click(t):$.alert(t)):(i.resolve(),n.click&&n.click())}})})},"Adding...")});break;case"go":window.open(n.url||t.link.url);break;case"rename":$.prompt("Rename '{0}':".format(t.link.title),t.link.title).then(function(r){r&&r.length&&window.loading(function(){return $.Deferred(function(u){window.nadir.readLater.database.database().ref(window.nadir.readLater.uid+"/"+t.link.id+"/title").set(r).then(function(){i.closest("li").find(".title-title").text(r);t.link.title=r;u.resolve();n.click&&n.click()}).catch(function(t){u.reject();n.click?n.click(t):$.alert(t)})})},"Renaming...")});break;case"remove":$.confirm("Are you sure you want to remove '{0}'?".format(t.link.title&&t.link.title.length?t.link.title:t.link.url)).then(function(){window.loading(function(){return $.Deferred(function(r){window.nadir.readLater.database.database().ref(window.nadir.readLater.uid+"/"+t.link.id).set(null).then(function(){i.closest("li").fadeOut(function(){$(this).remove();r.resolve();n.click&&n.click()})}).catch(function(t){r.reject();n.click?n.click(t):$.alert(t)})},"Removing...")})})}}})}).toArray())))).appendTo(n)})}