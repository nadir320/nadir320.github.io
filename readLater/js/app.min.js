"use strict";$().ready(function(){var s,h=window.location.get("officeMode"),n="readLater",t,i=window.firebase.initializeApp({apiKey:"AIzaSyA58csfwsnx3CIFhx73ecGlP0dY9-s8BS4",databaseURL:"https://readlater-274ac.firebaseio.com"},$.now().toString()),r=function(){return window.loading(function(){return $.Deferred(function(n){i.database().ref(t).once("value").then(function(n){var u,r=$("#list").empty(),e=n.val();e&&(r.append(r=$(document.createElement("ul"))),u=[],$(e).eachProp(function(n,t){var i=$.extend({},t);i.date=new Date(i.date);i.id=n;i.title&&i.title.length||(i.title="<No title>");i.url&&i.url.length||(i.url="");u.push(i)}),u.sort(function(n,t){var i,r;return n.date.getTime?isNaN(i=n.date.getTime())&&(i=n.title):i=n.title,t.date.getTime?isNaN(r=t.date.getTime())&&(r=t.title):r=t.title,i<r?1:i>r?-1:0}),$(u).each(function(n,u){$(document.createElement("li")).append($(document.createElement("img")).addClass("favicon").on({error:function(){$(this).hide()}}).attr({src:!h||!u.url.match(/porn/i)?u.url.split(":")[0]+"://"+u.url.substring(u.url.indexOf(":")+3).split("/")[0]+"/favicon.ico":null})).append($(document.createElement("span")).text((u.title&&u.title.length?"{0} ({1}):":"{1}:").format(u.title,u.date.toLocaleString()))).append($(document.createElement("br"))).append($(document.createElement("a")).attr({href:u.url,target:"_blank"}).text(u.url)).append($(document.createElement("button")).addClass("ui-state-error").addClass("remove").attr({type:"button"}).button({icons:{primary:"ui-icon-closethick"},label:"Remove"}).data({id:u.id,title:u.title,url:u.url}).on({click:function(){var r=$(this).closest("button"),n=r.data();$.confirm("Are you sure you want to remove '{0}'?".format(n.title&&n.title.length?n.title:n.url)).then(function(){i.database().ref(t+"/"+n.id).set(null).then(function(){r.closest("li").fadeOut(function(){$(this).remove();f()})}).catch(function(n){$.alert(n)})})}})).appendTo(r)}),r.find("li").length||r.remove());f()}).catch(function(n){$.alert(n.message||n)}).finally(function(){n.resolve()})}).promise()},"Loading links...")},u=function(u,f,e,o,h){window.loader.message("Logging in...");window.loader.show();i.auth().signInWithEmailAndPassword(u,f).then(function(i){e?window.localStorage.setItem(n,window.JSON.stringify({username:u,password:f,rememberMe:!0})):window.localStorage.removeItem(n);$(".email").button("option","label",s=i.user.email).fadeIn();$(".refresh").fadeIn();t=i.user.uid;o&&o();window.loader.hide();r()}).catch(function(n){window.loader.hide();$.alert(n.description||n.message||n).then(h)})},f=function(){var n=$("#list").find("li").length;$(".title-text").text(("Read later links"+(n?" ({0})":String.empty)).format(n.toLocaleString()));$(".no-link")[n?"fadeOut":"fadeIn"]()},e=function(n,t,i){$(".loginButton").button().off().on({click:function(){return u($("#username").val(),$("#password").val(),$("#rememberMe").prop("checked"),function(){$(".loginDialog").dialog("close")}),!1}});$("#username").val(n);$("#password").val(t);$("#rememberMe").prop("checked",i);$(".loginDialog").dialog({hide:!0,minWidth:$(window).width()*.5,modal:!0,show:!0})},o=function(t){var i=window.localStorage.getItem(n);i=i&&i.length?window.JSON.parse(i):{};!t&&i.username&&i.username.length?u(i.username,i.password,i.rememberMe,undefined,function(){e(i.username,i.password,i.rememberMe)}):e(i.username,i.password,i.rememberMe)};window.loader.value(!1);$(".email").button({icons:{primary:"ui-icon-key"}}).on({click:function(){o(!0)}});$(".refresh").button({icons:{primary:"ui-icon-refresh"}}).on({click:function(){r()}});o()})