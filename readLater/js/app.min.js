"use strict";$().ready(function(){var n=window.nadir.readLater,s,i="readLater",t,r=function(){return window.loading(function(){return $.Deferred(function(i){n.database.database().ref(t).once("value").then(function(i){var u,r=$("#list").empty(),e=i.val();e&&(r.append(r=$(document.createElement("ul"))),u=[],$(e).eachProp(function(n,t){var i=$.extend({},t);i.date=new Date(i.date);i.id=n;i.title&&i.title.length||(i.title="<No title>");i.url&&i.url.length||(i.url="");u.push(i)}),u.sort(function(n,t){var i,r;return n.date.getTime?isNaN(i=n.date.getTime())&&(i=n.title):i=n.title,t.date.getTime?isNaN(r=t.date.getTime())&&(r=t.title):r=t.title,i<r?1:i>r?-1:0}),$(u).each(function(i,u){$(document.createElement("li")).append($(document.createElement("div")).addClass("title").append($(document.createElement("div")).addClass("title").append($(document.createElement("img")).addClass("favicon").data({url:u.url})).append($(document.createElement("div")).addClass("title").text(u.title)).append(u.category&&u.category.length?$(document.createElement("div")).addClass("category").addClass("ui-state-default").text(u.category):undefined)).append($(document.createElement("div")).addClass("date").text(u.date.toLocaleString()))).append($(document.createElement("div")).addClass("row").append($(document.createElement("div")).addClass("link").append($(document.createElement("a")).attr({href:u.url,target:"_blank"}).text(u.url))).append($(document.createElement("div")).addClass("buttons").append($(document.createElement("button")).addClass("ui-state-default").addClass("rename").attr({type:"button"}).button({icons:{primary:"ui-icon-pencil"},label:"Rename"}).data({id:u.id,title:u.title,url:u.url}).on({click:function(){var i=$(this).closest("button"),r=i.data();$.prompt("Rename '{0}':".format(r.title),r.title).then(function(u){u&&u.length&&window.loading(function(){return $.Deferred(function(f){n.database.database().ref(t+"/"+r.id+"/title").set(u).then(function(){i.closest("li").find(".title .title .title").text(u);i.data({title:u});f.resolve()}).catch(function(n){f.reject();$.alert(n)})})})})}})).append($(document.createElement("button")).addClass("ui-state-error").addClass("remove").attr({type:"button"}).button({icons:{primary:"ui-icon-closethick"},label:"Remove"}).data({id:u.id,title:u.title,url:u.url}).on({click:function(){var r=$(this).closest("button"),i=r.data();$.confirm("Are you sure you want to remove '{0}'?".format(i.title&&i.title.length?i.title:i.url)).then(function(){window.loading(function(){return $.Deferred(function(u){n.database.database().ref(t+"/"+i.id).set(null).then(function(){r.closest("li").fadeOut(function(){$(this).remove();f()});u.resolve()}).catch(function(n){u.reject();$.alert(n)})})})})}})))).appendTo(r)}),r.find("li").length?n.loadFavicons(r):r.remove());f()}).catch(function(n){$.alert(n.message||n)}).finally(function(){i.resolve()})}).promise()},"Loading links...")},u=function(u,f,e,o,h){window.loader.message("Logging in...");window.loader.show();n.database.auth().signInWithEmailAndPassword(u,f).then(function(n){e?window.localStorage.setItem(i,window.JSON.stringify({username:u,password:f,rememberMe:!0})):window.localStorage.removeItem(i);$(".email").button("option","label",s=n.user.email).fadeIn();$(".refresh").fadeIn();t=n.user.uid;o&&o();window.loader.hide();r()}).catch(function(n){window.loader.hide();$.alert(n.description||n.message||n).then(h)})},f=function(){var n=$("#list").find("li").length;$(".title-text").text(("Read later links"+(n?" ({0})":String.empty)).format(n.toLocaleString()));$(".no-link")[n?"fadeOut":"fadeIn"]()},e=function(n,t,i){$(".loginButton").button().off().on({click:function(){return u($("#username").val(),$("#password").val(),$("#rememberMe").prop("checked"),function(){$(".loginDialog").dialog("close")}),!1}});$("#username").val(n);$("#password").val(t);$("#rememberMe").prop("checked",i);$(".loginDialog").dialog({hide:!0,minWidth:$(window).width()*.5,modal:!0,show:!0})},o=function(n){var t=window.localStorage.getItem(i);t=t&&t.length?window.JSON.parse(t):{};!n&&t.username&&t.username.length?u(t.username,t.password,t.rememberMe,undefined,function(){e(t.username,t.password,t.rememberMe)}):e(t.username,t.password,t.rememberMe)};window.loader.value(!1);$(".email").button({icons:{primary:"ui-icon-key"}}).on({click:function(){o(!0)}});$(".refresh").button({icons:{primary:"ui-icon-refresh"}}).on({click:function(){r()}});o()})