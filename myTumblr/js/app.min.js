"use strict";var PARAMETERS={blogs:"blogs",checkAllBlogs:"checkAllBlogs",cleanupDataStore:"cleanupDataStore",dataStoreCleanupInterval:"dataStoreCleanupInterval",debugTimeout:"debugTimeout",favicon:"favicon",hideOffscreenAnimations:"hideOffscreenAnimations",indexedDB:"indexedDB",language:"language",noLocalProxyOnLocalhost:"noLocalProxyOnLocalhost",officeMode:"officeMode",optionsKey:"optionsKey",password:"password",peek:"peek",poolSize:"poolSize",postsPerPageStep:"postsPerPageStep",preloadTimeout:"preloadTimeout",title:"title",username:"username"},BLANK_PAGE="about:blank",CHECK_ALL_BLOGS=!!window.location.get(PARAMETERS.checkAllBlogs),CLEANUP_DATASTORE=!!window.location.get(PARAMETERS.cleanupDataStore),DATASTORE_CLEANUP_INTERVAL=parseInt(window.location.get(PARAMETERS.dataStoreCleanupInterval))||0,DEBUG_TIMEOUT=parseInt(window.location.get(PARAMETERS.debugTimeout))||2e3,DEFAULT_TIMEOUT=150,DOWNLOAD_FILENAME_HTML="{0}.html",DOWNLOAD_FILENAME_TEXT="{0}.txt",DOWNLOAD_FILENAME_XML="{0}.xml",DOWNLOAD_SERVERS=["va.media","ve.media","vt","vt.media","vtt"],HIDE_OFFSCREEN_ANIMATIONS=!!window.location.get(PARAMETERS.hideOffscreenAnimations),IDB=!!window.location.get(PARAMETERS.indexedDB),IFRAME_ALLOWED_HOSTS=["youtube.com","youtu.be","youtube-nocookie.com","spotify.com"],NO_LOCAL_PROXY_ON_LOCALHOST=!!parseInt(window.location.get(PARAMETERS.noLocalProxyOnLocalhost)),OFFICE_MODE=window.parseInt(window.location.get(PARAMETERS.officeMode))||0,PEEK=!!window.location.get(PARAMETERS.peek),POOL_SIZE=parseInt(window.location.get(PARAMETERS.poolSize))||6,POSTS_PER_PAGE_STEP=parseInt(window.location.get(PARAMETERS.postsPerPageStep))||5,PRELOAD_TIMEOUT=parseInt(window.location.get(PARAMETERS.preloadTimeout))||DEFAULT_TIMEOUT,PROXIES={local:"Local CORS Proxy",remote:"allOrigins"},STORAGE_NAME_OPTIONS=window.location.get(PARAMETERS.optionsKey)||"my_tumblr",THEME_ID="pageTheme",THEMECOLOR_ID="themeColor",VIBRATIONS={DEFAULT:[100],NEW_BLOGS_FOUND:[100,100,100]},XMLHTTPDOWNLOAD=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest&&window.URL,APP_CUSTOM_TOKEN,DATASTORE3_API_KEY="AIzaSyA4dckJaCSBB1R7gJVuWCeYXjr7P6Oi9DM",DATASTORE_ID=7537,FULLHD={height:1080,horizontalImage:"images/fullHD.png",width:1920,verticalImage:"images/fullHDv.png"},HD={height:720,horizontalImage:"images/hd.png",width:1280,verticalImage:"images/hdv.png"},IDLE_INTERVAL=3e5,MAXIMUM_DOWNLOAD_FILENAME=160,OLD_BLOG_INTERVAL=7776e6,STORAGE_NAME_READLATER="my_tumblr_readLater",STORAGE_NAME_USELESS="my_tumblr_useless",PASSWORD=window.location.get(PARAMETERS.password),TABLE_DATES="dates",TABLE_DOWNLOADS="downloads",TABLE_READLATER="readLater",TABLE_USELESS="useless",USERNAME=window.location.get(PARAMETERS.username),VALUE_DOWNLOADS_COUNT="_count",VALUE_DOWNLOADS_DATE="_date",VALUE_DOWNLOADS_SIZE="_size",textTables={en:{activeDownloads:"Active downloads ({0})",add:"Add",addBlog:"Add to my blogs",addToReadLater:"Add to read later list",addUseless:"Add as globally useless entry",addUseless2:"Add as globally useless entry:",ago:"{0} ago",alreadyDownloadedFrom:"{0}\nDownloaded from {1}\non {2}",alreadyAutomaticallyDownloadedFrom:"{0}\nAutomatically downloaded from {1}\non {2}",archive:"Archive",ascending:"ascending",asked:"{0} asked:",audioTitle:"{0} - {1} (from {2})",autoUpdatedBlogs:"Auto-corrected blogs: {0}",autoUpdatePostCountMismatches:"Auto-correct post count mismatches",autoUpdatingPostCountMismatches:"Auto-correcting post count of {0}",avatarSize:"Avatar size:",blogNotFound:"Cannot find blog '{0}'.",blogRecovered:"Blog '{0}' is online again!",blogRedundant:"NSFW state for '{0}' is redundant.",blogStatistics:"Statistics",blogTitle:"{0} ({1} posts)",cancel:"Cancel",change:"Change",changePassword:"Change password",checkUselessPosts:"Auto check for useless posts",confirmAddBlog:"Are you sure you want to add '{0}' to your blogs?",confirmAddToReadLater:"Are you sure you want to add '{0}' to your 'Read Later' blogs?",confirmClearReadLater:"Are you sure you want to remove all the 'Read Later' blogs?",confirmDisableBlog:"Are you sure you want to disable '{0}'?",confirmEnableBlog:"Are you sure you want to re-enable '{0}'?",confirmNewPassword:"Confirm password:",confirmRemoveFromGlobalUseless:"Are you sure you want to remove '{0}' from the global useless entries?",confirmRemoveFromReadLater:"Are you sure you want to remove '{0}' from the 'Read Later' blogs?",connect:"Connect",cssFilters:{blur:"Blur",brightness:"Brightness",contrast:"Contrast",dropShadow:"Drop shadow",grayScale:"Gray scale",hueRotation:"Hue",invert:"Invert colors",opacity:"Opacity",saturate:"Saturation",sepia:"Sepia effect"},customGifControls:"Use custom controls for GIF images",customVideoControls:"Use custom video controls",databaseError:"Cannot open database: {0}",dataStorageChangingPassword:"Changing password...",dataStorageConnected:"Connected",dataStorageConnecting:"Connecting...",dataStorageDownloaded:"Data downloaded ({0})",dataStorageDownloading:"Downloading latest data",dataStorageInvalidPassword:"The specified password is not correct.",dataStorageInvalidUsername:"The specified e-mail address is not correct.",dataStoragePasswordChanged:"Password for {0} changed successfully.",dataStorageReset:"Data storage reset",dataStorageUpdated:"Data storage updated",dateIntervalOptions:{day:" day",days:" days",hour:" h",hours:" h",includeMilliseconds:!1,millisecond:undefined,milliseconds:undefined,minute:" m",minutes:" m",month:" month",months:" months",second:" s",seconds:" s",separator:", ",week:" week",weeks:" weeks",year:" year",years:" years"},deleteAll:"Delete all",descending:"descending",disableBlog:"Disable this blog",downloadAsHTML:"Download as HTML",downloadAsText:"Download as text",downloadAsXml:"Download as XML",downloadCompleted:"{0}: download completed ({1}).",downloading:"Downloading '{0}'...",downloadingDownloads:"Updating downloads...",downloadProgress:"{2} ({0}) of {1} downloaded\ncurrent speed: {3}/s, average: {4}/s, maximum: {5}/s\nelapsed: {8}\nestimated total time: {9}, remaining: {10}",downloadProgressWithWait:"{2} ({0}) of {1} downloaded\ncurrent speed: {3}/s, average: {4}/s, maximum: {5}/s\nelapsed: {7}, waited: {6}, total: {8}\nestimated total time: {9}, remaining: {10}",downloads:"Downloads",downloadsInPage:"{1} downloads in page {0}",downloadsInProgress:"One or more download is still in progress.",downloadsSynchronized:"Downloads synchronized ({0}).",downloadsUpToDate:"Downloads list already up-to-date",downloadSynchronization:"Download synchronization:",downloadSynchronization_ask:"Ask",downloadSynchronization_skip:"Skip",downloadSynchronization_synchronize:"Synchronize",duration:"{0}:{1}",emailAddress:"E-mail address:",embeddedIFrameText:"Page is loading. If it does not appear after a while try to view it directly in your browser by clicking the link.",embedLinks:"Embed links",embedVideos:"Embed videos",enableBlog:"Re-enable this blog",enableFullScreenViewer:"Enable full-page view",enableFullScreenViewerFullScreen:"Enable true full screen view",enableImageSearch:"Enable image search",expandTags:"Expand tags",findDownloads:"Search",firstPostOn:"First post on",followers:"Followers:",forceNSFW:"Force NSFW:",forceNSFW_NoForce:"Don't force",forceNSFW_NSFW:"Force NSFW",forceNSFW_SFW:"Force SFW",fromNow:"{0} from now",goTo:"Go to:",goToLastViewedPage:"Last viewed page",goToPage:"Go to page:",hideOldies:"Hide oldies",imageResolution:"Images' resolution:",imageSize:"Photo size:",imageSize_alwaysBest:"Always use highest resolution",imageSize_alwaysSmall:"Always use small resolution",imageSize_alwaysMicro:"Always use smallest resolution",imageSize_best:"Use highest resolution",imageSize_micro:"Use smallest resolution",imageSize_small:"Use small resolution",later:"Later",lastUpdatedOn:"Last updated on",lastViewed:"Last viewed: {0} ago",lastViewedOn:"Last viewed",lessThanZero:"{0}+",likes:"Likes:",link:"Link",loadingBlogs:"Loading {0} blogs...",loadingBlogsProgress:"Checking {0} / {1} blogs...\n{2} downloaded",loadingData:"Downloading latest data...",loadingPage:"Loading page {0}...",loginRequired:"Login required",more:"More...",more2:"{0} more",my:"My",nativeDownload:"Use native download",never:"Never",newBlogs:"Updated blogs: {0}\nNew posts: {1}",newBlogsStatus:"{0}: {1} (SFW: {2}, NSFW: {3})\nNew posts: {4} (SFW: {5}, NSFW: {6})\nLast updated: {7}\non {8}\n({9})\nLast viewed: {10}\non {11}\n({12})",newBlogsStatusTitle:"Updated blogs",newBlogsTitle:"Updated {0} / {1}:",newPassword:"New password:",newPasswordMismatch:"Please correctly confirm the new password.",newPasswordRequired:"Please specify the new password.",newPosts:"New posts: ",newPostsSuffix:"{0} new",newPostsTitle:"({0} / {1})",no:"No",noActiveDownload:"No active download",noBlog:"No blog for the current user",noDownloadsInPage:"No downloads in page {0}",noNewPost:"No new post",nonNewBlogsStatus:"{0}: {1} (SFW: {2}, NSFW: {3})\nTotal posts: {4} (SFW: {5}, NSFW: {6})\nLast updated: {7}\non {8}\n({9})\nLast viewed: {10}\non {11}\n({12})\nChanged: {13}",notAvailable:"N/A",notes:"({0} notes)",notFoundBlogs:"Not found ({0}):",now:"Now",nsfw:"NSFW:",nsfwOnly:"NSFW blogs only",ok:"OK",oldBlogs:"Oldies ({0}):",oldBlogsStatusTitle:"Oldies",oldPassword:"Current password:",oldPasswordRequired:"Please specify the current password.",options:"Options",pageNumber:"Page {0} / {1}",pageNumber2:"Page {0} / {1} / {2}",pageTitle:"My tumblr.",password:"Password:",passwordRequired:"Please provide a password.",peekMode:"Peek mode",percent:"{0}%",photoIndex:"Photo #{0}",posts:"Posts: ",postsPerDay:"Average posts per day",postsPerPage:"Posts per page:",postTypes:{"":"All posts",answer:"Answers",audio:"Audio",chat:"Chats",link:"Links",photo:"Photos",quote:"Quotes",text:"Texts",video:"Videos"},preloadImages:"Preload images",preloadImages2:"Preload images:",preloadImages_DontPreload:"Never preload",preloadImages_Preload:"Always preload",readBlogs:"Read ({0}):",readBlogsStatusTitle:"Read blogs",readLater:"Read later ({0})",readLaterTitle:"To read",refreshCurrentPage:"Refresh current page",rememberMe:"Save access",removeUseless:"Remove from global useless entries",requireDownloadsSynchronization:"Synchronize downloads list?",reset:"Reset",searching:"Searching...",searchingInPage:"Searching in page {0}...",searchingInPage2:"Searching in page {0}/{1}...",searchingInPage3:"{0} ({1}/{2})\nPage {3}/{4}...",searchTag:"Search tag:",seen:"Seen: {0}",seenPosts:"Posts when seen: {0}",showAllImageSizes:"Show all image sizes",showMissingDownloads:"Show missing downloads count\ninstead of already downloaded count",showNotes:"Show notes",showNSFWBlogs:"Show NSFW blogs",showPosts:"Show posts:",showTags:"Show tags",size:"{0} x {1}",sort:{name:"Name",posts:"Posts",updated:"Last update",viewed:"Last viewed"},sortBy:"Sort by:",sortByPosts:"Sort by number of new posts",synchronizingDownloads:"Synchronizing downloads...",taggedPosts:"{0}\nPosts tagged '{1}'",theme:"Theme:",three:"{0} / {1} / {2}",threeFrom:"{0} ({1}, from {2})",totalPosts:"Total posts",two:"{0} / {1}",two2:"{0} - {1}",two3:"{0} ({1})",two4:"{0}\n{1}",two5:"{0}, {1}",twoFrom:"{0} (from {1})",typedPosts:"{0} ({1} {2} posts)",unknown:"???",unknownAlbum:"Unknown album",unknownArtist:"Unknown artist",unknownDownloadProgress:"{0} downloaded\ncurrent speed: {3}/s, average: {4}/s, maximum: {5}/s\nelapsed: {8}",unknownDownloadProgressWithWait:"{0} downloaded\ncurrent speed: {3}/s, average: {4}/s, maximum: {5}/s\nelapsed: {7}, waited: {6}, total: {8}",unknownTrackName:"Unknown track name",updated:"Updated: {0}",upgradingDatabase:"Upgrading database...",usageMode:"Usage mode",usageModes:{car_daily:"Car (day)",car_nightly:"Car (night)",home_daily:"Home (day)",home_nightly:"Home (night)",office:"Office",outside_daily:"Outside (day)",outside_nightly:"Outside (night)"},useDefault:"Use default setting",usernameRequired:"Please specify a valid e-mail address.",version:"Version: {0}",vibrateOnCheckCompletion:"Vibrate on loading completion",view:"View",viewDownloads:"Downloads in page ({0}/{1})",viewed:"Viewed: {0}",waitingForDownloads:"Waiting for downloads...",yes:"Yes"},it:{activeDownloads:"Download in corso ({0})",add:"Aggiungi",addBlog:"Aggiungi ai miei blog",addToReadLater:"Aggiungi ai blog da leggere più tardi",addUseless:"Aggiungi come filtro globale",addUseless2:"Aggiungi come filtro globale:",ago:"{0} fa",alreadyDownloadedFrom:"{0}\nScaricato da {1}\nil {2}",alreadyAutomaticallyDownloadedFrom:"{0}\nScaricato automaticamente da {1}\nil {2}",archive:"Archivio",ascending:"ascendente",asked:"{0} ha chiesto:",audioTitle:"{0} - {1} (da {2})",autoUpdatedBlogs:"Blog corretti automaticamente: {0}",autoUpdatePostCountMismatches:"Correggi automaticamente\ngli errori sul numero di post",autoUpdatingPostCountMismatches:"Correzione automatica del numero di post di {0}",avatarSize:"Dimensione avatar:",blogNotFound:"Blog '{0}' non trovato.",blogRecovered:"'{0}' è di nuovo disponibile!",blogRedundant:"Lo stato NSFW per '{0}' è ridondante.",blogStatistics:"Statistiche",blogTitle:"{0} ({1} post)",cancel:"Annulla",change:"Cambia",changePassword:"Cambio password",checkUselessPosts:"Controlla automaticamente post filtrati",confirmAddBlog:"Aggiungere '{0}' ai blog?",confirmAddToReadLater:"Aggiungere '{0}' ai blog da leggere più tardi?",confirmClearReadLater:"Cancellare tutti i blog da leggere più tardi?",confirmDisableBlog:"Disabilitare '{0}'?",confirmEnableBlog:"Ri-abilitare '{0}'?",confirmNewPassword:"Conferma password:",confirmRemoveFromGlobalUseless:"Rimuovere '{0}' dai filtri globali?",confirmRemoveFromReadLater:"Rimuovere '{0}' dai blog da leggere più tardi?",connect:"Entra",cssFilters:{blur:"Sfocatura",brightness:"Luminosità",contrast:"Contrasto",dropShadow:"Ombreggiatura",grayScale:"Scala di grigi",hueRotation:"Tonalità",invert:"Inversione colori",opacity:"Opacità",saturate:"Saturazione",sepia:"Effetto seppia"},customGifControls:"Usa controlli personalizzati per le immagini GIF",customVideoControls:"Usa controlli video personalizzati",databaseError:"Impossibile aprire il database: {0}",dataStorageChangingPassword:"Cambio password in corso...",dataStorageConnected:"Connesso",dataStorageConnecting:"Connessione in corso...",dataStorageDownloaded:"Dati scaricati ({0})",dataStorageDownloading:"Aggiornamento dei dati...",dataStorageInvalidPassword:"La password specificata non è corretta.",dataStorageInvalidUsername:"L'indirizzo e-mail specificato non è corretto.",dataStoragePasswordChanged:"Password per {0} cambiata.",dataStorageReset:"Dati reimpostati",dataStorageUpdated:"Dati aggiornati",dateIntervalOptions:{day:" giorno",days:" giorni",hour:" h",hours:" h",includeMilliseconds:!1,millisecond:undefined,milliseconds:undefined,minute:" m",minutes:" m",month:" mese",months:" mesi",second:" s",seconds:" s",separator:", ",week:" settimana",weeks:" settimane",year:" anno",years:" anni"},deleteAll:"Cancella tutti",descending:"discendente",disableBlog:"Disabilita questo blog",downloadAsHTML:"Scarica come HTML",downloadAsText:"Scarica come testo",downloadAsXml:"Scarica come XML",downloadCompleted:"{0}: download completato ({1}).",downloading:"Download di '{0}' in corso...",downloadingDownloads:"Aggiornamento lista dei download...",downloadProgress:"{2} ({0}) di {1} scaricati\nvelocità: {3}/s, media: {4}/s, massima: {5}/s\ntrascorso: {8}\ntempo totale stimato: {9}, rimanente: {10}",downloadProgressWithWait:"{2} ({0}) di {1} scaricati\nvelocità: {3}/s, media: {4}/s, massima: {5}/s\ntrascorso: {7}, in attesa: {6}, totale: {8}\ntempo totale stimato: {9}, rimanente: {10}",downloads:"Download",downloadsInPage:"{1} download in pagina {0}",downloadsInProgress:"Ci sono ancora dei download attivi.",downloadsSynchronized:"Download aggiornati ({0}).",downloadsUpToDate:"Lista dei download già aggiornata",downloadSynchronization:"Sincronizzazione download:",downloadSynchronization_ask:"Chiedi",downloadSynchronization_skip:"Salta",downloadSynchronization_synchronize:"Sincronizza",duration:"{0}:{1}",emailAddress:"Indirizzo e-mail:",embeddedIFrameText:"La pagina è in caricamento. Se non viene correttamente visualizzata provare a visualizzarla direttamente nel browser cliccando sul collegamento.",embedLinks:"Incorpora i collegamenti",embedVideos:"Incorpora i video",enableBlog:"Ri-abilita questo blog",enableFullScreenViewer:"Abilita vista a tutta pagina",enableFullScreenViewerFullScreen:"Abilita vista a schermo intero",enableImageSearch:"Abilita ricerca per immagine",expandTags:"Espandi i tag",findDownloads:"Cerca",firstPostOn:"Iniziato",followers:"Seguito da:",forceNSFW:"Forza stato NSFW:",forceNSFW_NoForce:"Non forzare",forceNSFW_NSFW:"Forza NSFW",forceNSFW_SFW:"Forza SFW",fromNow:"Fra {0}",goTo:"Vai a:",goToLastViewedPage:"Ultima pagina vista",goToPage:"Vai alla pagina:",hideOldies:"Nascondi i blog vecchi",imageResolution:"Qualità delle immagini:",imageSize:"Dimensioni foto:",imageSize_alwaysBest:"Usa sempre risoluzione più alta",imageSize_alwaysMicro:"Usa sempre risoluzione più bassa",imageSize_alwaysSmall:"Usa sempre risoluzione ridotta",imageSize_best:"Usa risoluzione più alta",imageSize_micro:"Usa risoluzione più bassa",imageSize_small:"Usa risoluzione ridotta",later:"Più tardi",lastUpdatedOn:"Ultimo aggiornamento",lastViewed:"Visto: {0} fa",lastViewedOn:"Visto",lessThanZero:"{0}+",likes:"Piace:",link:"Link",loadingBlogs:"Caricamento di {0} blog...",loadingBlogsProgress:"Aggiornamento blog {0} / {1}...\n{2} scaricati",loadingData:"Aggiornamento dei dati...",loadingPage:"Caricamento pagina {0}...",loginRequired:"Login necessario",more:"Altri...",more2:"Altri {0}",my:"Il mio",nativeDownload:"Usa download nativo",never:"Mai",newBlogs:"Blog aggiornati: {0}\nNuovi post: {1}",newBlogsStatus:"{0}: {1} (SFW: {2}, NSFW: {3})\nNuovi post: {4} (SFW: {5}, NSFW: {6})\nUltimo aggiornamento: {7}\nil {8}\n({9})\nUltima visita: {10}\nil {11}\n({12})",newBlogsStatusTitle:"Blog aggiornati",newBlogsTitle:"Aggiornati {0} / {1}:",newPassword:"Nuova password:",newPasswordMismatch:"Confermare correttamente la nuova password.",newPasswordRequired:"Inserire la nuova password.",newPosts:"Nuovi post: ",newPostsSuffix:"{0} nuovi",newPostsTitle:"({0} / {1})",no:"No",noActiveDownload:"Nessun download",noBlog:"Nessun blog per l'utente corrente",noDownloadsInPage:"Nessun download in pagina {0}",noNewPost:"Nessun nuovo post",nonNewBlogsStatus:"{0}: {1} (SFW: {2}, NSFW: {3})\nPost totali: {4} (SFW: {5}, NSFW: {6})\nUltimo aggiornamento: {7}\nil {8}\n({9})\nUltima visita: {10}\nil {11}\n({12})\nCambiati: {13}",notAvailable:"N/D",notes:"({0} note)",notFoundBlogs:"Non trovati ({0}):",now:"Adesso",nsfw:"NSFW:",nsfwOnly:"Solo blog NSFW",ok:"OK",oldBlogs:"Vecchi ({0}):",oldBlogsStatusTitle:"Blog vecchi",oldPassword:"Password corrente:",oldPasswordRequired:"Inserire la password corrente.",options:"Opzioni",pageNumber:"Pagina {0} / {1}",pageNumber2:"Pagina {0} / {1} / {2}",pageTitle:"Il mio tumblr.",password:"Password:",passwordRequired:"Inserire la password.",peekMode:"Visualizza soltanto",percent:"{0}%",photoIndex:"Foto #{0}",posts:"Post: ",postsPerDay:"Post al giorno",postsPerPage:"Post per pagina:",postTypes:{"":"Tutti i post",answer:"Domande",audio:"Audio",chat:"Chat",photo:"Foto",link:"Collegamenti",quote:"Citazioni",text:"Testi",video:"Video"},preloadImages:"Precarica le immagini",preloadImages2:"Precarica le immagini:",preloadImages_DontPreload:"Non precaricare mai",preloadImages_Preload:"Precarica sempre",readBlogs:"Letti ({0}):",readBlogsStatusTitle:"Blog letti",readLater:"Leggi più tardi ({0})",readLaterTitle:"Da leggere",refreshCurrentPage:"Aggiorna pagina corrente",rememberMe:"Ricorda accesso",removeUseless:"Rimuovi dai filtri globali",requireDownloadsSynchronization:"Aggiornare la lista dei download?",reset:"Reimposta",searching:"Ricerca in corso...",searchingInPage:"Ricerca in corso in pagina {0}...",searchingInPage2:"Ricerca in corso in pagina {0}/{1}...",searchingInPage3:"{0} ({1}/{2})\nPagina {3}/{4}...",searchTag:"Cerca tag:",seen:"Visitato: {0}",seenPosts:"Post quando visitato: {0}",showAllImageSizes:"Mostra dimensioni delle foto",showMissingDownloads:"Mostra il numero di donwload mancanti\ninvece che di quelli già scaricati",showNotes:"Mostra note",showNSFWBlogs:"Mostra blog NSFW",showPosts:"Tipo di post:",showTags:"Mostra tag",size:"{0} x {1}",sort:{name:"Nome",posts:"Numero di post",updated:"Ultimo aggiornamento",viewed:"Ultima visualizzazione"},sortBy:"Ordina per:",sortByPosts:"Ordina per numero di nuovi post",synchronizingDownloads:"Sincronizzazione download...",taggedPosts:"{0}\nPost taggati '{1}'",theme:"Tema:",three:"{0} / {1} / {2}",threeFrom:"{0} ({1}, da {2})",totalPosts:"Post totali",two:"{0} / {1}",two2:"{0} - {1}",two3:"{0} ({1})",two4:"{0}\n{1}",two5:"{0}, {1}",twoFrom:"{0} (da {1})",typedPosts:"{0} ({1} {2} post)",unknown:"???",unknownAlbum:"Album sconosciuto",unknownArtist:"Artista sconosciuto",unknownDownloadProgress:"{0} scaricati\nvelocità: {3}/s, media: {4}/s, massima: {5}/s\ntrascorso: {8}",unknownDownloadProgressWithWait:"{0} scaricati\nvelocità: {3}/s, media: {4}/s, massima: {5}/s\ntrascorso: {7}, in attesa: {6}, totale: {8}",unknownTrackName:"Brano sconosciuto",updated:"Aggiornato: {0}",upgradingDatabase:"Aggiornamento database...",usageMode:"Modo d'uso",usageModes:{car_daily:"Auto (giorno)",car_nightly:"Auto (notte)",home_daily:"Casa (giorno)",home_nightly:"Casa (notte)",office:"Ufficio",outside_daily:"Fuori (giorno)",outside_nightly:"Fuori (notte)"},useDefault:"Usa impostazione predefinita",usernameRequired:"Inserire un indirizzo e-mail.",version:"Versione: {0}",vibrateOnCheckCompletion:"Vibra a caricamento completato",view:"Vedi",viewDownloads:"Download nella pagina ({0}/{1})",viewed:"Visto: {0}",waitingForDownloads:"In attesa dei download...",yes:"Sì"}};$().ready(function(){var e,d={autoUpdatePostCountMismatches:!0,avatarSize:5,downloadSynchronization:"ask",customGifControls:!1,customVideoControls:!0,embedLinks:!0,embedVideos:!1,enableFullScreenViewer:!0,enableFullScreenViewerFullScreen:!1,enableImageSearch:!0,hideOldies:!0,imageSize:"small",lastPassword:String.empty,lastUsername:String.empty,nativeDownload:!0,nsfw:!0,peekMode:!1,postsPerPage:tumblr.MAX_POSTS_PER_PAGE/2,postType:String.empty,preloadImages:!1,rememberMe:!1,searchNSFWOnly:!1,showAllImageSizes:!1,showMissingDownloads:!1,showNotes:!1,showTags:!0,sortByPosts:!0,theme:15,vibrateOnCheckCompletion:!1},wt=function(){var t=$(".downloadsProgressDialog"),n={maximumFractionDigits:1,minimumFractionDigits:1},i=t.find(".downloadList"),e=function(){var n=i.children().length;t.find(".noActiveDownload")[n?"fadeOut":"fadeIn"]();t.dialog("option","title",r("activeDownloads",n));ei(n)},f=function(n){window.clearInterval(n.updateProgressInterval);n.response&&n.updateProgress({lengthComputable:!0,loaded:n.response.size,total:n.response.size});n.progressElement.fadeOut("slow",function(){n.progressElement.remove();e()})};$(window).on({beforeunload:function(){if(i.children().length)return u("downloadsInProgress")}});return{count:function(){return i.children().length},downloadPost:function(o,s){var c,h,s;if(XMLHTTPDOWNLOAD&&(s&&s.length||(s=o.download_url),s&&s.length)){h=new window.XMLHttpRequest;h.addEventListener("abort",function(){f(this)});h.addEventListener("load",function(){var u,n,i;this.status===200?(u=formatFileSize(this.response.size),n=$(document.createElement("a")).attr({download:this.downloadFileName,href:window.URL.createObjectURL(this.response)}).hide().appendTo(t),n.get(0).click(),n.remove(),$.toast.message(r("downloadCompleted",this.downloadText,u)),f(this)):(i=new FileReader,i.addEventListener("load",function(){$.toast.error($(this.result).text());f(h)}),i.readAsText(this.response));at(!1)});h.addEventListener("progress",h.updateProgress=function(t){var s,f,o,i=$.now(),e,h,u;this.started||(this.started=i);t?(t.loaded&&!this.actuallyStarted&&(this.actuallyStarted=i),this.lastEvent=t):t=this.lastEvent;this.lastRate===undefined||i-this.lastDate>=1e3?(e=(t.loaded-this.lastSize||t.loaded)/((i-this.lastDate||i)/1e3),f=t.loaded/((i-this.actuallyStarted)/1e3),o=Math.max(ii(this.lastMaximumRate),e),this.lastRate=e=ii(e),this.lastGlobalRate=f=ii(f),this.lastMaximumRate=o=ii(o),this.lastDate=i,this.lastSize=t.loaded):(e=this.lastRate,f=this.lastGlobalRate,o=this.lastMaximumRate);u=[formatFileSize(t.loaded,n),undefined,undefined,formatFileSize(e||0,n),formatFileSize(f||0,n),formatFileSize(o||0,n),ut(h=(this.actuallyStarted||this.started)-this.started,!0),ut(i-(this.actuallyStarted||this.started),!0),ut(i-this.started,!0),undefined,undefined];t.lengthComputable&&(this.progressBar.progressbar("option","max",t.total),this.progressBar.progressbar("option","value",t.loaded),s=ii((t.total-t.loaded)/f)*1e3,u[1]=formatFileSize(t.total,n),u[2]=r("percent",(Math.roundTo(t.loaded/t.total*100,2)||0).toLocaleString(undefined,n)),u[9]=ut((this.actuallyStarted?i-this.actuallyStarted:0)+s,!0),u[10]=ut(s,!0));u.splice(0,0,(t.lengthComputable?"downloadProgress":"unknownDownloadProgress")+(h>2e3?"WithWait":String.empty));this.progressLabel.html(yt(r.apply(this,u)))});h.open("GET",yi(s));h.responseType="blob";h.progressElement=$(document.createElement("li")).append(h.linkElement=$(document.createElement("a")).addClass("downloadProgress").attr({download:c=ct(o,s),href:s,target:"_blank",title:ft(o,s)}).on({click:function(n){n.preventDefault()}}).text(li(o,s))).append(h.progressLabel=$(document.createElement("div")).addClass("downloadProgressLabel")).append(h.progressBar=$(document.createElement("div")).addClass("downloadProgressBar").progressbar({value:!1})).append($(document.createElement("button")).addClass("cancelDownload").attr({type:"button"}).on({click:function(){h.abort();f(h)}}).button({label:u("cancel")})).appendTo(i);e();$($.toast.message(r("downloading",h.downloadText=li(o,s)))).on({click:function(){}});at(!0);et(s,o);h.downloadFileName=c;h.updateProgress({lengthComputable:!0,loaded:0,total:0});h.updateProgressInterval=window.setInterval($.proxy(h.updateProgress,h),3*DEFAULT_TIMEOUT);h.send()}}}}(),c=function(){var s="key",e="my_tumblr_alldownloads",i="my_tumblr_downloads",o,n,f=$.Deferred();(function(){if(window.indexedDB||(window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB),window.IDBTransaction||(window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction),window.IDBKeyRange||(window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange||window.msIDBKeyRange),window.indexedDB)try{var n=window.indexedDB.open(i,3);n.onerror=function(n){$.toast.error(r("databaseError",n));f.reject(n)};n.onsuccess=function(n){o=n.target.result;f.resolve(o)};n.onupgradeneeded=function(){$.toast.message(u("upgradingDatabase"));try{var n=event.target.result;try{n.deleteObjectStore(i)}catch(t){}try{n.deleteObjectStore(e)}catch(t){}n.createObjectStore(i,{keyPath:s});n.createObjectStore(e,{keyPath:s})}catch(t){$.toast.error(t.message);f.reject(t);throw t;}}}catch(t){$.toast.error(t.message);f.reject(t)}else f.reject()})();var h=function(n,t){return $.Deferred(function(r){try{t=t||i;var f=o.transaction([t]),e=f.objectStore(t),u=e.get(n);u.onerror=function(n){$.toast.error(n);r.reject(n)};u.onsuccess=function(){r.resolve(u.result?u.result.value:undefined)}}catch(s){$.toast.error(s.message)}})},t=function(){return f.promise()},c=function(n,t,r){return $.Deferred(function(u){var f;try{r=r||i;var c=o.transaction([r],"readwrite"),l=c.objectStore(r),e={value:t};e[s]=n;f=l.put(e);f.onerror=function(n){$.toast.error(n);u.reject(n)};f.onsuccess=function(){u.resolve(f.result)}}catch(h){$.toast.error(h.message);u.reject(h)}})};return{add:function(i,r){if(IDB)return $.when(t()).then(function(){});n[i]=r},contains:function(i){return IDB?$.when(t()).then(function(){}):!!n[i]},"delete":function(i){if(IDB)return $.when(t()).then(function(){});delete n[i]},get:function(i){return IDB?$.when(t()).then(function(){}):n[i]},getCount:function(){return IDB?$.when(t()).then(function(){}):n[VALUE_DOWNLOADS_COUNT]},getDate:function(){var i;return IDB?$.when(t()).then(function(){}):((i=n[VALUE_DOWNLOADS_DATE])&&i.length&&!isNaN(parseInt(n[VALUE_DOWNLOADS_COUNT]))&&(i=new Date(i)),i&&!i.getTime&&(i=new Date(i)),i)},getSize:function(){return IDB?$.when(t()).then(function(){}):n[VALUE_DOWNLOADS_SIZE]},load:function(){if(!IDB){var r=window.localStorage.getItem(i);if(r&&r.length)n=window.JSON.parse(r);else return $.Deferred(function(r){$.when(t()).then(function(){$.when(h(i,e)).then(function(t){n=t?window.JSON.parse(t):{};r.resolve()},r.reject)},function(){n={};r.resolve()})})}},save:function(){if(!IDB)return $.Deferred(function(r){var u=function(){try{window.localStorage.setItem(i,f);r.resolve()}catch(n){r.reject(n)}},f=window.JSON.stringify(n);$.when(t()).then(function(){$.when(c(i,f,e)).then(function(){try{window.localStorage.removeItem(i);r.resolve()}catch(n){r.reject(n)}},u)},u)})},store:function(i){if(IDB)return $.when(t()).then(function(){});n=i},update:function(){var i=(new Date).toISOString(),r=$.props(n).length-3,u=window.JSON.stringify(n).length;if(IDB)return $.when(t()).then(function(){});n[VALUE_DOWNLOADS_DATE]=i;n[VALUE_DOWNLOADS_COUNT]=r;n[VALUE_DOWNLOADS_SIZE]=u}}}(),ot={},p,ru=!!window.location.hostname.match(/localhost/i),uu=0,si,n=$.extend({},d),st,h,f,w,fu=[{_icon:"home",name:"home_daily",options:{imageSize:"best",nsfw:!0,theme:18}},{_icon:"home-filled",name:"home_nightly",options:{imageSize:"best",nsfw:!0,theme:23}},{_icon:"cars",name:"car_daily",options:{imageSize:"small",nsfw:!0,theme:7}},{_icon:"car",name:"car_nightly",options:{imageSize:"small",nsfw:!0,theme:23}},{_icon:"summer",name:"outside_daily",options:{imageSize:"small",nsfw:!0,theme:18}},{_icon:"moon",name:"outside_nightly",options:{imageSize:"micro",nsfw:!0,theme:23}},{_icon:"organization",name:"office",options:{imageSize:"small",nsfw:!1,theme:15}},{_icon:"close",name:"cancel"}],o,bf=function(n){a($(".uselessDialog").attr({title:document.title}).find(".uselessText").val(n).end(),{buttons:[{click:function(){var n=$(".uselessDialog").find(".uselessText").val();n&&n.length&&(n=n.toLowerCase(),$.inArray(n,o.map(function(n){return n.test?n.source:n}))<0&&(o=o||[],o.push(n),br(o,!0)),$(this).dialog("close"))},text:u("ok")},{click:function(){$(this).dialog("close")},text:u("cancel")}],destroyOnClose:!0,width:"auto"})},fr=function(n){if(n&&n.length){for(n=window.location.noProtocol(n).toLowerCase();n&&n.length&&n[n.length-1]==="/";)n=n.substr(0,n.length-1);if(n&&n.length)return $.when($.confirm(r("confirmAddToReadLater",n),undefined,[u("yes"),u("no")])).then(function(){var t;if($.inArray(n,h)<0)return t=h||[],t.push(n),tr(t,!0)})}return $.Deferred(function(n){n.reject()}).promise()},bt=function(t){return $.Deferred(function(i){var a=window.sessionStorage.getItem("blog"),v=nt(a),f=pu(window.sessionStorage.getItem("blog")),o=f==="micro",u=$("#blogPage"),h=u.width(),s=$(window).height()*.8,y=wu(a),c,e,l;t?i.resolve():(ot={},u.find(".photo").each(function(n,t){var u=(t=$(this)).data("post"),e,c,i;u&&(e=parseInt(t.data("index")),c=u.photos[e],i=er(f,u,e,h,s),i.url!==t.attr("src")&&(t.off().attr({alt:i.url,"has-src":String.empty,src:String.empty,title:r("size",c.original_size.width,c.original_size.height)}).data({src:i.url}),t.css({height:o?i.height:"auto","min-height":o?undefined:"1em",width:o?i.width:"auto","min-width":o?undefined:"1em"})))}),u.find(".blogPost").add(u.find(".blogPost img")).add(u.find(".blogPost video")).add(u.find(".blogPost iframe"))[f==="micro"?"addClass":"removeClass"]("micro"),u.find(".embeddedVideoContainer").each(function(n,t){var i=(t=$(this)).data("post");cu(f,i,h,s).addClass("embeddedVideo").appendTo(t.empty());t.find("a").each(function(n,t){rt($(t))})}),e=$(),l=u.find("[has-src]"),l=l.filter(function(n,t){var i=$(t);return i.closest(".newPost").length+i.closest(".firstNonNewPost").length&&(e=e.add(i)),i.data("src")&&!i.attr("src")}).each(function(n,t){it(t)}),y&&e.length?window.setTimeout(function(){var n=[];e.each(function(t,i){var u,r,t;if(!(i=$(i)).closest(".useless").length){if(u=i.data("post"),u&&(r=u.photos)&&r.length)for(t=0;t<r.length;t++)if(window.location.noProtocol(r[t].original_size.url)===window.location.noProtocol(i.data("src"))){r[t].alt_sizes&&r[t].alt_sizes.length&&i.data({src:er(f,u,t,h,s).url});break}n.push(it(i,!0));ur(i)}});i.resolve();$.when.apply(this,n).always(ti)},window.DEBUG?DEBUG_TIMEOUT:0):$.when(ti()).always(function(){i.resolve()}));u.find(".tagsButton")[n.showTags&&!v.expandTags?"show":"hide"]();u.find(".expandedTag")[n.showTags&&v.expandTags?"show":"hide"]();u.find(".imageSizesButton")[n.showAllImageSizes?"show":"hide"]();u.find(".fullScreenButton")[n.enableFullScreenViewer?"show":"hide"]();u.find(".notes")[n.showNotes?"show":"hide"]();$(".downloadFileButton").button("option","icons",{primary:n.nativeDownload?"ui-icon-arrowthickstop-1-s":"ui-icon-extlink"});$(".downloadFileButton").each(function(n,t){var i=(t=$(t).find(".ui-button-text")).html();i&&i.length||t.html("&nbsp;")});$(".downloadFileButton2").button("option","icons",{primary:n.nativeDownload?"ui-icon-extlink":"ui-icon-arrowthickstop-1-s"});c=u.find("video").css({"max-height":s+"px"});hu(c);it(c);rf()}).promise()},eu=function(t,i){var u=tumblr.AVATAR_SIZES[n.avatarSize],f=$("#blogs"),e,o=[],h=0,c=0,s=0,l=0;$("head").append($(document.createElement("style")).attr({type:"text/css"}).text(String.format("#blogs .blogTitle { width: {0}px; } .webui-popover:not(.webui-popover-mainPopoverContent) .webui-popover-content { max-height: {1}px; }",parseInt($(".snap-drawer").css("width"))-(u+28+window.scrollbars.height),$(window).height()*.5)));f.find(".blog").each(function(t,i){var e,p,v,a=$(i),r=a.data("info"),f=a.find(".avatar"),y=!0;if(r.exists){if((!n.nsfw&&r.nsfw||n.hideOldies&&r.isOld)&&(y=!1),a[y?"show":"hide"](),y){if(e=r.avatarURLs[u],r.custom_avatars){f.addClass("customAvatar").data({"avatar-url":e,"custom-avatar-url":p="images/avatars/{0}/{1}.{2}".format(u,r.name,r.custom_avatars.length?r.custom_avatars:"png")}).on({mouseenter:function(n){$(n.target).attr({src:$(n.target).data("avatar-url")})},mouseleave:function(n){$(n.target).attr({src:$(n.target).data("custom-avatar-url")})}});e=p}else f.removeClass("customAvatar").off("mouseenter mouseleave");if(f.attr("src")!==e){if(r.nsfw){v="images/avatars/standard-nsfw/{0}.png".format(u);f.attr({crossOrigin:"anonymous"}).one({error:function(n){$(n.target).removeAttr("crossOrigin").attr("src",v)},load:function(){ue(this)&&$(f).addClass("standardNSFWAvatar").data({"avatar-url":e,"standard-avatar-url":v}).on({mouseenter:function(n){$(n.target).attr({src:$(n.target).data("avatar-url")})},mouseleave:function(n){$(n.target).attr({src:$(n.target).data("standard-avatar-url")})}}).attr({alt:v,src:v})}})}f.on({load:function(){f.removeClass("ui-state-error")},error:function(){f.addClass("ui-state-error")}}).attr({alt:e,src:e}).css({height:u,width:u})}a.hasClass("oldBlog")?s++:a.hasClass("newBlog")?o.push(a):l++}}else r.isOld&&(a[n.hideOldies&&typeof r.blog.data.disabled=="boolean"?"hide":"show"](),s++),r.isAlert?h++:typeof r.blog.data.disabled!="string"&&c++});f.find(".alertBlogsHeader").find(".text").first().text(r("notFoundBlogs",h));i&&(wf(o,!0),e=f.find(".newBlogsHeader"),$(o).each(function(n,t){e.after(t);e=t}));f.find(".readBlogsHeader").find(".text").first().text(r("readBlogs",l));f.find(".oldBlogsHeader").find(".text").first().text(r("oldBlogs",s)).end().end()[n.hideOldies?"hide":"show"]();f.find(".notFoundBlogsHeader").find(".text").first().text(r("notFoundBlogs",c));pr();t||vf(function(n){!(n.newBlogs||n.newPosts)||window.sessionStorage.getItem("blog")||$(n.target).closest(".toast").hasClass("noSnapperOnClick")||window.setTimeout(function(){$(".snapper").trigger("click")})})},ou=function(t){var i=$.extend({},n),u,f,r;n=t;pt();su();(t.avatarSize!==i.avatarSize||t.hideOldies!==i.hideOldies||t.sortByPosts!==i.sortByPosts||t.nsfw!==i.nsfw)&&eu(t.hideOldies===i.hideOldies&&t.nsfw===i.nsfw,t.sortByPosts!==i.sortByPosts);t.showMissingDownloads!==i.showMissingDownloads&&ei();t.postType!==i.postType?(window.sessionStorage.removeItem("blogPage"),window.sessionStorage.removeItem("blogTag"),ki()):t.postsPerPage!==i.postsPerPage||t.embedLinks!==i.embedLinks||t.embedVideos!==i.embedVideos||t.customGifControls!==i.customGifControls?(t.postsPerPage!==i.postsPerPage&&(u=window.sessionStorage.getItem("blog"),r=parseInt(window.sessionStorage.getItem("blogPage")),u&&!isNaN(r)?($(p).each(function(n,t){if(t.url===u)return f=t,!1}),r=Math.floor(r*parseFloat(i.postsPerPage)/parseFloat(t.postsPerPage)),f&&(f.page=r),window.sessionStorage.setItem("blogPage",r)):window.sessionStorage.removeItem("blogPage")),ki()):(t.imageSize!==i.imageSize||t.preloadImages!==i.preloadImages&&t.preloadImages||t.enableFullScreenViewer!==i.enableFullScreenViewer||t.showTags!==i.showTags||t.showAllImageSizes!==i.showAllImageSizes||t.showNotes!==i.showNotes||t.nativeDownload!==i.nativeDownload||t.customVideoControls!==i.customVideoControls)&&bt(!(t.imageSize!==i.imageSize||t.preloadImages!==i.preloadImages&&t.preloadImages))},su=function(){$(document.body)[n.peekMode?"addClass":"removeClass"]("peekMode")},g=function(n,t){return n&&n.data&&n.data.hide&&n.data.hide.length&&$(n.data.hide).each(function(n,i){try{t=t.replace(new RegExp(i,"i"),function(n){return'<div class="autoHide">'+n+"<\/div>"})}catch(r){}}),t},it=function(n,t){if((n=$(n)).length>1)n.each(function(n,i){it(i,t)});else if(n.is("video"))n.on({play:function(n){var i=$(n.target).closest(".blogPost").data("post"),t;i&&(t=i.video_url);t&&t.length||(t=$(this).attr("src"));t&&t.length&&et(t,i)}});else return $.Deferred(function(i){var r=lr(n);t||r.off(".loader");r.on({"error.loader":function(){!t&&n.attr("src")&&(n.removeClass("ui-state-highlight").addClass("lazyLoaded").addClass("transitionable").removeClass("loading").addClass("ui-state-error"),nu(n),yu(r));i.reject()},"load.loader":function(){t||(n.removeClass("ui-state-error").removeClass("ui-state-highlight").addClass("lazyLoaded").addClass("transitionable").addClass("loaded").removeClass("loading"),nu(n),yu(r,!0));i.resolve()}})}).promise()},hu=function(t){if(n.customVideoControls)t.video().on({"mutechanged volumechanged":function(n){n.target.muted?window.sessionStorage.removeItem("videoUnmuted"):window.sessionStorage.setItem("videoUnmuted",!0);window.sessionStorage.setItem("videoVolume",n.target.volume.toString())},durationchange:function(n){try{n.target.muted=!window.sessionStorage.getItem("videoUnmuted")}catch(n){}try{n.target.volume=parseFloat(window.sessionStorage.getItem("videoVolume"))}catch(n){}$(n.target).video("update")}});else t.video("destroy").attr({controls:!0})},er=function(n,t,i,r,u,f){var s,e,o;if(!f)if(wi(t.photos[i].original_size.url))t.photos.length>3&&(r/=3),u=u*.8;else switch(n){case"best":u=0}if(e=t.getBestFitPhotoIndex(i,r,u),o=t.photos[i].alt_sizes,f)switch(n){case"best":s=t.photos[i].original_size;break;case"small":e>0&&e--;break;default:if($.isPlainObject(n))return n}else switch(n){case"best":e>0&&e--;break;case"micro":e=o.length-1}return s||o[e]},cu=function(n,t,i,r,u){var h,e,o=0,f,c;if(u||n!=="micro")if(u&&n==="best")o=t.player.length-1;else{for(o=0,e=t.player.length-1;e>=0;e--)if(c=parseInt($(s(t.player[e].embed_code)).attr("height"))||0,t.player[e].width<=i&&(!c||c<=r)){o=e;break}(u||n==="best")&&o<t.player.length-1&&o++}if((h=t.player[o].embed_code)&&h.length){try{f=$(s(h))}catch(l){f=$(document.createElement("video")).attr("src",t.video_url)}f.is("video")&&(f.attr({controls:!0}),t.video_url&&t.video_url.length&&f.data({post:t}));f.find("a").add(f.is("a")?f:undefined).attr({target:"_blank"})}return f||$()},kt=function(n){kr();si&&(window.clearTimeout(si),si=0);n||($(".blogHeader").hide(),$(".blogPageTitle").empty(),$(".blogNavigator").hide());$("#blogPage").empty().removeData("posts");ot={};or(0)},or=function(n){var t=$(document.body),i=parseInt(t.data("loading"))||0,n=parseInt(n),r=function(n){var t=$("#favicon").add("#shortcutIcon");t.attr("href",n?"../images/loader.gif":t.data("icon"))};isNaN(n)||(t.data({loading:i+n}),n>0?i===0&&(t.addClass("loading"),r(!0)):n<0?i+n===0&&(t.removeClass("loading"),r()):(t.removeClass("loading").removeData("loading"),r()))},lu=function(){window.sessionStorage.removeItem("blog");window.sessionStorage.removeItem("blogLoginRequired");window.sessionStorage.removeItem("blogPage");window.sessionStorage.removeItem("blogTag");window.sessionStorage.removeItem("blogTitle");window.sessionStorage.removeItem("startupDates");window.sessionStorage.removeItem("dates");window.sessionStorage.removeItem("blogInfos");e=undefined},au=function(t,i){var u=ct(i),r=$(document.createElement("a")).addClass("downloadInfoButton").attr({download:u,href:i.download_url,target:"_blank"}).on({click:function(n){n.preventDefault()}}).button({icons:{primary:"ui-icon-info"},text:!1}).appendTo(t);return r.after($(document.createElement("span")).addClass("webui-popover-content").attr({downloadURL:i.download_url,downloadTitle:ft(i)}).append($(document.createElement("button")).addClass("setDownload").attr({type:"button"}).data({popover:r,post:i}).on({click:function(n){var t=$(n.target).closest(".ui-button"),i=t.data("post");t.data("popover").webuiPopover("hide");et(i.download_url,i)}}).button({icons:{primary:"ui-icon-check"},text:!1})).append($(document.createElement("button")).addClass("resetDownload").attr({type:"button"}).data({popover:r,post:i}).on({click:function(n){var t=$(n.target).closest(".ui-button"),i=t.data("post");t.data("popover").webuiPopover("hide");et(i.download_url,i,!1,!0)}}).button({icons:{primary:"ui-icon-cancel"},text:!1})).append($(document.createElement("a")).addClass("downloadFileButton2").attr({download:u,href:i.download_url,target:"_blank",title:ft(i)}).data({popover:r,post:i}).on({click:function(t){var i=$(t.target).closest(".ui-button"),r=i.data("post");i.data("popover").webuiPopover("hide");n.nativeDownload&&(t.preventDefault(),wt.downloadPost(r))}}).button({icons:{primary:n.nativeDownload?"ui-icon-extlink":"ui-icon-arrowthickstop-1-s"},text:!1}))),r.find(".ui-button-text").html("&nbsp;").end().webuiPopover({animation:"fade",onShow:function(n){$.when(lt($(n).find("[downloadURL]").attr("downloadURL"))).then(function(t){n.addClass("ui-widget-content").css({"background-color":$("#content").css("background-color")});n.find(".webui-popover-title").html(yt($(n).find("[downloadTitle]").attr("downloadTitle")));n.find(".setDownload").add(n.find(".downloadFileButton2"))[t?"addClass":"removeClass"]("downloaded");n.find(".resetDownload")[t?"removeClass":"addClass"]("downloaded")})},width:Math.max($(window).width()*.25,180)}),r},kf=function(n,t){var i=(n=$(n)).parent();t&&t.length||(t=n.data("src"));i.attr("id")||i.attr({id:"_"+window.guid()});n.attr({"rel:animated_src":yi(t)});i.on({click:function(n){n.preventDefault()}});lc_gif_player("#"+i.attr("id"),!0,String.empty,["fullscreen"])},vu=function(n){var s,t,i,o,f;o=(t=window.location.noProtocol((n=$(n)).attr("href"))).split("/");o[0].match(/.tumblr./i)&&(t.match(/.tumblr.com\/blog\/view\//i)?(t=o[3]+".tumblr.com",f=t):t.match(/www.tumblr.com\//i)?(t=o[1]+".tumblr.com",f=t):f=t=o[0],i=[{attr:{title:u("blogStatistics")},click:function(){tu(t)},icon:"ui-icon-info"},{attr:{href:window.tumblr.getArchiveURL(t),title:u("archive")},dontPrevent:!0,icon:"ui-icon-suitcase"},{attr:{title:u("view")},click:function(){$.when(sr(t)).then(function(n){vt(n)})},icon:"ui-icon-search"}],du(f)?(n.addClass("useless-link"),i.push({attr:{title:u("removeUseless")},click:function(){ve(f)},icon:"ui-icon-circle-check"})):i.push({attr:{title:u("addUseless")},click:function(){bf(f)},icon:"ui-icon-circle-close"}),$.inArray(t,$(e).props())<0?(i.push({attr:{title:u("addBlog")},click:function(){$.when($.confirm(r("confirmAddBlog",t),undefined,[u("yes"),u("no")])).then(function(){k(t,{url:t})})},icon:"ui-icon-star"}),i.push({attr:{title:u("addToReadLater")},click:function(){fr(t)},icon:"ui-icon-clock"})):s="ui-state-highlight",i.length===6&&(i[3].wrap=!0),n.addClass("blogLink").after(dt({icon:"ui-icon-triangle-1-s",items:i}).addClass(s)))},dt=function(n){n=n||{};var i=$(document.createElement("button")).addClass("popoverButton").addClass(n.className).attr({type:"button"}).button({icons:{primary:n.icon||"ui-icon-info"},label:n.title,text:!!(n.title&&n.title.length)}),t=$(document.createElement("div")).addClass("noSnapperOnClick").addClass(n.text?"textPopover":undefined).on({click:function(n){if($(n.target).closest("a").length===0||$(n.target).closest("a").attr("href")==="#")return n.preventAll()}}),r=function(t,u){$(u).each(function(u,f){var e;if($.isFunction(f))e=f();else if(f.type&&f.type.length&&f.type!=="button")e=f;else if(f.items&&f.items.length)t.append($(document.createElement("div")).addClass("popTitle").text(f.text)),r(e=$(document.createElement("div")),f.items);else{e=$(document.createElement(n.text||f.dontPrevent?"a":"button")).addClass(n.text?undefined:"popoverInnerButton").addClass(f.className);e.attr($.extend({href:e.is("a")?"#":undefined,type:e.is("a")?undefined:"button"},f.attr)).data($.extend({},f.data,{popoverItem:f,parentPopover:i})).on({click:function(n){var i=$(n.target).closest(".popoverInnerButton"),t=i.data("popoverItem");return t.keepOpen||i.data("parentPopover").webuiPopover("hide"),t.dontPrevent||n.preventDefault(),t.click?t.click(n):void 0}});e.is("a")&&f.dontPrevent&&rt(e);n.text?e.text(f.text):e.button({icons:{primary:f.icon||"ui-icon-info"},label:f.text,text:!!(f.text&&f.text.length)})}$.isPlainObject(f)&&f.wrap&&t.append($(document.createElement("br")));t.append(n.text?$(document.createElement("div")).addClass("popoverInnerButton").data(e.data()).append(f.icon&&f.icon.length?$(document.createElement("span")).append($(document.createElement("i")).addClass("ui-icon").addClass(f.icon)):undefined).append($(document.createElement("div")).append(e)):e)})};return n.popTitle&&n.popTitle.length&&t.append($(document.createElement("div")).addClass("popTitle").text(n.popTitle)),r(t,n.items),i.webuiPopover({animation:"fade",content:t,onShow:function(t){if($(t).addClass("ui-widget-content").css({"background-color":$("#content").css("background-color")}),n.onShow)n.onShow(t)},width:"auto"})},hi=function(){var n=new window.tumblr;return n.proxy=bu(),n},yu=function(n){var u=n.data("hostName"),t,r=n.data("queueKey"),i,f=$.now();u&&u.length&&r&&r.length&&(i=(t=ot[u])[r],n.data({deferTime:i.deferred?i.started-i.enqueued:undefined,loadTime:f-i.started,totalTime:i.deferred?f-i.enqueued:undefined}),delete t[r],t.count--,t.loading--,t.count&&t.loading<POOL_SIZE&&$(t).eachProp(function(n,i){if($.isPlainObject(i)&&!i.loading)return vr(i,t),!1}))},rt=function(t){if((t=$(t)).length&&(t.attr({target:"_blank"}),n.embedLinks))t.on({click:function(t){var i=$(t.target).closest("a"),u=i.text()||i.attr("title")||document.title,r=i.attr("href");if(r&&r.length){if(t.which===1&&n.embedLinks)return af(r,u),t.preventAll()}else return t.preventAll()}});return t},df=function(n,t){var i={enqueued:$.now(),image:n,key:window.guid(),src:t},r,u=window.location.noProtocol(t).split("/")[0];ot[u]||(ot[u]={count:0,loading:0,name:u});r=ot[u];r[i.key]=i;++r.count<=POOL_SIZE?vr(i,r):i.deferred=!0},de=function(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},sr=function(n){return $.Deferred(function(t){var u=hi(),i=u.getBlog(e[n=window.location.noProtocol(n).toLowerCase()]||n);$.when(i.getInfo()).then(function(n){n.exists?(n.blog=i,t.resolve(n)):!bi({url:i.url})&&u.isLoginSupported?$.when(i.getInfo(!0)).then(function(u){u.exists?(u.blog=i,t.resolve(u)):($.toast.error(r("blogNotFound",n.name)),t.reject())},t.reject):($.toast.error(r("blogNotFound",n.name)),t.reject())},t.reject)}).promise()},y=function(n,t){var r=ht(n),i;return t?(i=window.sessionStorage.getItem("startupDates"),i&&i.length&&(i=$.parseJSON(window.decodeURIComponent(i)),i[r]))?i[r]:undefined:(e||{})[r]},ht=function(n){for(var t=window.location.noProtocol(n);t.length&&t[t.length-1]==="/";)t=t.substr(0,t.length-1);return t},nt=function(n){var t=(y(n)||{}).options||String.empty;return t?(!$.isPlainObject(t)&&t.length&&(t=$.parseJSON(window.decodeURIComponent(t))),t):{}},ci=function(){return $($("#content").css("overflow")==="visible"?"#blogPageContainer":"#content")},ut=function(n,t){return t&&n>0&&(n=Math.max(n,1e3)),window.formatDateInterval(n,w.dateIntervalOptions)},tt=function(n){var t;return(t=(n=n||0)<0)&&(n=-n),n>0?r(t?"fromNow":"ago",ut(n)):u("now")},hr=function(n){var t,u,o,r,i,e;if(e=window.location.noProtocol(n),(t=c.get(r=f.getKey(e)))||(t=c.get(r=f.getKey(e).replace(/%20/gi," "))),t)return $.extend({},t,{key:r});for(i=f.getKey(e).split(/[_\W]/);i.length&&i[0].toLowerCase()!=="tumblr";)i.splice(0,1);if(i.length)for(r=f.getKey(i.join("/")),u=0;u<DOWNLOAD_SERVERS.length;u++)if(t=c.get(o=f.getKey(DOWNLOAD_SERVERS[u]+"/"+r)))return $.extend({},t,{key:o})},ct=function(n,t){return cr(n,t,"fileName")},cr=function(n,t,i){var c=n.blog||e[ht(window.location.noProtocol(n.post_url).split("/")[0])],o,v=function(n,t){var i="...";return t>i.length&&(n=n||String.empty).length>t&&(n=n.substr(0,t-i.length)+i),n},l=String.empty,f,y,a=i==="fileName",p,w,k,s,h,b;return t=t||n.download_url,f=window.location.noHash(t.split("/").pop()),!a&&lt(t)&&(o=hr(t)),k||((y=f.lastIndexOf("."))>=0&&(l=f.substr(y)).length&&(f=f.substr(0,f.length-l.length)),a&&(h=oi(c.title)),n&&(s=n.summary)&&s.length&&(c&&c.download_filters&&c.download_filters.length&&$(c.download_filters).each(function(n,t){s=$.trim(s.replace(new RegExp(t,"i"),String.empty))}),b=!!s.length),b?(w=MAXIMUM_DOWNLOAD_FILENAME-f.length-(p=(MAXIMUM_DOWNLOAD_FILENAME-f.length)*2/3),f=r(h&&h.length?"threeFrom":"two3",v(s[0].toUpperCase()+s.substr(1),p),f,v(h,w))):h&&h.length&&(f=r("twoFrom",f,h)),o&&i==="title"&&(f=r(o.auto?"alreadyAutomaticallyDownloadedFrom":"alreadyDownloadedFrom",f,o.source&&o.source.length?o.source:u("unknown"),new Date(o.downloaded)))),a?oi(f+l):f},li=function(n,t){return cr(n,t,"text")},ft=function(n,t){return cr(n,t,"title")},pu=function(t,i){var r,u;if(t&&t.length){if(!i&&(r=nt(t),r&&r.imageSize&&r.imageSize.length))return r.imageSize;if(OFFICE_MODE!==0&&(u=!1,$(p).each(function(n,i){if(i.url&&i.url.length&&i.url===t)return u=i.nsfw,!1}),u))return"micro"}return n.imageSize},gf=function(n,t){return new Date((y(n,t)||{}).seen||0)},ne=function(n,t){return(y(n,t)||{}).seenPosts||0},l=function(n,t){return new Date((y(n,t)||{}).date||0)},gt=function(n,t){return new Date((y(n,t)||{}).viewed||0)},ai=function(n,t){return(y(n,t)||{}).posts||0},te=function(n,t){return(y(n,t)||{}).title},u=function(n){var i=w,t;for(n=n.split("."),t=0;t<n.length-1;t++)i=i[n[t]];return i[n.pop()]||String.empty},lr=function(n){var t;return(t=n=$(n)).is("img")||(t=n.closest("audio")).length||(t=n.closest("video")).length||(t=n),t},vi=function(t){var i=n.postType;return i&&i.length?(t.posts_per_type||{})[i]||0:t.posts},ie=function(n){var t;switch(n.type){case"photo":t="image";break;case"video":t="video";break;case"text":t="text";break;case"answer":t="help";break;case"quote":t="comment";break;case"link":t="link";break;case"chat":t="person";break;case"audio":t="volume-on";break;default:t="alert"}if(t&&t.length)return $(document.createElement("span")).addClass("postImage").addClass("ui-icon").addClass("ui-icon-"+t)},wu=function(t){if(t&&t.length){var i;if(i=nt(t),i&&i.preloadImages&&i.preloadImages.length)switch(i.preloadImages){case"preload":return!0;case"dontPreload":return!1}}return n.preloadImages},yi=function(n){var t=bu();return window.location.sameProtocol(t.url.format(window.location[t.noProtocol?"noProtocol":"sameProtocol"](n)))},bu=function(){return PROXIES[!NO_LOCAL_PROXY_ON_LOCALHOST&&ru?"local":"remote"]},pi=function(n){return n.requestFullscreen||n.mozRequestFullScreen||n.webkitRequestFullscreen},ni=function(){return $.toast({close:!0,toast:".statusToast"})},re=function(){var n=!1;return $(".ui-dialog-content").each(function(t,i){if($(i).dialog("isOpen"))return n=!0,!1}),n},wi=function(n){return!!n.match(/\.gif$|\.apng$/i)},lt=function(n,t){var i=hr(n);return t&&(t.download=i),!!i},bi=function(n){var t=function(n){return $.inArray(window.location.noProtocol(n).split("/")[0],$(e).props())>=0};return t(n.url)?!0:n.blogURL&&n.blogURL.length?t(n.blogURL):void 0},ku=function(n){return $.inArray(window.location.noProtocol(n).split("/")[0].toLowerCase(),h||[])>=0},ar=function(n){switch(n.type){case"audio":case"photo":return!0;case"video":return n.html5_capable;default:return n.photos&&n.photos.length}},ue=function(n){var f=document.createElement("canvas"),e=[238,238,238],o=f.getContext("2d"),r=n.naturalHeight,u=function(n){n*=4;for(var t=0;t<e.length;t++)if(s[n+t]!==e[t])return!1;return!0},t,s,i=n.naturalWidth,h=Math.trunc(Math.min(i,r)/6);for(f.width=i,f.height=r,o.drawImage(n,0,0),s=o.getImageData(0,0,i,r).data,t=0;t<=h;t++)if(!u(t*(i+1))||!u(t*(i-1))||!u(t+i*(r-t-1))||!u(i*(r-t)-t-1))return!1;return!0},du=function(n){if(o&&o.length)for(var t=0;t<o.length;t++)if(o[t].test||(o[t]=new window.RegExp(o[t],"i")),o[t].test(n))return!0;return!1},gu=function(n,t,i){var f=n.html?n.html():n,r,u;if(du(f)||n.html&&n.find("a.useless-link").length>0)return!0;if(t&&t.data&&t.data.useless&&t.data.useless.length)for(r=0;r<t.data.useless.length;r++)if(t.data.useless[r].test||(t.data.useless[r]=new window.RegExp(t.data.useless[r],"i")),t.data.useless[r].test(f))return!0;if(i&&i.tags&&i.tags.length&&t&&t.data&&t.data.useless_tags&&t.data.useless_tags.length)for(r=0;r<t.data.useless_tags.length;r++)for(t.data.useless_tags[r].test||(t.data.useless_tags[r]=new window.RegExp(t.data.useless_tags[r],"i")),u=0;u<i.tags.length;u++)if(t.data.useless_tags[r].test(i.tags[u]))return!0;return!1},at=function(n){var t=!1;t=n?uu++==0:--uu==0;t&&$("#keepAlive").get(0)[n?"play":"pause"]()},vt=function(t,i){var r;i?r=parseInt(window.sessionStorage.getItem("blogPage")):(window.sessionStorage.removeItem("blogPage"),window.sessionStorage.removeItem("blogTag"));kt(!0);ni();uf(t);$(".blogNavigator").each(function(i,u){$(u).empty().show().append($(document.createElement("button")).addClass("firstPage").attr({type:"button"}).button({icons:{primary:r?"ui-icon-arrowthickstop-1-w":"ui-icon-refresh"},text:!1}).on({click:function(){b(t,0)}})).append($(document.createElement("button")).addClass("previousPage").attr({type:"button"}).button({disabled:!r,icons:{primary:"ui-icon-arrowthick-1-w"},text:!1}).on({click:function(){b(t,Math.max(t.blog.page-1,0))}})).append($(document.createElement("span")).addClass("pageIndex").append($(document.createElement("span")).addClass("content"))).append($(document.createElement("button")).addClass("nextPage").attr({type:"button"}).data({"original-icon":"ui-icon-arrowthick-1-e"}).button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1}).on({click:function(){b(t,t.blog.page+1)}})).append($(document.createElement("button")).addClass("lastPage").attr({type:"button"}).button({icons:{primary:"ui-icon-arrowthickstop-1-e"},text:!1}).on({click:function(){b(t,Math.max(Math.ceil(vi(t)/n.postsPerPage),1)-1)}}))});window.sessionStorage.setItem("blogTitle",t.title);window.sessionStorage.setItem("blog",t.url);window.sessionStorage[t.blog&&t.blog.data&&t.blog.data.login_required?"setItem":"removeItem"]("blogLoginRequired",!0);r=parseInt(window.sessionStorage.getItem("blogPage"));isNaN(r)&&(r=undefined);b(t,r)},b=function(t,i,u){var f=t.blog,e,o=$("#blogPage");return i=Math.max(i||0,0),e&&(i=Math.min(i,e-1)),window.loader.value(!1),window.loading(function(){var s=0;return $.when(f.getPosts(i,t,n.postType,n.postsPerPage,window.sessionStorage.getItem("blogTag"))).then(function(h){var v=!!window.sessionStorage.getItem("blogTag")&&!!window.sessionStorage.getItem("blogTag").length||!!n.postType&&!!n.postType.length,p=l(t.url,!0),c,y=0,a,w=!1;return e=Math.max(Math.ceil(vi(t)/n.postsPerPage),1),kt(!0),$(".blogNavigator").find(".firstPage").button("option","icons",{primary:i?"ui-icon-arrowthickstop-1-w":"ui-icon-refresh"}),$(".blogNavigator").find(".previousPage").button(i?"enable":"disable"),$.Deferred(function(l){window.setTimeout(function(){var b=[],k=[];$(h).each(function(n,t){(t.sticky?k:b).push(t)});h=b;o.data({posts:h});$(h).each(function(n,t){var i,u;p.getTime()<t.timestamp.getTime()?(t.isNewPost=!0,s++):y++;t.type==="video"&&t.duration&&(i=Math.floor((t.duration=Math.ceil(t.duration))/60).toLocaleString(),u=(t.duration%60).toLocaleString(),i.length<2&&(i=0..toLocaleString()+i),u.length<2&&(u=0..toLocaleString()+u),t.durationText=r("duration",i,u))});y?s&&(t.postsDifference=i*n.postsPerPage+s):t.postsDifference=vi(t)-ai(t.url,!0);t.postsDifference>0?c=s&&i*n.postsPerPage+s>t.postsDifference?-(i+1):Math.ceil(t.postsDifference/n.postsPerPage):s&&(c=-(i+1));t.newPages=c;uf(t,h,s,i);v||n.peekMode||$.keyboard.isPressed("p")||bi(t)&&$.when(gr(t.title,t.url,!i||!h.length?t.updated:h[0].timestamp,t.posts-i*n.postsPerPage,i,u,t.is_nsfw,t.blog.data.login_required)).then(function(){pr(t)});window.setTimeout(function(){var b,u=[];window.sessionStorage.setItem("blogPage",f.page=i);$(".pageIndex").find(".newImage").remove();$(".pageIndex").find(".content").text(c&&!v?r("pageNumber2",i+1,c<0?r("lessThanZero",Math.abs(c)):Math.abs(c),e):r("pageNumber",i+1,e));s>0&&$(".pageIndex").find(".content").before(ri(y>0));a=$(document.createElement("div")).appendTo(o);$(k).each(function(n,r){u.push(nf(f,a,r,i,t.postsDifference,s,h.length,v))});$(h).each(function(n,r){r.isNewPost||(b=!0,w&&($(document.createElement("hr")).appendTo(a),$(document.createElement("hr")).appendTo(a)));u.push(nf(f,a,r,i,t.postsDifference,s,h.length,v));w=r.isNewPost});$.when.apply(this,$(u).filter(function(n){return!!n}).toArray()).always(function(){$.when(bt()).then(function(){var o=$(".nextPage"),u=function(n){o.removeClass("ui-state-highlight").each(function(t,i){$(i).find(".ui-button-icon-primary").removeClass("ui-icon-loader-16").removeClass($(i).data("current-icon")).addClass(n&&n.length?n:$(i).data("original-icon"));n&&n.length?$(i).data({"current-icon":n}):$(i).removeData("current-icon")})};window.setTimeout(kr);b||!h.length?u():t.postsDifference&&(si=window.setTimeout(function(){o.addClass("ui-state-highlight").each(function(n,t){$(t).find(".ui-button-icon-primary").removeClass($(t).data("original-icon")).removeClass($(t).data("current-icon")).addClass("ui-icon-loader-16")});$.when(f.getPosts((i+1)*n.postsPerPage,undefined,n.postType,1,window.sessionStorage.getItem("blogTag"))).then(function(t){t.length?$(t).each(function(t,f){var o=!!$(h).filter(function(n,t){return t.id===f.id}).length||p.getTime()<f.timestamp.getTime();return $.when(lt(f.download_url)).then(function(n){u(o?"ui-icon-arrowthick-1-e-new"+(f.type==="video"&&f.download_url&&f.download_url.length&&!n?"-blue":String.empty):undefined)}),o||($(".newPostsSuffix").text(r("newPostsSuffix",(i+1)*n.postsPerPage)),$(".postIndex").each(function(t,u){u=$(u);u.text(r("two2",u.data("postIndex")+1,(i+1)*n.postsPerPage))}),$(".pageIndex").find(".content").text(r("three",i+1,i+1,e))),!1}):u()},function(){u()})},DEFAULT_TIMEOUT*5));l.resolve()})})},DEFAULT_TIMEOUT)},DEFAULT_TIMEOUT)}).promise()},function(){t.isLoginSupported&&!f.data.login_required&&(f.data.login_required=!0,b(t,i,u))})},r("loadingPage",i+1)).then(function(){})},fe=function(){return window.loader.cancelable(!1),window.loader.value(!1),window.loading(function(){return $.afterTimeout(function(){var f=0,t;return $.when(function(){var s,h=0,u,c=[],b=0,y=$.now(),a=0,v,o=hi(),w=function(){window.loader.value(a);window.loader.message(r("loadingBlogsProgress",a,s.length,formatFileSize(h,{maximumFractionDigits:1,minimumFractionDigits:1})))};if(e)if((v=window.sessionStorage.getItem("blogInfos"))&&v.length)o=hi(),$(p=$.parseJSON(window.decodeURIComponent(v))).each(function(n,t){t.updated=new Date(t.updated);t.blogURL&&($(o.getBlog(t.blogURL)).eachProp(function(n,i){$.isFunction(i)&&(t.blog[n]=i)}),f++)}),$(".keepAlive").prop("autoplay")&&$(".keepAlive").get(0).pause();else return s=[],(u=window.location.get(PARAMETERS.blogs))!==undefined&&function(){var t=[],n,i;for(u=u.split(/\W+/),n=0;n<u.length;n++)i=parseInt(u[n]),isNaN(i)||t.push(i);u=t.length?t:undefined}(),$(e).eachProp(function(t,r){var f=!r.booooring,h=r.force_nsfw||r.was_nsfw&&r.force_nsfw===undefined,e;if(f&&OFFICE_MODE!==0)switch(OFFICE_MODE){case 1:f=n.nsfw||!h;break;case 2:f=!h}if(f&&(f=CHECK_ALL_BLOGS||r.disabled==="auto"||!r.disabled&&(!r.login_required||o.isLoginSupported)),f&&u&&u.length)for(f=!1,e=0;e<u.length;e++)if(u[e]===i){f=!0;break}f&&(r=$.extend({},r),delete r.posts,s.push(o.getBlog(r)))}),window.loader.value(0),window.loader.maximum(s.length),window.loader.message(r("loadingBlogs",s.length)),t=ke(),wr(),window.loader.cancelable(!0),at(!0),$.when($.pool(POOL_SIZE,function(n){if(!window.loader.isCanceled())return s[n]},function(t){return $.when(t.getInfo(CHECK_ALL_BLOGS&&o.isLoginSupported&&t.data.disabled&&!t.data.login_required)).then(function(i){var e,f,u;return h+=i.dataLength+70,a++,w(),i.exists?((t.data.disabled||t.data.login_required&&!o.isLoginSupported)&&$.toast.warning(r("blogRecovered",i.title)),i.postsDifference=i.posts-ai(i.url),i.nsfw=i.force_nsfw!==undefined?i.force_nsfw:i.is_nsfw,l(i.url).getTime()<i.updated.getTime()?(i.postsDifference<=0&&n.autoUpdatePostCountMismatches?(i.toAutoUpdate=!0,f=!0):nt(i.url).checkUselessPosts?u=!0:i.isNew=!0,(f||u)&&(e=$.when(t.getPosts(undefined,i,undefined,u?n.postsPerPage:1)).then(function(n){var r=!1;h+=n.dataLength+70;w();$(n).each(function(n,e){if(f)l(i.url,!0).getTime()<e.timestamp.getTime()&&(i.isNew=!0);else if(u&&l(i.url,!0).getTime()<e.timestamp.getTime()&&!gu(e.body||e.caption||e.description||String.empty,t,e))return r=!0,!1});u&&(r?i.isNew=!0:i.toAutoUpdate=!0)}))):(y-i.updated.getTime()>OLD_BLOG_INTERVAL&&(i.isOld=!0),i.postsDifference&&n.autoUpdatePostCountMismatches&&(i.toAutoUpdate=!0)),i.force_nsfw!==i.is_nsfw||i.no_warn_nsfw_force||$.toast.warning(r("blogRedundant",i.title))):(o.isLoginSupported&&(i.isLoginSupported=!0),i.title=te(i.url)||i.title,y-l(i.url)>OLD_BLOG_INTERVAL&&(i.isOld=!0)),$.when(e).always(function(){i.isNew&&(n.nsfw||!i.nsfw)&&wr(++b);c.push($.extend({},i,{blog:t}))})})})).then(function(){return $.Deferred(function(t){window.setTimeout(function(){var i;wf(c);var u=[],e=[],r=[],o=[],s=[];$(c).each(function(n,t){t.exists||t.blog.data&&t.blog.data.disabled==="auto"?(t.isOld?o.push(t):t.isNew?r.push(t):s.push(t),f++):CHECK_ALL_BLOGS&&t.blog.data&&t.blog.data.disabled?e.push(t):(t.isAlert=!0,u.push(t))});i=[];u.length&&(i.push({"class":"alertBlogsHeader",itemClass:"alertBlog"}),i=i.concat(u));r.length&&(i.push({"class":"newBlogsHeader",itemClass:"newBlog"}),i=i.concat(r));s.length&&(i.push({"class":"readBlogsHeader",itemClass:"readBlog"}),i=i.concat(s));o.length&&(i.push({"class":"oldBlogsHeader",itemClass:"oldBlog"}),i=i.concat(o));e.length&&(i.push({"class":"notFoundBlogsHeader",itemClass:"notFound"}),i=i.concat(e));of(p=i);window.navigator.vibrate&&n.vibrateOnCheckCompletion&&window.navigator.vibrate(VIBRATIONS[r.length?"NEW_BLOGS_FOUND":"DEFAULT"]);t.resolve()},DEFAULT_TIMEOUT)}).promise()}).always(function(){window.loader.cancelable(!1);at(!1)})}()).then(function(){return window.loader.value(!1),window.loader.message(r("loadingBlogs",f)),$.afterTimeout(function(){var f=0,n=$("#blogs"),e=$.now(),i;return kt(),n.parent().scrollTop(0),n.empty(),$(p).each(function(t,i){if(i.url&&i.url.length){var c,b,a,y=gt(i.url),v,h,p,s,w=i.url,o=$(document.createElement("div")).addClass("ui-widget-content").addClass("blog").data({info:i}).appendTo(n);i.disabled&&o.addClass("disabledBlog");i.exists?(v=i.postsDifference,i.nsfw&&o.addClass("nsfwBlog"),i.isNew?o.addClass("newBlog"):i.isOld?o.addClass("oldBlog"):o.addClass("readBlog"),$(document.createElement("img")).addClass("avatar").appendTo(o)):i.isOld&&o.addClass("oldBlog");a=$(document.createElement("span")).addClass("blogTitle").appendTo(o);i.exists?(ri().addClass("newBlog").hide().appendTo(a),$(document.createTextNode(i.title)).appendTo(a)):a=o.addClass("notFound").addClass(i.isAlert?"alert":undefined).addClass("ui-state-error").append($(document.createElement("a")).attr({href:window.location.sameProtocol(i.url),target:"_blank",title:window.location.sameProtocol(i.url)}).text(i.title&&i.title!==i.name?r("two3",i.title,i.url):i.url));a.append(s=$(document.createElement("div")).addClass("dateInfo"));b=i.exists?i.posts:ai(i.url);s.append($(document.createTextNode(u("posts")+b.toLocaleString())));s.append($(document.createElement("br")));i.exists&&(v||i.isNew)&&(o.data({postsDifference:v}),s.append($(document.createTextNode(u("newPosts")))),s.append($(document.createElement("span")).text(v<=0&&i.posts>0?r("lessThanZero",v):v.toLocaleString())),s.append($(document.createElement("br"))));i.exists&&!i.isNew&&i.toAutoUpdate&&($.toast.message(r("autoUpdatingPostCountMismatches",i.title)),gr(i.title,i.url,i.updated,i.posts,0,!0,i.is_nsfw,undefined,!0),f++);c=i.exists?i.updated:l(i.url);c&&c.getTime&&!isNaN(c.getTime())&&(s.append($(document.createTextNode(r("updated",c)))),w+="\n"+r("updated",tt(e-c.getTime())));y.getTime()>0&&(s.append($(document.createElement("br"))).append($(document.createTextNode(r("viewed",y)))),w+="\n"+r("viewed",tt(e-y.getTime())),h=gf(i.url),h&&h.getTime&&!isNaN(h.getTime())&&h.getTime()&&h.getTime()!==y.getTime()&&(s.append($(document.createElement("br"))).append($(document.createTextNode(r("seen",h)))),w+="\n"+r("seen",tt(e-h.getTime())),p=ne(i.url),p&&p!==i.posts&&s.append($(document.createElement("br"))).append($(document.createTextNode(r("seenPosts",p))))));(i.force_nsfw!==undefined||i.is_nsfw)&&a.append($(document.createElement("img")).attr({src:"images/{0}.png".format(i.force_nsfw!==undefined?i.force_nsfw===i.is_nsfw?i.is_nsfw?"nsfw_forced_redundant":"nsfw_sfw_forced_redundant":i.force_nsfw?"nsfw_forced":"nsfw_sfw_forced":i.is_nsfw?"nsfw":undefined)}));o.on({click:function(n){$(n.target).closest("a").length&&n.preventDefault();$(document.body).data("snapper").close();vt(i)}});o.attr({title:w})}else $(document.createElement("div")).addClass("ui-widget-header").addClass(i["class"]).data({info:i}).append($(document.createElement("div")).addClass("text")).appendTo(n)}),function(){i=[];for(var n in w.sort)i.push({by:n,ascending:!0}),i.push({by:n})}(),n.find(".ui-widget-header").off().on({click:function(n){return n.preventAll()}}).each(function(n,t){(t=$(t)).append(dt({className:"noSnapperOnClick",icon:"ui-icon-carat-2-n-s",items:$.map(i,function(n){return{click:function(n){var t=$(n.target).closest(".popoverInnerButton"),u=t.data("item"),e=u.data("info"),i=$.makeArray($("#blogs").find(".blog."+e.itemClass)),r,f=t.data("sortItem");i.sort(function(n,t){var i=0,r=0,u=0;n=$(n).data("info");t=$(t).data("info");try{switch(f.by){case"posts":r=n.posts||0;u=t.posts||0;break;case"updated":r=l(n.url).getTime();u=l(t.url).getTime();break;case"viewed":r=gt(n.url).getTime();u=gt(t.url).getTime()}}catch(e){}return i||r!==u&&(i=r<u?-1:1),i||(n=(n.title||n.name).toLowerCase(),t=(t.title||t.name).toLowerCase(),i=n<t?-1:n>t?1:0),i});f.ascending||i.reverse();r=u;$(i).each(function(n,t){r.after(t);r=t});t.parent().find(".popoverInnerButton").removeClass("ui-state-focus").end().end().addClass("ui-state-focus")},data:{item:t,sortItem:n},icon:"ui-icon-circle-triangle-"+(n.ascending?"n":"s"),keepOpen:!0,text:r("two5",u("sort."+n.by),u(n.ascending?"ascending":"descending"))}}),popTitle:u("sortBy"),text:!0}))}),t&&t.state()==="pending"&&window.loader.message(u("waitingForDownloads")),$.when(t).always(function(){eu(!!window.sessionStorage.getItem("blog"));f>0&&$.toast.message(r("autoUpdatedBlogs",f));ff();ki()})})})})},u("loading"))},vr=function(n,t){t.loading++;n.loading=!0;n.started=$.now();n.image.data({hostName:t.name,queueKey:n.key}).attr({src:n.src})},ki=function(){var n=window.sessionStorage.getItem("blog"),i,t;n&&n.length&&($(p).each(function(t,r){var u;if(r.url===n)return vt(r,!0),(u=$("#blogs").parent().find(".ui-state-focus")).length&&sf(u),i=!0,!1}),i||(t=hi().getBlog(window.location.noProtocol(n).split("/")[0]),window.sessionStorage.getItem("blogLoginRequired")&&(t.data={login_required:!0}),$.when(t.getInfo()).then(function(n){n.exists&&(n.blog=t,vt(n,!0))})))},ee=function(){var t,n=window.location.get(PARAMETERS.language);if(n&&n.length&&(w=textTables[n]),!w)for(t in textTables)w=textTables[n=t];$(fu).each(function(n,t){var i,r;for(i in t)r=t[i],i[0]!=="_"&&typeof r=="string"&&(t[i]=u("usageModes")[r]||u(r))});$(".localizedText").each(function(n,t){var i=$(t);i.html(yt(u(i.data("localizedtext"))))})},ti=function(){var n,i,u=ci(),f=u.height()+u.offset().top,r=[],t=[];n=$("#blogPage").find("[has-src]").filter(function(n,t){var i=(t=$(t)).closest(".blogPost");return i.length&&i.hasClass("collapsed")?!1:t.data("src")&&!t.attr("src")&&!t.hasClass("loading")});i=!!n.filter(function(n,t){return!!($(t).closest(".stickyPost").length+$(t).closest(".newPost").length+$(t).closest(".firstNonNewPost").length)}).length;n.each(function(n,i){lr(i).offset().top<=f&&($.keyboard.isPressed("q")||t.push(i))});t.length&&wu(window.sessionStorage.getItem("blog"))&&(t=n);$(t).each(function(n,t){if(t=$(t),!(i&&!(t.closest(".stickyPost").length+t.closest(".newPost").length+t.closest(".firstNonNewPost").length))){if(i&&r.push(it(t,!0)),t.hasClass("micro")&&!t.closest(".photo").length&&!t.closest(".photo-2").length)t.on({click:function(){$(this).toggleClass("micro")}});ur(t)}});r.length&&$.when.apply(this,r).always(function(){ti()})},oe=function(){var i=window.localStorage.getItem(STORAGE_NAME_OPTIONS),h,u,f,e,o,t,s;if(i&&i.length){i=$.parseJSON(window.decodeURIComponent(i));for(h in n)u=i[h],u!==undefined&&u!==null&&(n[h]=u)}for(ce(),di(),he(),f=$("#options_avatarSize").empty(),$(tumblr.AVATAR_SIZES).each(function(n,t){f.append($(document.createElement("option")).text(r("size",t,t)).val(n))}),f.selectmenu({appendTo:$(".optionsDialog"),open:function(){$(".ui-selectmenu-open").css("z-index",f.closest(".ui-dialog").css("z-index")+1)}}),e=$("#options_postType").empty(),$(tumblr.POST_TYPES).each(function(n,t){e.append($(document.createElement("option")).text(w.postTypes[t.value]).val(t.value))}),e.selectmenu({appendTo:$(".optionsDialog"),open:function(){$(".ui-selectmenu-open").css("z-index",e.closest(".ui-dialog").css("z-index")+1)}}),o=$("#options_postsPerPage").empty(),t=0;t<=tumblr.MAX_POSTS_PER_PAGE;t+=POSTS_PER_PAGE_STEP)t&&o.append($(document.createElement("option")).text(t).val(t));o.selectmenu({appendTo:$(".optionsDialog"),open:function(){$(".ui-selectmenu-open").css("z-index",o.closest(".ui-dialog").css("z-index")+1)}});$("#options_nativeDownload").prop("disabled",!XMLHTTPDOWNLOAD);s=$(".usageModeDialog");$(fu).each(function(n,t){s.append($(document.createElement("button")).attr({title:t.name,type:"button"}).data({mode:t}).on({click:function(n){var t=$(n.target).closest(".ui-button").data("mode").options,r,i;if(t){r=s.data("options");for(i in t)r[i]=t[i]}s.dialog("close")}}).button().append($(document.createElement("img")).attr({src:String.format("images/modes/{0}.png",t._icon)})))});$(".pageOptionsDialog").find(".searchTag").button({icons:{primary:"ui-icon-search"},text:!1}).end().find(".resetTag").button({icons:{primary:"ui-icon-closethick"},text:!1})},se=function(){var f,s=function(){f&&window.clearTimeout(f);f=window.setTimeout(ti,PRELOAD_TIMEOUT)},e=function(){$("#content").css("overflow")==="visible"&&$("#blogPageContainer").css({height:$("#content").height()-$(".header").outerHeight()});s()},t,i;ee();t=window.location.get(PARAMETERS.title);document.title=t&&t.length?unescape(t):u("pageTitle");i=window.location.get(PARAMETERS.favicon);i&&i.length&&$("#favicon").add($("#shortcutIcon")).attr({href:window.decodeURIComponent(i)});$("#favicon").add($("#shortcutIcon")).data({icon:$("#favicon").attr("href")});$(".header").find(".loader").button({icons:{primary:"ui-icon-loader-16"},text:!1});$(".optionsDialog").attr({title:u("options")}).find(".version").text(function(){var i=window.document.getElementsByTagName("script"),t,n;if(i.length&&(n=i[i.length-1].getAttribute("src").split("?"),n.length>1&&(n=window.parseArguments(n[1]).v,n&&n.length)))return t=new Date("{0}-{1}-{2}".format(n.substr(0,4),n.substr(4,2),n.substr(6,2))),r("version",isNaN(t.getTime())?n:t.toLocaleDateString?t.toLocaleDateString():t.toLocaleString())}());$(".title").find("a").on({"click touchstart":function(n){return ae(),n.preventAll()}});$(window).on({resize:e});e();window.loader.cancelButtonText(u("cancel"));window.navigator.vibrate=window.navigator.vibrate||window.navigator.webkitVibrate||window.navigator.mozVibrate||window.navigator.msVibrate;$.when(!0).then(function(){var t=window.localStorage.getItem(STORAGE_NAME_READLATER),i=window.localStorage.getItem(STORAGE_NAME_USELESS);if(t&&t.length)try{h=$.parseJSON(t)}catch(f){}if(i&&i.length)try{o=$.parseJSON(i)}catch(f){}$.when(oe()).then(function(){var h,f,o,t,i;$(".snapper").button({icons:{primary:"ui-icon-grip-solid-horizontal"},text:!1}).on({click:function(n){return $(document.body).data("snapper").open("left"),n.preventAll()}});$($.keyboard).on({"keydown.keyboard":function(n){if(!re())if($(".fullScreenContainer").is(":visible"))switch(n.which){case 27:$(".fullScreen").trigger("click");break;case 33:fi(!0);break;case 34:ui(!0);break;case 37:fi();break;case 39:ui()}else switch(n.which){case 113:window.sessionStorage.getItem("blog")&&$(".blogNavigator").first().find(".previousPage").first().trigger("click");break;case 115:window.sessionStorage.getItem("blog")&&$(".blogNavigator").first().find(".nextPage").first().trigger("click");break;case 116:n.altKey&&$(".header .title .tumblr").trigger("click");break;case 120:$(document.body).data("snapper")[$(document.body).hasClass("snapjs-left")?"close":"open"]("left")}}});f=Math.floor(Math.max($(window).width()*.4,265));$(".snap-drawer").css({width:f});$(document.body).data({snapper:h=new Snap({addBodyClasses:!0,disable:"right",element:document.getElementById("content"),hyperextensible:!1,maxPosition:f+1,touchToDrag:!0})});h.on({animated:function(){$(document.body).hasClass("snapjs-left")&&($(".statusToast").addClass("noSnapperOnClick"),e())}});setTimeout(function(){$("#blogs").append($(document.createElement("div")).addClass("noBlog").addClass("ui-state-highlight").addClass("ui-corner-all").text(u("noBlog")))},1e3);$(".popover").button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).webuiPopover({animation:"fade",onShow:function(n){n.addClass("ui-widget-content").css({"background-color":$("#content").css("background-color")})},style:"mainPopoverContent"});$(".downloads").button({icons:{primary:"ui-icon-arrowthickstop-1-s"},text:!1}).on({click:function(n){n.preventDefault();$(".popover").webuiPopover("hide");cf()}});a($(".downloadsProgressDialog").attr({title:r("activeDownloads",wt.count())}),{autoOpen:!1,buttons:[{click:function(){$(this).dialog("close")},text:u("ok")}],create:function(){$(this).css("maxWidth",$(window).width()*.85)},dialogClass:"centerButtons",maxHeight:$(window).height()*.9,minHeight:$(window).height()*.65,minWidth:$(window).width()*.5,position:{my:"top",at:"top+{0}".format(Math.ceil($(window).height()*.05))}});$(".login").button({icons:{primary:"ui-icon-key"},text:!1}).on({click:function(){$(".popover").webuiPopover("hide");yr(!0)}});$(".menu").button({icons:{primary:"ui-icon-gear"},text:!1}).on({click:function(){$(".popover").webuiPopover("hide");we()}});$(".usageModes").button({icons:{primary:"ui-icon-heart"},text:!1}).on({click:function(){$(".popover").webuiPopover("hide");$.when(pf($.extend({},n))).then(function(n){ou(n);di()})}});$(".filters").button({icons:{primary:"ui-icon-lightbulb"},text:!1}).on({click:function(){$(".popover").webuiPopover("hide");a($(".filtersDialog"),{dialogClass:"no-title",position:{my:"left top",at:"left+{0} top+{1}".format($(window).width()*.05,$(window).height()*.05)},width:"auto"})}});$(".downloader").button({icons:{primary:"ui-icon-arrowthickstop-1-s",secondary:"ui-icon-search"},text:!1}).on({click:function(){$(".popover").webuiPopover("hide");lf(!0)}});$(".readLater").button({icons:{primary:"ui-icon-clock"},text:!1}).on({click:function(){$(".popover").webuiPopover("hide");be()}});o=function(){var n,t;$(".filtersDialog").data("filtersLock")||(n=[],$(".filtersDialog").find("input[type=range]").filter(function(n,t){return(t=$(t)).val()!==t.data("reset")}).each(function(t,i){n.push("{0}({1})".format((i=$(i)).data("filter"),(i.data("format")||"{0}").format(i.val())))}),$("#cssFilters").remove(),n.length&&(t=$(document.createElement("a")).vendorSpecificCss("filter",n.join(" ")),$(document.createElement("style")).attr({id:"cssFilters",type:"text/css"}).text("{0} {{1}}".format("#blogPage .postContent img, #blogPage .postContent video, .fullScreenImageContainer",t.attr("style"))).appendTo($("head"))))};$(document.createElement("div")).css("-webkit-filter","brightness(101%)").css("-webkit-filter").length||$(".filtersDialog").find("input[type=range]").each(function(n,t){var i;(t=$(t)).data("filter")==="brightness"&&(i=parseFloat(t.data("reset")),t.attr("min",parseFloat(t.attr("min"))-i),t.attr("max",parseFloat(t.attr("max"))-i),t.data("reset",0))});$(".filtersDialog").find(".resetButton").button().on({click:function(){$(".filtersDialog").data({filterLock:!0}).find("input[type=range]").each(function(n,t){(t=$(t)).val(parseInt(t.data("reset")))}).end().removeData("filterLock");o()}}).trigger("click").end().find("input[type=range]").on({input:o});$(".pageOptionsDialog").find(".archive").on({click:function(){af($(this).attr("href"))}}).button({icons:{primary:"ui-icon-suitcase"}}).end().find(".refreshPage").button({icons:{primary:"ui-icon-refresh"}}).on({click:function(){var n=$(".pageOptionsDialog").data("info");$(".pageOptionsDialog").dialog("close");b(n,n.blog.page)}}).end().find(".blogStatistics").button({icons:{primary:"ui-icon-info"}}).on({click:function(){tu($(".pageOptionsDialog").data("info"),!0,!0)}}).end().find(".viewDownloads").button({icons:{primary:"ui-icon-arrowthickstop-1-s"}}).on({click:function(){lf()}});(function(){var u=$(".blogStatisticsDialog"),t=u.find(".blogStatisticsTable"),n=t.find(".postsPerType"),i=n.prev(),r=$(tumblr.POST_TYPES).map(function(n,t){return $.extend({},t,{name:w.postTypes[t.value]})}).get();n.remove();r.sortBy("name");$(r).each(function(t,r){var u;r.value&&r.value.length&&(i.after(u=n.clone().find(".postType").append($(document.createElement("ul")).append($(document.createElement("li")).text(r.name))).end().find(".postCount").data({postType:r.value}).end()),i=u)});t.find(".value").append($(document.createElement("span")).addClass("ui-icon").addClass("ui-icon-loader-16")).append($(document.createElement("span")).addClass("field"))})();$(".downloadsDialog").add($(".downloaderDialog")).attr({title:u("downloads")}).find(".nextDownloads").button();$(".pageOptionsDialog").find(".searchTag").button().end().find(".tagToSearch").closest("form").on({submit:function(n){var t=$(".pageOptionsDialog").find(".tagToSearch").val();return $(".pageOptionsDialog").dialog("close"),t&&t.length||(t=undefined),ir(t),n.preventAll()}});$(".pageOptionsDialog").find(".resetTag").on({click:function(){$(".pageOptionsDialog").find(".tagToSearch").val(String.empty)}}).end().find(".goToPage").button({icons:{primary:"ui-icon-arrowthick-1-e"},text:!1}).closest("form").on({submit:function(n){var t=parseInt($(".pageOptionsDialog").find(".pageNumber").val());return!isNaN(t)&&t&&(b($(".pageOptionsDialog").data("info"),t-1),$(".pageOptionsDialog").dialog("close")),n.preventAll()}});$.keyboard.numericInput($(".pageOptionsDialog").find(".pageNumber"));$(".pageOptionsDialog").find(".goToLastViewedPage").on({click:function(){var i=$(".pageOptionsDialog").data("info"),u=l(i.url,!0),t=parseInt(i.newPages);isNaN(t)||t<0?t=parseInt(window.sessionStorage.getItem("blogPage")):t&&t--;window.loading(function(){return $.Deferred(function(f){var s=!0,e=function(n){$.when(b(i,n,!0)).then(function(){$(".pageOptionsDialog").dialog("close");f.resolve()})},h=function(t){return $.Deferred(function(f){window.loader.message(r("searchingInPage",t+1));$.when(i.blog.getPosts(t,undefined,n.postType,n.postsPerPage,window.sessionStorage.getItem("blogTag"))).then(function(n){var i=!1,r=!1;$(n).each(function(n,t){if(!t.sticky&&(t.timestamp.getTime()>u.getTime()?i=!0:r=!0,i&&r))return!1});f.resolve({hasANewPost:i,hasAnOldPost:r,length:n.length,pageIndex:t})})}).promise()},o=function(i){$.when(h(i)).then(function(r){r.length<n.postsPerPage||r.hasANewPost&&r.hasAnOldPost?e(r.pageIndex):r.hasANewPost?s?o(i+1):e(r.pageIndex):r.pageIndex>t?e(r.pageIndex-1):(s=!1,o(i-1))})};window.setTimeout(function(){o(t)},DEFAULT_TIMEOUT)}).promise()},r("searching"))}}).button({icons:{primary:"ui-icon-seek-next"}}).end().find(".goToBlog").on({click:function(){$(".pageOptionsDialog").dialog("close")}}).end().find(".enableBlog").on({click:function(){var n=$(this).data();$.when($.confirm(r("confirmEnableBlog",n.title),undefined,[u("yes"),u("no")])).then(function(){var t=y(n.url);delete t.disabled;$.when(k(n.url,t)).always(function(){gi(t)})})}}).button().end().find(".disableBlog").on({click:function(){var n=$(this).data();$.when($.confirm(r("confirmDisableBlog",n.title||n.url),undefined,[u("yes"),u("no")])).then(function(){var t=y(n.url);t.disabled=!0;$.when(k(n.url,t)).always(function(){gi(t)})})}}).button().end().find(".addBlog").on({click:function(){var t=$(this).data();$.when($.confirm(r("confirmAddBlog",t.title),undefined,[u("yes"),u("no")])).then(function(){var i=parseInt(window.sessionStorage.getItem("blogPage"))||0,r=$.map($.makeArray($("#blogPage").find(".blogPost")),function(n){return $(n).data("post")});i=0;$.when(gr(t.title,t.url,!i||!r.length?t.updated:r[0].timestamp,t.posts-i*n.postsPerPage,i,undefined,t.is_nsfw,t.blog.data.login_required)).always(function(){ef(t.url);gi(y(t.url))})})}}).button();$(".toTop").button({icons:{primary:"ui-icon-arrowthickstop-1-n"},text:!1}).on({click:function(){kr(!0)}});$(document).on({click:function(){$(document.body).data("snapper").close();$(".fullScreenImageSizeList").slideUp()}});$("#content").add($("#blogPageContainer")).on({scroll:function(){var n=ci(),t=n.position().top,i=n.height();$(".toTop")[n.scrollTop()?"fadeIn":"fadeOut"]();HIDE_OFFSCREEN_ANIMATIONS&&!$.keyboard.isPressed("q")&&$("#blogPage").find(".photo").filter(function(n,t){return(t=$(t)).attr("src")&&t.data("isAnimated")&&!t.hasClass("ui-state-error")}).each(function(n,r){var u=(r=$(r)).position().top-t,e=u+r.height(),f=e<0||u>i?"hidden":"visible";r.css("visibility")!==f&&r.css({visibility:f})});s()}});$(".blogHeader").hide();t=$(".fullScreenContainer");i=$(".fullScreen").on({click:function(n){$(n.target).closest("img").length?hf(!i.hasClass("zoomed")):$(n.target).closest("audio").length||$(n.target).closest("video").length||$(n.target).closest(".video").length?n.stopPropagation():(i.find("audio").add(i.find("video")).each(function(n,t){t.pause()}),i.parent().fadeOut())}});t.find(".previousPost").button({icons:{primary:"ui-icon-triangle-1-w"},text:!1}).on({click:function(n){n.preventDefault();fi(!0)}});t.find(".previous").button({icons:{primary:"ui-icon-carat-1-w"},text:!1}).on({click:function(n){n.preventDefault();fi()}});t.find(".next").button({icons:{primary:"ui-icon-carat-1-e"},text:!1}).on({click:function(n){n.preventDefault();ui()}});t.find(".nextPost").button({icons:{primary:"ui-icon-triangle-1-e"},text:!1}).on({click:function(n){n.preventDefault();ui(!0)}});t.find(".closeFullScreen").button({icons:{primary:"ui-icon-closethick"},text:!1}).on({click:function(n){n.preventDefault();i.parent().fadeOut()}});t.find(".fullScreenDownload").button({icons:{primary:"ui-icon-arrowthickstop-1-s"},text:!1}).on({click:function(i){var u=$(i.target).closest("a").attr("href"),r=t.data("post");n.nativeDownload?et(u,r):(i.preventDefault(),wt.downloadPost(r,r.download_url||u))}});t.find(".fullScreenFullScreen").button({icons:{primary:"ui-icon-arrow-4-diag"},text:!1}).on({click:function(n){n.preventDefault();ye($(n.target).closest("a").data("mediaElement"))}});t.find(".imageSearch").button({icons:{primary:"ui-icon-search"},text:!1}).each(function(n,t){var i=$(t);i.find(".ui-button-icon-primary").css({"background-image":'url("{0}")'.format(i.data("backgroundimage"))})});swiper({appendTo:t,swipeLeft:function(){ui()},swipeRight:function(){fi()},swipeThreshold:40});$(".loginButton").add($(".changePasswordButton")).add($(".setPasswordButton")).add($(".cancelButton")).button();$(".loginDialog").attr({title:u("connect")});$(".changePasswordDialog").attr({title:u("changePassword")});$(".cancelButton").on({click:function(n){$(n.target).closest(".dialog").dialog("close")}});$(PROXIES).eachProp(function(n){PROXIES[n]=$.grep($.CORS.proxies,function(t){return t.name===PROXIES[n]})[0]});window.setTimeout(function(){$(document.body).addClass("transitionable");su();kt();$.when(c.load()).then(yr)},DEFAULT_TIMEOUT)})})},nf=function(t,i,f,e,o,h,c,l){var b,tt,it,st,ut,d,k,p,y,nt,lt,a=$(document.createElement("div")),w,ht,ot;y=$(document.createElement("div")).addClass("ui-corner-all").addClass("blogPost").addClass(f.isNewPost?"newPost":f.index===h?"firstNonNewPost":undefined).addClass(f.type+"Post").addClass(f.sticky?"stickyPost":undefined).attr({postID:f.id}).data({post:f}).append($(document.createElement("div")).addClass("postIndex").data({postIndex:f.fullIndex}).text(isNaN(parseInt(f.fullIndex))?String.empty:f.isNewPost?r("two2",f.fullIndex+1,o>0?e*n.postsPerPage+h>o?r("lessThanZero",e*n.postsPerPage+h):o:l||h<c?e*n.postsPerPage+h:r("lessThanZero",(e+1)*n.postsPerPage)):(f.fullIndex+1).toLocaleString()).append($(document.createElement("a")).addClass("loader").button({icons:{primary:"ui-icon-loader-16"},text:!1}))).append(lt=$(document.createElement("div")).addClass("postTitle").append(ie(f)).append(f.isNewPost?ri():undefined).append($(document.createElement("a")).addClass("postLink").attr({href:f.post_url,target:"_blank",title:f.post_url}).append(f.timestamp.toLocaleString())).append(b=$(document.createElement("span")).addClass("postButtons"))).append(p=$(document.createElement("div")).addClass("postContent")).appendTo(i);y.find("a").each(function(n,t){rt(t)});f.type==="photo"&&function(){var t,n={height:0,width:0};$(f.photos).each(function(t,i){$(i.alt_sizes).each(function(t,i){i.width>n.width&&i.height>n.height&&(n=i)})});n.width>n.height?n.width>=FULLHD.width&&n.height>=FULLHD.height?t=FULLHD.horizontalImage:n.width>=HD.width&&n.height>=HD.height&&(t=HD.horizontalImage):n.width>=FULLHD.height&&n.height>=FULLHD.width?t=FULLHD.verticalImage:n.width>=HD.height&&n.height>=HD.width&&(t=HD.verticalImage);t&&b.append($(document.createElement("img")).addClass("hdPost").attr({src:t}))}();f.tags&&f.tags.length&&b.append(dt({icon:"ui-icon-tag",items:$.map(f.tags,function(n){return{click:function(n){ir($(n.target).closest(".popoverInnerButton").data("tag"))},data:{tag:n},text:n}}),text:!0,title:f.tags.length.toLocaleString()}).addClass("postButton").addClass("tagsButton"));f.type==="photo"&&b.append(dt({icon:"ui-icon-arrow-4-diag",items:$.map(f.original_photos||f.photos,function(n,t){return{items:$.map(n.alt_sizes,function(n){return{attr:{href:n.url},className:"sizeItem",dontPrevent:!0,text:r("size",n.width,n.height)}}),text:n.caption&&n.caption.length?s(n.caption):r("photoIndex",t+1)}}),onShow:function(n){var t=y.find("img.photo").add(y.find("img.photo-2"));$(n).find(".sizeItem").removeClass("ui-state-highlight").each(function(n,i){var r=window.location.noProtocol((i=$(i)).attr("href"));t.filter(function(n,t){return window.location.noProtocol($(t).data("src"))===r}).length&&i.addClass("ui-state-highlight")})},text:!0,title:$.map(f.original_photos||f.photos,function(n){return n.alt_sizes.length.toLocaleString()}).join(", ")}).addClass("postButton").addClass("imageSizesButton"));f.download_url&&f.download_url.length&&(ut=f.type==="video"&&!n.embedVideos&&f.durationText&&f.durationText.length,b.append(it=$(document.createElement("span")).addClass("postButton").addClass("downloadButton").append(tt=$(document.createElement("a")).addClass("buttonSetItem").addClass("downloadFileButton").attr({download:ct(f),href:f.download_url,target:"_blank",title:ft(f)}).data({downloadText:li(f),post:f}).on({click:function(t){var i=$(t.target).closest("a"),r=i.data("post");n.nativeDownload?et(i.attr("href"),r):(t.preventDefault(),wt.downloadPost(r))}}).button({icons:{primary:n.nativeDownload?"ui-icon-arrowthickstop-1-s":"ui-icon-extlink"},label:f.durationText,text:ut}))),st=au(it,f).addClass("buttonSetItem"),it.buttonset({items:".buttonSetItem"}),ut||tt.find(".ui-button-text").html("&nbsp;"),rr(tt.add(st),f));f.type==="video"&&n.embedVideos&&(b.append($(document.createElement("button")).addClass("postButton").addClass("fullScreenButton").attr({type:"button"}).data({post:f}).button({icons:{primary:"ui-icon-arrow-4-diag"},label:f.durationText,text:!!(f.durationText&&f.durationText.length)}).on({click:function(n){v($(n.target).closest(".ui-button").data("post"))}})),f.durationText&&f.durationText.length||b.find(".ui-button-text").last().html("&nbsp;"));f.note_count&&b.append($(document.createElement("span")).addClass("notes").text(r("notes",f.note_count)));switch(f.type){case"answer":a.append($(document.createTextNode(r("asked",f.asking_name)))).append($(document.createElement("br"))).append($(document.createElement("br"))).append($(document.createElement("div")).html(s(f.question))).append($(document.createElement("br"))).append($(document.createElement("br"))).append($(document.createElement("div")).html(s(f.answer)));break;case"audio":ot=r("audioTitle",f.artist||u("unknownArtist"),f.track_name||u("unknownTrackName"),f.album||u("unknownAlbum"));y.find(".postLink").addClass("audioPost");a.append($(document.createElement("div")).html(s(f.caption))).append($(document.createElement("br")));f.download_url&&f.download_url.length&&($(document.createElement("a")).addClass("audioLink").attr({download:ct(f),href:f.download_url,target:"_blank",title:ot}).data({post:f}).on({click:function(t){n.enableFullScreenViewer&&t.which===1&&(t.preventDefault(),v($(t.target).closest("a").data("post")))}}).append(ot).appendTo(p),p.append($(document.createElement("br"))).append($(document.createElement("br"))));f.album_art&&f.album_art.length&&p.append($(document.createElement("img")).addClass("album_art").attr({src:f.album_art}));break;case"chat":case"text":f.title&&a.append($(document.createElement("div")).html(g(t,s(f.title))));f.body&&(f.title&&a.append($(document.createElement("br"))),f.type==="chat"?(d=$(document.createElement("ul")).addClass("chatList").appendTo(a),$(f.body.split("\n")).each(function(n,t){var i=$(document.createElement("li")).appendTo(d);(t=$.trim(t)).length?i.append($(document.createElement("span")).html("&mdash;&nbsp;&nbsp;")).append($(document.createTextNode(t))):i.html("&nbsp;")})):a.append($(document.createElement("div")).html(g(t,s(f.body)))),a.find("[data-provider=youtube]").each(function(n,t){var i=(t=$(t)).data("url");i&&i.length&&(i=window.decodeURIComponent(i),t.before($(document.createElement("a")).addClass("youtube-link").attr({href:i}).text(i)).before($(document.createElement("br"))))}));break;case"link":a.append($(document.createElement("a")).attr({href:f.url,title:f.title}).text(f.title||u("link"))).append($(document.createElement("br"))).append($(document.createElement("div")).html(g(t,s(f.description))));break;case"photo":$(f.original_photos||f.photos).each(function(n,i){$(document.createElement("a")).attr({href:i.original_size.url,photoID:i.photoID}).on({click:function(n){return tf(n)}}).append($(document.createElement("img")).addClass("photo").data({index:n,isAnimated:wi(i.original_size.url),post:f})).appendTo(p);i.caption&&i.caption.length&&p.append($(document.createElement("br"))).append($(document.createElement("span")).html(g(t,s(i.caption)))).append($(document.createElement("br")))});a.html(g(t,s(f.caption)));break;case"quote":a.append($(document.createElement("div")).html("«"+$.trim(g(t,s(f.text)))+"»"));f.source&&a.append($(document.createElement("br"))).append($(document.createElement("br"))).append($(document.createElement("div")).html(g(t,s(f.source))));break;case"video":if(y.find(".postLink").addClass("videoPost"),$(document.createElement("br")).appendTo(p),f.permalink_url&&f.permalink_url.length&&($(document.createElement("a")).addClass("permalink").attr({href:f.permalink_url}).text(f.permalink_url).appendTo(p),$(document.createElement("br")).appendTo(p)),f.html5_capable&&(n.embedVideos?w=$(document.createElement("div")).addClass("embeddedVideoContainer"):n.enableFullScreenViewer&&(w=$(document.createElement("a")).attr({href:"#"}))),!w&&f.thumbnail_url&&f.thumbnail_url.length&&(w=$(document.createElement("div"))),w&&(!w.hasClass("embeddedVideoContainer")&&f.thumbnail_url&&f.thumbnail_url.length&&$(document.createElement("img")).addClass("videoThumbnail").attr({alt:f.thumbnail_url,"has-src":String.empty}).data({src:f.thumbnail_url}).appendTo(w),w.data({post:f}).appendTo(p),n.enableFullScreenViewer&&f.html5_capable&&!n.embedVideos))w.on({click:function(n){var t=$(n.target).closest("a").data("post");n.preventDefault();v(t)}});a.html(g(t,s(f.caption)))}return nt=$.trim(a.html().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,String.empty).replace(/<iframe.*?\/iframe>/gi,function(n){try{var t=n.match(/data-src="(.*?)"/i),i,r;if(t&&t.length&&(t=t.pop().replace(/^\/+/,String.empty).replace(/\/+$/,String.empty).split("/")[0],t&&t.length))for(r=t.split("."),r[0].match(/www/i)&&r.splice(0,1),t=r.join("."),i=0;i<IFRAME_ALLOWED_HOSTS.length;i++)if(t.toLowerCase()===IFRAME_ALLOWED_HOSTS[i].toLowerCase())return n}catch(u){try{window.console&&window.console.warn&&window.console.warn(n)}catch(u){}}return String.empty}).replace(/autoplay="autoplay"/gi,String.empty)),nt&&nt.length&&(p.append(a=$(document.createElement("div")).html(nt)),f.photos&&f.photos.length&&(k=(f.original_photos||[]).length,a.find("img").each(function(n,t){var i=(t=$(t)).data("src");if(!t.hasClass("photo")&&!(f.album_art&&f.album_art.length&&window.location.noProtocol(f.album_art)===window.location.noProtocol(i))){try{if(window.tumblr.isPhotoURL(i)){t.data({isAnimated:wi(i),photoIndex:k,post:f});t.removeAttr("srcset");$(document.createElement("a")).addClass("photo-2").attr({href:f.photos[k].original_size.url,photoID:f.photos[k].photoID}).appendTo(t.parent()).append(t).on({click:function(n){return tf(n)}})}}catch(r){}k++}})),a.find("a").each(function(n,t){var i=le(t=$(t)),r=function(){t.hasClass("photo-2")||(rt(t),vu(t))};i?ht=$.Deferred(function(n){$.when(i).then(n.resolve,n.reject).always(r)}):r()})),f.tags&&f.tags.length&&(d=$(document.createElement("ul")).appendTo(y),$(f.tags).each(function(n,t){$(document.createElement("a")).attr({href:"#"}).data({tag:t}).on({click:function(n){return ir($(n.target).data("tag")),n.preventAll()}}).text(t).appendTo($(document.createElement("li")).addClass("expandedTag").appendTo(d))})),gu(y,t,f)&&y.addClass("useless"),(y.hasClass("stickyPost")||y.hasClass("useless"))&&y.addClass("collapsed").append($(document.createElement("button")).addClass("expandButton").attr({type:"button"}).button({icons:{primary:"ui-icon-arrowthickstop-1-s"},text:!1}).on({click:function(n){$(n.target).closest(".blogPost").removeClass("collapsed");$.keyboard.isPressed("q")||ti()}})),ht},di=function(){if(n.theme<$.ui.themes.length){var r=$.ui.themes[n.theme],u=r.theme,t=$("#"+THEMECOLOR_ID),i=$("#"+THEME_ID),f=window.location.sameProtocol(r.url);t.length&&t.attr("content")!==u&&t.attr({content:u});i.length&&i.attr("href")!==f&&i.attr({href:f})}},he=function(){$("#options_theme").themeSelector().selectmenu({appendTo:$(".optionsDialog"),change:function(t){n.theme=parseInt($(t.target).val());pt();di()},open:function(n){$(n.target).css({"z-index":$(n.target).closest(".ui-dialog").css("z-index")+1})}})},r=function(n){for(var t,r=[u(n)],i=1;i<arguments.length;i++)t=arguments[i],t!==undefined&&t!==null&&typeof t!="string"&&(t=t.toLocaleString?t.toLocaleString():t.toString()),r.push(t);return String.format.apply(this,r)},ii=function(n){return(typeof n=="number")?isNaN(n)?0:isFinite(n)?n:0:0},ri=function(n){return $(document.createElement("img")).addClass("newImage").attr({src:n?"images/halfNew.png":"images/new.png"})},ui=function(n){var f=$(".fullScreenContainer"),u=parseInt(f.data("photoIndex")),i=f.data("post"),r=$("#blogPage").data("posts"),t;if(n||(n=!(i.photos&&i.photos.length&&u<i.photos.length-1)),n){for(t=i.index+1;t<r.length;t++)if(ar(r[t])&&!$("[postid={0}]".format(r[t].id)).hasClass("useless")){switch(r[t].type){case"audio":case"video":v(r[t],undefined,!0);break;case"photo":default:v(r[t],0,!0)}break}}else u<i.photos.length-1&&v(i,u+1,!0)},a=function(n,t){return t=t||{},ni(),n.dialog($.extend({},t,{close:function(i,r){t.close&&t.close.call(n,i,r);t.destroyOnClose&&window.setTimeout(function(){n.dialog("destroy")},DEFAULT_TIMEOUT)},hide:!0,modal:!0,open:function(i,r){if(!t.dontCloseOnBackdropClick||$.isFunction(t.dontCloseOnBackdropClick))n.dialog("instance").overlay.off().on({click:function(i){var r;i.which===1&&($.isFunction(t.dontCloseOnBackdropClick)&&t.dontCloseOnBackdropClick()||((r=$(i.target).closest(".ui-dialog").find(".ui-dialog-buttonpane").find(".ui-button")).length?r.last().trigger("click"):n.dialog("close")))}});t.open&&t.open.call(n,i,r)},resizable:!!t.resizable,show:!0}))},ce=function(){var f,r,i,e,t,u;st={};for(i in n)if(t=window.location.get(i),t!==undefined){if(st[i]=e=n[i],typeof e=="boolean")t=!!parseInt(t);else if(typeof e=="number"){switch(i){case"avatarSize":r=tumblr.AVATAR_SIZES.length-1;break;case"postsPerPage":r=tumblr.MAX_POSTS_PER_PAGE-1;break;case"theme":r=$.ui.themes.length-1}t=parseInt(t);(isNaN(t)||!isNaN(t)&&(!r||t<0||t>=r))&&(t=undefined)}else switch(i){case"postType":if(f=!1,t.length)for(u=0;u<tumblr.POST_TYPES.length;u++)if(tumblr.POST_TYPES[u]===t){f=!0;break}f||(t=undefined)}t!==undefined&&(n[i]=t)}},tf=function(t){if(n.enableFullScreenViewer&&t.which===1){var r,f=$(t.target),u=f.closest("a").find("img"),i;u.length&&(i=u.first().data());t.preventDefault();t.stopPropagation();i&&(r=i.index,r===undefined&&(r=i.photoIndex),v(i.post,r))}},fi=function(n){var f=$(".fullScreenContainer"),u=parseInt(f.data("photoIndex")),r=f.data("post"),i=$("#blogPage").data("posts"),t;if(n||(n=!(r.photos&&r.photos.length&&u>0)),n){for(t=r.index-1;t>=0;t--)if(ar(i[t])&&!$("[postid={0}]".format(i[t].id)).hasClass("useless")){switch(i[t].type){case"audio":case"video":v(i[t],undefined,!0);break;case"photo":default:v(i[t],i[t].photos.length-1,!0)}break}}else u>0&&v(r,u-1,!0)},le=function(n){var t=(n=$(n)).attr("href");t&&t.length&&t.match("/iglive.picshitz.com/")&&$.Deferred(function(i){$.ajax({error:i.reject,success:function(t){var r=!1;$(s(t)).find(".postBody img").each(function(t,i){var u=$(i).data("src");n.before($(document.createElement("img")).attr({src:ru?yi(u):u}));r=!0});r&&n.before($(document.createElement("br")));i.resolve()},url:yi(t)})})},yr=function(t){var o=function(){var n,t;window.firebaseDataStore3?(n=new firebaseDataStore3(DATASTORE3_API_KEY,DATASTORE_ID),n.getKey=window.firebaseDataStore3.getKey,(n.cleanup=window.firebaseDataStore3.cleanup)&&CLEANUP_DATASTORE&&n.cleanup(DATASTORE_CLEANUP_INTERVAL)):window.firebaseDataStore&&(n=new firebaseDataStore(DATASTORE_ID),n.getKey=window.firebaseDataStore.getKey);for(t in n.messages)n.messages[t]=f?f.messages[t]:u("dataStorage"+t[0].toUpperCase()+t.substr(1));$(n).on({error:function(t,i){n.errorsSuspended||(i.error.match(/QuotaExceededError/i)&&n.cleanup&&n.cleanup(DATASTORE_CLEANUP_INTERVAL),$.toast.error(i.error))},message:function(t,i){n.messagesSuspended||$.toast.message(String.format(i.message,window.formatFileSize(i.length)))}});return n},i=window.sessionStorage.getItem("dates"),s=function(){return $.when(f.list(TABLE_DATES+"/")).then(function(n){e={};$(n).eachProp(function(n,t){t.id=n;t.date&&(t.date=new Date(t.date));t.viewed&&(t.viewed=new Date(t.viewed));e[ht(t.url)]=t});window.sessionStorage.setItem("dates",window.encodeURIComponent(window.JSON.stringify(e)))})},r=function(){return window.loader.value(!1),window.loading(function(){return $.when(e||s()).then(function(){return e&&!window.sessionStorage.getItem("startupDates")&&window.sessionStorage.setItem("startupDates",window.encodeURIComponent(window.JSON.stringify(e))),$.when(fe()).then(function(){window.sessionStorage.setItem("loaded",!0)})})},u(e?String.empty:"dataStorageDownloading"))},h=function(){var i=n.lastUsername&&n.lastUsername.length?n.lastUsername:window.sessionStorage.getItem("lastUsername")||String.empty,s=n.lastPassword&&n.lastPassword.length?n.lastPassword:window.sessionStorage.getItem("lastPassword")||String.empty,h,c;return i&&i.length||(i=USERNAME),s&&s.length||(s=PASSWORD),h=function(){var r,t;return f&&(r=f.messages.downloading,t=!0),f=window.dataStore=o(),t&&(f.messages.downloading=u("dataStorageConnected")),$.when(f.open(i,s,APP_CUSTOM_TOKEN,f.getKey((i||String.empty).toLowerCase()))).then(function(){var t=!1;window.sessionStorage.setItem("lastUsername",i);window.sessionStorage.setItem("lastPassword",s);n.rememberMe?(n.lastUsername!==i&&(n.lastUsername=i,t=!0),n.lastPassword!==s&&(n.lastPassword=s,t=!0)):(n.lastUsername!==d.lastUsername&&(n.lastUsername=d.lastUsername,t=!0),n.lastPassword!==d.lastPassword&&(n.lastPassword=d.lastPassword,t=!0));t&&pt()}).always(function(){t&&(f.messages.downloading=r)})},c=function(){return $.Deferred(function(t){var c;$("#username").val(i);$("#password").val(s);$("#rememberMe").prop("checked",n.rememberMe);a($(".loginDialog"),{close:function(){c||t.state()!=="pending"||t.reject()},dontCloseOnBackdropClick:!0,open:function(){$(".changePasswordButton").off().on({click:function(){$("#username2").val($("#username").val());$(".setPasswordButton").off().on({click:function(n){var t=$("#username2").val(),r=$("#password2").val(),i=$("#newPassword").val(),e=$("#newPassword2").val();return t&&t.length?r&&r.length?i&&i.length?e&&e.length&&i===e?(window.loader.value(!1),window.loading(function(){return f.messages.passwordChanged=u("dataStoragePasswordChanged").format(t),$.when(f.changePassword(t,r,i)).then(function(){$(".changePasswordDialog").dialog("close")},function(n){$.toast.error(n)})},f.messages.changingPassword)):$.toast.error(u("newPasswordMismatch")):$.toast.error(u("newPasswordRequired")):$.toast.error(u("oldPasswordRequired")):$.toast.error(u("usernameRequired")),n.preventAll()}});a($(".changePasswordDialog"),{dontCloseOnBackdropClick:!0,minWidth:$(window).width()*.5})}})[(f=f||o()).changePassword?"show":"hide"]();$(".loginButton").off().on({click:function(o){var l=$("#rememberMe").prop("checked");return i=$("#username").val(),s=$("#password").val(),i&&i.length?s&&s.length?(window.loader.value(!1),window.showLoader(f.messages.connecting),n.rememberMe!==l&&(n.rememberMe=l,pt()),$.when(h()).then(function(){lu();e=undefined;c=!0;$(".loginDialog").dialog("close");t.resolve();$.when(r()).always(window.hideLoader)},function(){window.hideLoader()})):$.toast.error(u("passwordRequired")):$.toast.error(u("usernameRequired")),o.preventAll()}})},minWidth:$(window).width()*.5})})},!t&&(APP_CUSTOM_TOKEN&&APP_CUSTOM_TOKEN.length||i&&i.length&&s&&s.length)?f&&f.isOpen?r():(window.loader.value(!1),window.showLoader(u("dataStorageConnecting")),$.when(h()).then(function(){return $.when(r()).always(window.hideLoader)},function(){return window.hideLoader(),c()})):c()};return!t&&i&&i.length&&(e=$.parseJSON(window.decodeURIComponent(i))),ni(),h()},rf=function(){$("#blogPage").find(".blogLink").each(function(n,t){var f=window.location.noProtocol(window.sessionStorage.getItem("blog")||"").split("/")[0],r=window.location.noProtocol((t=$(t)).attr("href")).split("/")[0],i=t.next(".ui-button"),u="ui-icon-triangle-1-s";i.length&&($.inArray(r,$(e).props())<0?(ku(r)&&(u="ui-icon-clock"),i.removeClass("ui-state-highlight")):(r===f&&(u="ui-icon-star"),i.addClass("ui-state-highlight")),i.button("option","icons",{primary:u}))})},pr=function(t){var o=!1,s=0,a=0,h=0,v=0,c=!1,f=!1,e,b=new Date,i=0,u=0,y=!1,p=0,w=0;$("#blogs").find(".ui-state-focus").removeClass("ui-state-focus");$("#blogs").find(".blog").each(function(r,b){var g=$(b),d=g.data("info"),k;if(d.exists){var nt=d.url,it=l(nt),tt=gt(nt);t&&t.url===nt&&g.addClass("ui-state-focus");g.find(".newImage").hide();tt&&(!e||e<tt)&&(e=tt);g.hasClass("newBlog")&&(k=d.posts-ai(nt,!0),n.nsfw||!d.nsfw?(s++,h+=Math.max(k,0),c=c||k<=0&&d.posts>0,it.getTime()<d.updated.getTime()&&(k=g.data("postsDifference")||0,g.find(".newImage").attr({src:k>0&&k<n.postsPerPage?"images/halfNew.png":"images/new.png"}).show(),u+=Math.max(k,0),f=f||k<=0&&d.posts>0,i++,d.nsfw||(p++,k<=0&&d.posts>0&&(y=!0),w+=Math.max(k,0)))):it.getTime()<d.updated.getTime()&&(a++,k=g.data("postsDifference")||0,v+=Math.max(k,0)),o=o||k<=0&&d.posts>0)}});wr(i);$("#blogs").data({lastViewedDate:e}).find(".newBlogsHeader").data({allHaveLessThanZeroPostsDifference:o,allNewBlogs:i+a,allNewPosts:u+v,hasLessThanZeroPostsDifference:f,length:i,newPosts:u,sfwNewBlogs:p,sfwNewPosts:w,sfwHaveLessThanZeroPostsDifference:y}).find(".text").first().empty().append($(document.createTextNode(r("newBlogsTitle",i,s)))).append($(document.createTextNode(" "))).append($(document.createElement("span")).text(r("newPostsTitle",f?r("lessThanZero",u):u,c?r("lessThanZero",h):h))).end().end().off().on({click:function(n){return vf(function(){iu("new")}),n.preventAll()}})[s?"show":"hide"]();$("#blogs").find(".readBlogsHeader").off().on({click:function(n){return iu("read"),n.preventAll()}});$("#blogs").find(".oldBlogsHeader").off().on({click:function(n){return iu("old"),n.preventAll()}})},gi=function(n){var i={title:n.title,url:n.url},t=bi(n);$(".pageOptionsDialog").find(".blogOptions")[t?"show":"hide"]();$(".pageOptionsDialog").find(".enableBlog").data(i)[t&&n.exists&&n.disabled?"show":"hide"]().end().find(".disableBlog").data(i)[t&&!n.disabled?"show":"hide"]().end().find(".addBlog").data(n)[t?"hide":"show"]()},uf=function(t,i,f,e){var it;pr(t);var g=nt(t.url),h,c=t.title,ut=!0,l=$(document.createElement("div")).html(s(t.description)),ft,tt,et,ot=[],b,v,d="default",p=t.postsDifference,w=n.postType,o=window.sessionStorage.getItem("blogTag");ft=o&&o.length||w&&w.length;l=$(".pageOptionsDialog").data({info:t}).find(".blogDescription").find("div").html(l.html());$.trim(l.text()).length?(l.parent().show(),l.find("a").each(function(n,t){rt(t);vu(t)})):l.parent().hide();$(".pageOptionsDialog").find(".archive").attr({href:t.archiveURL});$(".pageOptionsDialog").find(".tagToSearch").val(o).end().find(".resetTag")[o&&o.length?"show":"hide"]().end().find(".goToLastViewedPage")[t.newPages?"show":"hide"]().end().find(".goToBlog").attr({href:window.location.sameProtocol(t.url)}).text(window.location.sameProtocol(t.url));gi(t);(h=g.imageSize)&&h.length&&$(".pageOptionsDialog").find(String.format("[name=blogOptions_imageSize][value={0}]",h)).length&&(d=h);$(".pageOptionsDialog").find("[name=blogOptions_imageSize]").off().val([d]).on({change:function(n){var i=nt(t.url),r=$(n.target).val(),u=!1,f;if(r==="default"){delete i.imageSize;for(f in i){u=!0;break}u||(i=undefined)}else i.imageSize=r;$.when(dr(t.url,i)).then(function(){bt()})}});(h=g.preloadImages)&&h.length&&$(".pageOptionsDialog").find(String.format("[name=blogOptions_preloadImages][value={0}]",h)).length&&(d=h);$(".pageOptionsDialog").find("[name=blogOptions_preloadImages]").off().val([d]).on({change:function(n){var i=nt(t.url),r=$(n.target).val(),u=!1,f;if(r==="default"){delete i.preloadImages;for(f in i){u=!0;break}u||(i=undefined)}else i.preloadImages=r;$.when(dr(t.url,i)).then(function(){bt()})}});$(".pageOptionsDialog").find("[name=blogOptions_forceNSFW]").off().val([t.force_nsfw!==undefined?t.force_nsfw?"nsfw":"sfw":"noForce"]).on({change:function(){var i=$(this).val(),n=y(t.url);switch(i){case"nsfw":n.force_nsfw=!0;break;case"sfw":n.force_nsfw=!1;break;default:delete n.force_nsfw}k(t.url,n)}});it=function(n){$(".pageOptionsDialog").find("[name=blogOptions_{0}]".format(n)).off().prop("checked",!!g[n]).on({change:function(i){var r=nt(t.url),u=$(i.target).prop("checked"),f=!1,e;if(u)r[n]=!!u;else{delete r[n];for(e in r){f=!0;break}f||(r=undefined)}$.when(dr(t.url,r)).then(function(){bt(!0)})}})};it("checkUselessPosts");it("expandTags");i&&i.length&&($(i).each(function(n,t){t.type!=="photo"&&t.download_url&&t.download_url.length&&ot.push($.when(lt(t.download_url)).then(function(n){n||(tt=!0,t.isNewPost||(et=!0))}))}),(f||e)&&(f&&f<n.postsPerPage?v=r("newPostsSuffix",f):p&&(e===0&&f&&f>p?v=r("newPostsSuffix",r("lessThanZero",f)):(b=n.postsPerPage*((e||0)+1),v=(ft||p<0||!!f&&p<b)&&e*n.postsPerPage>b?r("newPostsSuffix",r("lessThanZero",b)):r("newPostsSuffix",p)))));o&&o.length?c=r("taggedPosts",c,o):w&&w.length&&(ut=!1,c=r("typedPosts",c,vi(t),w));ut&&(c=r("blogTitle",c,t.posts!==undefined?t.posts:u("no")));$(".blogHeader").show();$(".blogPageTitle").empty().append($(document.createElement("a")).attr({href:"#"}).on({click:function(n){n.preventDefault();a($(".pageOptionsDialog").attr({title:t.title}),{buttons:[{click:function(){$(this).dialog("close")},text:u("ok")}],destroyOnClose:!0,dialogClass:"centerButtons",maxHeight:$(window).height()*.9,minWidth:$(window).width()*.667,open:function(){$(".pageOptionsDialog").find(".pageNumber").val(t.blog.page+1);ei()}})}}).html(yt(c)));o&&o.length&&$(".blogPageTitle").append($(document.createElement("button")).attr({type:"button"}).button({icons:{primary:"ui-icon-closethick"},text:!1}).on({click:function(n){return ir(),n.preventAll()}}));$.when.apply(this,ot).then(function(){$("#blogPage")[tt?"addClass":"removeClass"]("hasNewVideo");$("#blogPage")[et?"addClass":"removeClass"]("hasNewVideoInOldPosts");v&&v.length&&$(".blogPageTitle").append($(document.createElement("span")).addClass("newPostsSuffix")[tt?"addClass":"removeClass"]("newVideo").text(v))})},nr=function(n,t,i,r){$(n)[t?"addClass":"removeClass"]("ui-state-highlight").attr({title:r}).button("option","icons",t||0?!1:{primary:i}).button("option","text",!!t).button("option","label",t!==undefined?t.toLocaleString?t.toLocaleString():t.toString():undefined)},ei=function(t){var i=$("#blogPage").find(".downloadFileButton").length,u=$("#blogPage").find(".downloadFileButton.downloaded").length,e,o,f;return t=t||$(".downloadsProgressDialog").find(".downloadList").children().length,f=r("activeDownloads",t),(e=u<i)&&$("#blogPage").find(".downloadFileButton").each(function(n,t){if(!(t=$(t)).hasClass("downloaded")&&!t.closest(".blogPost").hasClass("newPost"))return o=!0,!1}),$(".blogPageTitle").find(".newPostsSuffix")[u<i?"addClass":"removeClass"]("newVideo"),$("#blogPage")[e?"addClass":"removeClass"]("hasNewVideo"),$("#blogPage")[o?"addClass":"removeClass"]("hasNewVideoInOldPosts"),$(".pageOptionsDialog").find(".viewDownloads").button("option","label",r("viewDownloads",n.showMissingDownloads?i-u:u,i)),nr(".downloads",t,"ui-icon-arrowthickstop-1-s",f),nr(".downloads2",t,"ui-icon-arrowthickstop-1-s",f)},ff=function(){var n=(h||[]).length;nr(".readLater",n,"ui-icon-clock",r("readLater",n))},wr=function(n){return nr(".snapper",n?n:undefined,"ui-icon-grip-solid-horizontal")},ae=function(){lu();kt();yr()},ef=function(n){if(n&&n.length&&h&&h.length){var t=$.inArray(n=window.location.noProtocol(n).split("/")[0].toLowerCase(),h);return t>=0?(h.splice(t,1),tr(h,!0)):$.Deferred(function(n){n.reject()}).promise()}},ve=function(n){if(n&&n.length&&o&&o.length){var t;if((t=$.inArray(n=n.toLowerCase(),o.map(function(n){return n.test?n.source:n})))>=0)return $.when($.confirm(r("confirmRemoveFromGlobalUseless",n),undefined,[u("yes"),u("no")])).then(function(){o.splice(t,1);br(o,!0)})}},yt=function(n){var t=$(document.createElement("div")).append(document.createElement("br")).html();return(n||String.empty).replace(/\r\n/g,t).replace(/\n\r/g,t).replace(/\r/g,t).replace(/\n/g,t)},ye=function(n){try{var t=pi(n);t&&t.call(n)}catch(i){}},s=function(n){return(n||String.empty).replace(/ src=\"https*:\/\//gi,' has-src data-src="//').replace(/ src=\\&quot;https*:\/\//gi," has-src data-src=\\&quot;//")},of=function(n){var t=[];$(n).each(function(n,i){var r=$.extend({},i);delete r.toAutoUpdate;t.push(r)});window.sessionStorage.setItem("blogInfos",window.encodeURIComponent(window.JSON.stringify(t)))},br=function(n,t){return n&&n.length?(n=n.map(function(n){return n.test&&(n=n.source),n}),n.sort(),window.localStorage.setItem(STORAGE_NAME_USELESS,window.JSON.stringify(o=n))):(window.localStorage.removeItem(STORAGE_NAME_USELESS),o=[]),t?$.when(f.setItem(TABLE_USELESS,o)):void 0},pt=function(){var i,t,r;if(window.JSON&&window.JSON.stringify){i={};for(t in n)r=n[t],($.isPlainObject(r)||r!==undefined&&d[t]!==undefined&&r!==d[t])&&(i[t]=r);if(st)for(t in st)st[t]!==d[t]?i[t]=st[t]:delete i[t];window.localStorage.setItem(STORAGE_NAME_OPTIONS,window.encodeURIComponent(window.JSON.stringify(i)))}},tr=function(n,t){return n&&n.length?(n.sort(),window.localStorage.setItem(STORAGE_NAME_READLATER,window.JSON.stringify(h=n))):(window.localStorage.removeItem(STORAGE_NAME_READLATER),h=[]),ff(),rf(),t?$.when(f.setItem(TABLE_READLATER,h)):void 0},kr=function(n){var t=ci();n?t.animate({scrollTop:0}):t.scrollTop(0)},sf=function(n){var t=$("#blogs").parent(),u=t.height(),f=(n=$(n)).height(),i=n.offset(),r;i.top+f>u?r=i.top+t[0].scrollTop+f+32-u:i.top<0&&(r=i.top+t[0].scrollTop-32);r!==undefined&&t.animate({scrollTop:r})},pe=function(t,i){window.setTimeout(function(){var o,s,r,e,u,f=ci(),h=f.height();if(t.photos&&t.photos.length)r=$("#blogPage").find(String.format("[photoID={0}]",t.photos[i||0].photoID));else switch(t.type){case"video":r=$("#blogPage").find(String.format("[postID={0}]",t.id)).find(n.embedVideos?".embeddedVideoContainer":".videoThumbnail")}r&&r.length&&((o=r.find("*")).length&&(r=o.first()),e=r.height(),u=r.position().top+r.closest(".blogPost").position().top-f.position().top,s=u+e,(u<0||s>h)&&f.animate({scrollTop:f.scrollTop()+u-(h-e)/2}))})},ir=function(n){n&&n.length?window.sessionStorage.setItem("blogTag",n):window.sessionStorage.removeItem("blogTag");window.sessionStorage.removeItem("blogPage");window.setTimeout(function(){ki()})},k=function(n,t){var u,i,r=ht(n),s=new Date,o=function(){var n=window.sessionStorage.getItem("blogInfos");t.url&&t.url.length||(t.url=r);n&&n.length&&t.id&&t.id.length&&(n=$.parseJSON(window.decodeURIComponent(n)),$(n).each(function(n,i){if(i.id===t.id)return i=p[n],i.blog.data=t,i.disabled=t.disabled,i.force_nsfw=t.force_nsfw,i.login_required=t.login_required,of(p),!1}));window.sessionStorage.setItem("dates",window.encodeURIComponent(window.JSON.stringify(e)))};if(t&&((u=t.id)||(u=f.getKey(r))),t){t=$.extend({},t);i=$.extend({},t);i.url=r;for(name in i)i[name].constructor===Date&&(i[name]=i[name].toISOString());return $.when(f[e[r]?"setItem":"addItem"](TABLE_DATES+"/"+u,i)).then(function(n){n&&(t.id=n);e[r]=t;o()})}return $.when(f.removeItem(TABLE_DATES+"/"+u)).then(function(){delete e[r];o()})},dr=function(n,t){var i,r=ht(n);return t?k(n,$.extend({},e[r],{options:t})):(i=e[r],i&&i.options!==undefined)?(i=$.extend({},i),delete i.options,k(n,i)):void 0},et=function(t,i,r,u){var o,e,h=f.getKey(window.location.noProtocol(t)),v=(new Date).toISOString(),s=function(){delete f.messagesSuspended},a=function(){return rr($('[href="{0}"]'.format(t)),i),n.downloadSynchronization!=="skip"?c.save():void 0},l;if(i.type!=="photo"&&t&&t.length)return $.when($.Deferred(function(n){$.when(hr(h)).then(function(t){n[!!u==!!(e=t)?"resolve":"reject"]()},function(){n[u?"reject":"resolve"]()})})).then(function(){return n.downloadSynchronization!=="skip"&&!r?(f.messagesSuspended=!0,u?(l=f.removeItem(TABLE_DOWNLOADS+"/"+e.key),o=function(){return c.delete(e.key)}):(e={downloaded:v,source:i.blog.title},i.duration&&(e.duration=i.duration),l=f.setItem(TABLE_DOWNLOADS+"/"+h,e),o=function(){return c.add(h,e)}),$.when(l).then(function(){return $.when(o?o():!0).then(function(){return $.when(c.update()).then(function(){return $.when(f.setItem(TABLE_DOWNLOADS+"/"+VALUE_DOWNLOADS_COUNT,c.getCount())).then(function(){return $.when(f.setItem(TABLE_DOWNLOADS+"/"+VALUE_DOWNLOADS_DATE,c.getDate().toISOString())).then(function(){return s(),f.setItem(TABLE_DOWNLOADS+"/"+VALUE_DOWNLOADS_SIZE,c.getSize())},s)},s)})})},s).then(a)):a()})},hf=function(n){var c=function(){var n=r.offsetParent();n.one({"mousewheel touchmove":function(){n.stop()}}).animate({scrollLeft:(i.width*t-n.width())/2,scrollTop:(i.height*t-n.height())/2},function(){n.off("mousewheel touchmove")})},t=1,u=$(".fullScreenContainer"),r=u.find(".fullScreen"),o=u.find(".imageSearch"),s=u.find(".fullScreenImageSize"),l=$(window).height(),a=$(window).width(),i,f=r.find("img"),v,h=u.find(".slideshowInfo"),e=u.find(".slideshowToolbar");n?(i=f.data("photo")||{height:0,width:0},i.width<a&&i.height<l?(f.addClass("doubled"),t*=2):f.removeClass("doubled"),h.addClass("zoomed"),e.addClass("zoomed"),s.addClass("zoomed"),o.addClass("zoomed"),r.one({"webkitTransitionEnd oTransitionEnd otransitionend transitionend msTransitionEnd":function(){e.css({visibility:"hidden"})}}).addClass("noSwipe").addClass("zoomed").css({"min-width":i.width*t,"min-height":i.height*t}),c(),v&&$.toast("Device pixel ratio: {0}\nScale factor: {1}\nPhoto width: {2}\nPhoto height: {3}".format(window.devicePixelRatio,Math.roundTo(t,3),r.css("min-width"),r.css("min-height")))):(h.removeClass("zoomed"),e.css({visibility:"visible"}).removeClass("zoomed"),s.removeClass("zoomed"),o.removeClass("zoomed"),r.removeClass("noSwipe").removeClass("zoomed").css({"min-width":0,"min-height":0}));f.vendorSpecificCss({transform:"translate(-50%, -50%) scale({0}, {0})".format(t)})},gr=function(n,t,i,r,u,f,o,s,h){var l=ht(t),a=new Date,c=e[l],v,y;if(!PEEK)if(i)if(c&&(c.date?c=new Date(c.date):f=!0),h=h?undefined:{seen:a,seenPosts:r},c){if(v=(c.getTime?c.getTime():0)||0,y=i.getTime()||0,f||v<y||e[l].posts!==r&&u===0||!e[l].viewed||e[l].was_nsfw!==o)return k(t,$.extend({},e[l],{date:f||y>v?i:undefined,login_required:s,posts:r,title:n,viewed:a,was_nsfw:o},h))}else return k(t,$.extend({},e[l],{date:i,login_required:s,posts:r,title:n,viewed:a,was_nsfw:o},h));else return k(t)},rr=function(n,t){var i=[];$(n).each(function(n,r){var u={},f=(r=$(r)).attr("href");i.push($.when(lt(f,u)).then(function(n){r.hasClass("downloadProgress")||(n?(r.addClass("downloaded"),u.download.auto&&r.addClass("auto")):r.removeClass("downloaded").removeClass("auto"));t&&t.download_url&&t.download_url.length&&r.attr("title",ft(t,f))}))});$.when.apply(this,i).then(ei)},nu=function(n,t){var i=$(n).closest(".blogPost"),r=parseInt(i.data("loading"))||0;t?(r===0&&i.addClass("loading"),i.data({loading:++r}),or(1)):(i.data({loading:--r}),r===0&&i.removeClass("loading"),or(-1))},tu=function(t,i,f,e){var o=$(".blogStatisticsDialog"),h;o.find(".field").fadeOut().end().find(".ui-icon").hide();$.isPlainObject(t)||(h=$.when(sr(t)).then(function(n){t=n}));$.when(h).then(function(){var h=[{click:function(){$(this).dialog("close")},text:u("ok")}],c=bi(t);f||h.splice(0,0,{"class":"showButton",click:function(){e&&e();vt(t);$(this).dialog("close")},text:u("view")});c||i||ku(t.url)||h.splice(0,0,{"class":"readLaterButton",click:function(){fr(t.url)},text:u("later")});a(o,{buttons:h,close:function(){$($(this).data("requests")).each(function(n,t){t.abort()})},destroyOnClose:!0,dialogClass:"centerButtons",maxHeight:$(window).height()*.85,maxWidth:$(window).width()*.9,minWidth:$(window).width()*.75,open:function(){var l=function(n,t,i){var r=!1;return{abort:function(){r=!0},isAborted:function(){return r},run:function(){return $.when($.isFunction(n)?n.apply(this,arguments):n).then(function(){t&&!r&&t.apply(this,arguments)},function(){i&&i.apply(this,arguments)})}}},e=[],f=$(this),o=$.Deferred(),h=gt(t.url),a=$.now(),v=function(n,t){var i=n;if(i)while(!(i=Math.roundTo(n,t)))t++;return i},i=function(n,t){var i=n;i=typeof i=="string"?f.find(i):$(i);t!==undefined&&t!==null&&typeof t!="string"&&(t=t.toLocaleString?t.toLocaleString():t.toString());t&&t.length?i.closest("tr").show().end().find(".ui-icon").hide().end().find(".field").html(yt(t)).fadeIn():i.closest("tr").hide()};f.closest(".ui-dialog").find(".ui-dialog-buttonpane").find(".showButton").button("option","icons",{primary:c?"ui-icon-star":"ui-icon-search"}).end().find(".readLaterButton").button("option","icons",{primary:"ui-icon-clock"});f.find(".ui-icon").fadeIn();f.find(".url").empty().append(rt($(document.createElement("a")).attr({href:t.url}).text(t.url)));c||f.find(".blogDescription").empty().html($(document.createElement("div")).html(s(t.description)).html());i(".forceNSFW",t.force_nsfw!==undefined?u(t.force_nsfw?"yes":"no"):undefined);i(".loginRequired",t.blog.data.login_required!==undefined?u(t.blog.data.login_required?"yes":"no"):undefined);i(".lastViewedOn",h&&h.getTime()?r("two4",h,tt(a-h.getTime())):undefined);e.push(new l(t.blog.getInfo(),function(n){i(".nsfw",u(n.is_nsfw?"yes":"no"));i(".lastUpdatedOn",r("two4",n.updated,tt(a-n.updated.getTime())));i(".totalPosts",n.posts);o.resolve(n)},function(){i(".nsfw",String.empty);i(".lastUpdatedOn",String.empty);i(".totalPosts",String.empty);o.reject()}));e.push(new l(function(){return $.Deferred(function(u){$.when(o).then(function(f){var o=n.postsPerPage,s,e=Math.ceil(f.posts/o);(s=function(){t.blog.getPosts(e,undefined,undefined,o).then(function(n){if(n.length){var t=e*o+n.length;t!==f.posts&&i(".totalPosts",r("two3",f.posts,t));u.resolve(f,$(n).last().get(0))}else e?(e--,s()):u.resolve(f)},u.reject)})()},u.reject)}).promise()},function(n,t){var u,f,e;t&&(f=Math.ceil(Math.log(n.posts/1e3)/Math.log(10)),e=n.updated.getTime()-t.timestamp.getTime(),u=Math.floor(e/864e5));i(".firstPostOn",t?r("two4",t.timestamp,tt(a-t.timestamp.getTime())):String.empty);i(".postsPerDay",t?v(n.posts/(u>0?u:1),f):String.empty)},function(){i(".firstPostOn",String.empty);i(".postsPerDay",String.empty)}));f.find(".postCount").each(function(n,u){var f=(u=$(u)).data("postType");e.push(new l(function(){return $.Deferred(function(n){$.when(o).then(function(i){var r={};return t.blog.getPosts(0,r,f,1).then(function(){n.resolve(i,r)},n.reject)},n.reject)}).promise()},function(n,t){var o=Math.ceil(Math.log(n.posts/1e3)/Math.log(10)),e=t.posts_per_type[f];i(u,n.posts?r("two3",e,r("percent",v(e/n.posts*100,o))):e)},function(){i(u,String.empty)}))});f.data({requests:e});$(e).each(function(n,t){t.run()})},position:{my:"top",at:"top+{0}".format(Math.ceil($(window).height()*.05))},title:t.title})})},iu=function(t){var c=$("#blogs").find(".blog").filter(function(n,i){i=$(i);switch(t){case"new":return i.hasClass("newBlog");case"read":return!i.hasClass("newBlog")&&!i.hasClass("oldBlog");case"old":return i.hasClass("oldBlog")}}),a=function(n){return $(document.createElement("div")).append($(document.createElement("a")).addClass("blogLink").attr({blog:n.url,href:"#"}).text(n.title)).html()},f,e,nt=function(){for(var n,i=window.argumentsArray(arguments),u,t=2;t<i.length;t++)n=i[t],u=!1,!n||(typeof n=="string"?u=!!g[t]:typeof n=="number"&&n<0&&(n=r("lessThanZero",Math.abs(n))),n=n.toLocaleString?n.toLocaleString():n.toString(),i[t]=$(document.createElement("div")).append($(document.createElement("span")).addClass("data").addClass(u?"small":undefined).html(n)).html());return r.apply(this,i)},d=$.now(),v=0,y=!1,p=0,o=0,i=[],b=0,k=!1,s=0,h=function(){g[i.length]=!0},g=[],l=[];if(c.length)return c.each(function(i,r){var u=$(r).data("info"),h;u.exists&&(b+=u.posts,u.nsfw&&(p+=u.posts,v++),(t==="new"||u.postsDifference)&&((n.nsfw||!u.nsfw)&&l.push(u),u.postsDifference<=0&&(u.nsfw?y=!0:k=!0),u.nsfw?o+=Math.max(0,u.postsDifference):s+=Math.max(0,u.postsDifference)),(!f||f.updated&&f.updated.getTime()<u.updated.getTime())&&(f=u),u.viewed&&(h=new Date(u.viewed),(!e||new Date(e.viewed).getTime()<h.getTime())&&(e=u)))}),i.push(t==="new"?"newBlogsStatus":"nonNewBlogsStatus"),i.push(u(t+"BlogsStatusTitle")),i.push(c.length),i.push(c.length-v),i.push(v),t==="new"?(i.push(y||k?r("lessThanZero",o+s):o+s),i.push(k?r("lessThanZero",s):s),i.push(y?r("lessThanZero",o):o)):(i.push(b),i.push(b-p),i.push(p)),h(),i.push(a(f)),i.push(f.updated),i.push(tt(d-f.updated.getTime())),e?(h(),i.push(a(e)),i.push(new Date(e.viewed)),i.push(tt(d-new Date(e.viewed).getTime()))):(h(),i.push(u("notAvailable")),h(),i.push(u("never")),h(),i.push(u("notAvailable"))),t!=="new"&&(l.length?i.push(r("two3",l.length,$(l).map(function(n,t){return a(t)}).get().join(w.dateIntervalOptions.separator))):i.push(0)),yf(nt.apply(this,i))},cf=function(){$.when(ni()).then(function(){$(".downloadsProgressDialog").dialog("open")})},lf=function(t){var v=t?u("downloads"):window.sessionStorage.getItem("blogTitle"),h,g=function(n){var r=$(document.createElement("body")),u=$(document.createElement("downloads")).attr({folder:"."}),f=$(document.createElement("ol")).appendTo(r),t=[];$(n).each(function(n,i){var r=$(i),e=r.attr("href");$.inArray(e,t)<0&&(f.append($(document.createElement("li")).addClass("item").append($(document.createElement("a")).addClass("download").addClass(r.hasClass("downloaded")?"downloaded":undefined).addClass(r.closest(".newPost").length?"new":undefined).attr({href:e,download:r.attr("download"),target:"_blank",title:r.attr("title")}).text(r.text()))),u.append($(document.createElement("download")).attr({url:e,name:r.attr("download"),date:r.data("post").date,downloaded:r.hasClass("downloaded")?"downloaded":undefined})),t.push(e))});t.length&&t.push(String.empty);i.closest(".ui-dialog").find(".htmlDownloadButton").attr({download:DOWNLOAD_FILENAME_HTML.format(oi(v)),href:('<!doctype html><html><head><style type="text/css">.item { padding: 0.25em 0; }.download.new { background-color: lemonChiffon; }.download.downloaded { color: dimGray; }'+"<\/style><\/head><body>{0}<\/body><\/html>".format(r.html())).toBase64Data()});i.closest(".ui-dialog").find(".textDownloadButton").attr({download:DOWNLOAD_FILENAME_TEXT.format(oi(v)),href:t.join((window.navigator.userAgent.match(/windows/i)?"\r":"")+"\n").toBase64Data()});i.closest(".ui-dialog").find(".xmlDownloadButton").attr({download:DOWNLOAD_FILENAME_XML.format(oi(v)),href:$(document.createElement("div")).append(u).html().toBase64Data()});i.closest(".ui-dialog").find(".htmlDownloadButton").add(i.closest(".ui-dialog").find(".textDownloadButton")).add(i.closest(".ui-dialog").find(".xmlDownloadButton")).button(t.length?"enable":"disable")},nt=function(i){var u=lt(i.post.download_url),r,e,o;if(!t||!u)return r=$(document.createElement("li")).appendTo(f),e=au(r,i.post),i.isNewPost&&e.addClass("ui-state-highlight"),o=$(document.createElement("a")).addClass("downloadLink").attr({download:i.download,href:i.url,target:"_blank",title:i.title}).data("post",i.post).append(i.isNewPost?ri():undefined).append($(document.createTextNode(i.text))).on({click:function(t){var i=$(t.target).closest("a"),r=i.data("post");n.nativeDownload?et(i.attr("href"),r):(t.preventDefault(),wt.downloadPost(r))}}).appendTo($(document.createElement("span")).addClass("ui-corner-all").addClass(i.isNewPost?"newPost":undefined).data({post:i}).appendTo(r)),r.find(".setDownload")[u?"removeClass":"addClass"]("downloaded"),r.find(".resetDownload")[u?"addClass":"removeClass"]("downloaded"),rr(o.add(e),i.post),r},w=function(n,i){(i||!t)&&($(document.createElement("div")).addClass("pageLabel").text(r(i?"downloadsInPage":"noDownloadsInPage",n+1,i)).appendTo(f),i&&$(document.createElement("hr")).addClass("pageLine").appendTo(f))},i=$(".downloadsDialog"),s=i.find(".downloadList").empty(),f=$(document.createElement("ol")).appendTo(s),tt=$("#blogPage").find(".downloadButton"),b=[],it=function(){},e=$(".pageOptionsDialog").data("info"),y=function(n,u,e){var c=t,l,h=[];u&&w(e,n.length);$(n).each(function(n,t){n!==0||t.isNewPost||(c=!0);!u||t.isNewPost||c?l|=!!nt(t):h.push(t)});u&&!l&&((n.length||!t)&&(f.find(".pageLine").last().remove(),f.find(".pageLabel").last().remove()),t||w(e,0));h.length?(i.data({oldies:h}),$(h).each(function(n,t){if(!t.isDownloaded)return window.setTimeout(function(){o.trigger("click")},DEFAULT_TIMEOUT),!1})):i.removeData("oldies");o.button("option","label",r(h.length?"more2":"more",h.length));e&&d();g(s.find("a.downloadLink"));i.data("ui-dialog")&&i.dialog("option","position","center")},k=!1,o=i.find(".nextDownloads")[t?"hide":"fadeIn"](),c=function(u,e,s,h,a,v){var p=i.data("oldies");if(v=v||$.Deferred(),p)y(p),v.resolve();else return window.loading(function(){var i=function(){var n=f.find("li").length;n||f.closest("li").remove();a&&(u=a(n))?c(u,-1,l(u.url,!0).getTime(),!0,a,v):v.resolve()};return t?window.loader.value(u.loaderStart+Math.min(u.loaderStep,(e+2)*u.loaderStep/u.newPages)):window.loader.value(e+2),$.when(u.blog.getPosts(e+1,undefined,undefined,n.postsPerPage,window.sessionStorage.getItem("blogTag"))).then(function(r){var f=0,l=0;r=$(r).filter(function(n,t){return t.is_pinned?(l++,!1):!0});r.length?window.loader.isCanceled()||(y(r.each(function(n,t){(t.isNewPost=new Date(t.date).getTime()>s)&&f++}).filter(function(n,t){return t.download_url&&t.download_url.length}).map(function(n,t){return{download:ct(t),isNewPost:t.isNewPost,post:t,text:li(t),title:ft(t),url:t.download_url}}),!0,++e),t||o.data({pageIndex:e}),r.length+l!==n.postsPerPage||f!==r.length&&(f!==0||h)?t?i():v.resolve():c(u,e,s,h,a,v)):t?i():(o.fadeOut(),v.resolve())})},t?r("searchingInPage3",u.title,u.scanIndex,u.scanTotal,e+2,u.newPages):r(u.newPages>0&&e<u.newPages-1||!0?"searchingInPage2":"searchingInPage",e+2,u.newPages>0&&e<u.newPages-1?u.newPages:Math.ceil(u.total_posts/n.postsPerPage)));return v},d=function(){i.scrollTop(s[0].scrollHeight)};if(tt.each(function(n,t){var i=$(t).children().first();b.push({download:i.attr("download"),isNewPost:i.closest(".blogPost").hasClass("newPost"),post:i.data("post"),text:i.data("downloadText"),title:i.attr("title"),url:i.attr("href")})}),!t)o.off().data({pageIndex:e.blog.page}).on({click:function(){var t=parseInt(o.data("pageIndex")),i=e.newPages>0&&t<e.newPages-1;k=!0;window.loader.maximum(i?e.newPages:Math.ceil(e.total_posts/n.postsPerPage));window.loader.value(0);c(e,t,l(e.url,!0).getTime(),i)}});h=[{"class":"htmlDownloadButton",click:function(){}},{"class":"textDownloadButton",click:function(){}},{"class":"xmlDownloadButton",click:function(){}},{"class":"downloads2",click:cf,text:"."}];t&&(i.closest(".ui-dialog").find(".htmlDownloadButton").add(i.closest(".ui-dialog").find(".textDownloadButton")).add(i.closest(".ui-dialog").find(".xmlDownloadButton")).button("disable"),h.push({"class":"searchButton",click:function(){var r=0,v=$(document.createElement("ul")).appendTo(s.empty()),u=0,e=1e9,h=!!i.closest(".ui-dialog").find(".nsfwOnly").prop("checked"),t=$.map(p,function(n){return n.exists&&n.isNew&&(!h||n.nsfw)?n:undefined}),o=function(i){i.newPages=Math.ceil(i.postsDifference/n.postsPerPage);i.scanIndex=r+1;i.scanTotal=t.length;$(document.createElement("li")).text(i.title).append(f=$(document.createElement("ol")).attr({start:u+1})).appendTo(s);d();i.loaderStart=(i.loaderStep=a)*r},a=e/t.length;t.length&&(window.loader.value(0),window.loader.maximum(e),o(t[r]),c(t[r],-1,l(t[r].url,!0).getTime(),!0,function(n){var i=t[++r];return u+=n,i&&o(i),i}))},text:"."}));h.push({click:function(){$(this).dialog("close")},text:u("ok")});a(i,{beforeClose:function(){var r;t&&(r=i.closest(".ui-dialog").find(".nsfwOnly").prop("checked"))!==n.searchNSFWOnly&&(n.searchNSFWOnly=r,pt())},buttons:h,close:function(){window.loader.cancelable(!1);at(!1)},create:function(){$(this).css("maxWidth",$(window).width()*.85)},destroyOnClose:!0,dontCloseOnBackdropClick:function(){return t||k},maxHeight:$(window).height()*.8,minHeight:$(window).height()*.65,minWidth:$(window).width()*.5,open:function(){var r;r=i.closest(".ui-dialog").find(".htmlDownloadButton").empty();r.append($(document.createElement("a")).addClass("htmlDownloadButton").attr({href:"#"}).button({icons:{primary:"ui-icon-document"},label:u("downloadAsHTML"),text:!1})).appendTo(r.parent().parent());r=i.closest(".ui-dialog").find(".textDownloadButton").empty();r.append($(document.createElement("a")).addClass("textDownloadButton").attr({href:"#"}).button({icons:{primary:"ui-icon-script"},label:u("downloadAsText"),text:!1})).appendTo(r.parent().parent());r=i.closest(".ui-dialog").find(".xmlDownloadButton").empty();r.append($(document.createElement("a")).addClass("xmlDownloadButton").attr({href:"#"}).button({icons:{primary:"ui-icon-transferthick-e-w"},label:u("downloadAsXml"),text:!1})).appendTo(r.parent().parent());r=i.closest(".ui-dialog").find(".searchButton").button({icons:{primary:"ui-icon-search"},label:u("findDownloads"),text:!1});i.closest(".ui-dialog").find(".downloads2").removeClass("ui-button-text-only").removeClass("ui-button-text-icon-primary").addClass("ui-button-icon-only").addClass("ui-button-icon-primary");ei();t?i.closest(".ui-dialog").find(".ui-dialog-buttonpane").children().first().before($(document.createElement("div")).append($(document.createElement("label")).addClass("downloadsDialogNSFWOnly").append($(document.createElement("input")).addClass("nsfwOnly").attr({type:"checkbox"}).prop("checked",n.searchNSFWOnly)).append(document.createTextNode(u("nsfwOnly"))))):y(b,!0,e.blog.page);window.loader.cancelable(!0);window.loader.value(!1);at(!0)},position:{my:"top",at:"top+{0}".format(Math.ceil($(window).height()*.05))}})},v=function(i,u,f,e){var vt=window.sessionStorage.getItem("blog"),nt,tt=!1,l=i.download_url,k,p,y,yt,ot=0,a,rt,d,ut,lt=window.devicePixelRatio===1?screen.width:$(window).width(),at=window.devicePixelRatio===1?screen.height:$(window).height(),w,pt=$("#blogPage").data("posts"),h,st,g,et,ht;e=e||pu(vt);var o=$(".fullScreenContainer"),b=o.find(".fullScreen").find("audio").hide(),c=o.find(".fullScreen").find("img").hide(),s=o.find(".fullScreen").find(".video").hide();if($("#blogPage").find("video").each(function(n,t){$(t).closest(".blogPost").attr("postID")==i.id&&(ut=t.currentTime);t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2&&($(t).closest(".blogPost").attr("postID")==i.id&&(st=!0),t.pause());t.muted||(rt=t.volume)}),ht=function(){s.off().remove()},$(g=$(pt).filter(function(n,t){return ar(t)})).each(function(n,t){t.isNewPost&&ot++;t===i&&(w=n)}),(p=typeof u!="undefined"&&(i.type==="photo"||i.photos&&i.photos.length))&&(d=i.photos[u].original_size,h=er(e,i,u,lt,at,!0)),o.data({photoIndex:u,post:i}),o.find(".previousPost").button(w>0?"enable":"disable"),o.find(".previous").button(w>0||i.photos&&u>0?"enable":"disable"),o.find(".slideshowInfo").html($(document.createElement("div")).append(i.isNewPost?$(document.createElement("div")).append(ri()):undefined).append(i.photos&&i.photos.length>1?r("two",u+1,i.photos.length):i.durationText&&i.durationText.length?i.durationText:undefined).append(i.photos&&i.photos.length>1||i.durationText&&i.durationText.length?$(document.createElement("br")):undefined).append(ot&&i.isNewPost?r("three",w+1,ot,g.length):r("two",w+1,g.length)).html()),o.find(".next").button(w<g.length-1||i.photos&&u<i.photos.length-1?"enable":"disable"),o.find(".nextPost").button(w<g.length-1?"enable":"disable"),p)hf(!1),tt=c.hasClass("ui-state-error")||h.url!==c.attr("src"),nt=!!pi(c[0]),l=i.photos[u].download_url,ht();else switch(i.type){case"audio":tt=(y=b.hasClass("ui-state-error"))||i.audio_url!==b.attr("src");nt=!!pi(y[0]);ht();break;case"video":y=a=cu(e,i,lt,at,!0);a.length&&(et=a.find("[has-src]"),a.attr("has-src")!==undefined&&(et=et.add(a)),et.removeAttr("has-src").each(function(n,t){(t=$(t)).attr({src:t.data("src")}).removeData("src")}),nt=!!pi(y[0]));tt=s.length===0||s.length!==a.length||s.attr("id")!==a.attr("id")||s.attr("src")!==a.attr("src")}if(nt&&n.enableFullScreenViewerFullScreen?o.find(".fullScreenFullScreen").fadeIn().data({mediaElement:((p?c:y)||[])[0]}):o.find(".fullScreenFullScreen").fadeOut(),n.enableImageSearch&&p&&l&&l.length?o.find(".imageSearch").fadeIn().each(function(n,t){$(t).attr({href:$(t).data("imagesearchurl").format(window.encodeURIComponent(l)),target:"_blank"})}):o.find(".imageSearch").fadeOut(),tt){if(b.add(c).add(s).off().empty().attr({alt:String.empty,src:String.empty,title:String.empty}),it(c),y&&((ut||rt)&&function(){var n;n=function(){if(this.removeEventListener("canplay",n),st&&ut)try{this.currentTime=ut}catch(t){}if(rt){try{this.muted=!1}catch(t){}try{this.volume=rt}catch(t){}}};y[0].addEventListener("canplay",n)}(),st))try{y[0].play()}catch(wt){}if(l&&l.length?rr(o.find(".fullScreenDownload").button("option","icons",{primary:n.nativeDownload?"ui-icon-arrowthickstop-1-s":"ui-icon-extlink"}).attr({download:yt=ct(i,l),href:l,target:"_blank",title:ft(i,l)}).fadeIn(),i):o.find(".fullScreenDownload").fadeOut(),p){if(k=h.width===d.width&&h.height===d.height,o.find(".fullScreenImageSize").off().show().text(k?r("size",h.width,h.height):r("two",r("size",h.width,h.height),r("size",d.width,d.height)))[k?"removeClass":"addClass"]("clickable"),i.photos[u].alt_sizes.length>1&&(k||$.isPlainObject(e))){o.find(".fullScreenImageSize").addClass("clickable").on({click:function(n){o.find(".fullScreenImageSizeList").slideDown();n.stopPropagation()},touchend:function(){window.clearTimeout(t)},touchstart:function(){t=window.setTimeout(function(){o.find(".fullScreenImageSizeList").slideDown()},500)}});(function(){var n=i.photos[u].alt_sizes.slice(0);n.sort(function(n,t){return n=n.width*n.height,t=t.width*t.height,n<t?-1:n>t?1:0});o.find(".fullScreenImageSizeList").remove();$(document.createElement("div")).addClass("fullScreenImageSizeList").addClass("fullScreenButton").append($.map(n,function(t,e){return $(document.createElement("div")).css("display","table-row").append($(document.createElement("div")).addClass("sizeItem").addClass(e===0?"ui-corner-top first":e===n.length-1?"ui-corner-bottom":undefined).addClass("ui-widget-content").data({size:t}).text(r("size",t.width,t.height)).on({click:function(){v(i,u,f,t)}}))})).appendTo(o)})()}else if(!k)o.find(".fullScreenImageSize").on({click:function(){v(i,u,f,"best")}});c.show().attr({alt:h.url}).data({photo:h,src:h.url});f&&ur(c,!0)}else switch(i.type){case"audio":o.find(".fullScreenImageSize").off().hide();b.show().attr({src:i.audio_url});break;case"video":o.find(".fullScreenImageSize").off().hide();s.length>0&&s.off().remove();s=a.appendTo(b.parent())[e==="micro"?"addClass":"removeClass"]("micro").show();hu(s);it(s);(s.is("video")&&n.customVideoControls?s.parent():s).addClass("video")}}else if(p)c.show();else switch(i.type){case"audio":b.show();break;case"video":s.show()}f?pe(i,u):(p&&window.setTimeout(function(){ur(c,!0)}),o.fadeIn())},af=function(t,i,u){var f=$(window),e=.95;u||n.embedLinks?a($(".embeddedLinkDialog"),{close:function(n){$(n.target).find("iframe").first().attr({src:BLANK_PAGE})},draggable:!1,height:f.height()*e,maxHeight:f.height()*e,maxWidth:f.width()*e,minHeight:f.height()*e,minWidth:f.width()*e,open:function(n){$(n.target).closest(".ui-dialog").find(".ui-dialog-title").empty().append($(document.createElement("a")).attr({href:t,target:"_blank",title:t}).text(i||t));$(n.target).find("iframe").one({load:function(n){var i=n.target.document||n.target.contentDocument;$(i.body).css({"background-color":"whitesmoke","text-align":"center"});$(i.createElement("div")).text(r("embeddedIFrameText")).appendTo(i.body);$(i.createElement("br")).appendTo(i.body);$(i.createElement("a")).attr({href:t,target:"_blank"}).text(t).appendTo(i.body);i.location.href=t}}).attr({src:BLANK_PAGE})},width:f.width()*e}):window.open(t)},vf=function(t){var p=!1,s=0,h=0,w=$("#blogs"),b=!1,c,l,k,d=!1,g=!1,a=$(document.createElement("div")),i=w.find(".newBlogsHeader").data(),e=0,o=0,f=n.nsfw,rt=!1,nt=0,tt=0,v,y,it;if(w.find(".blog").length)return i&&(p=i.allHaveLessThanZeroPostsDifference,s=i.allNewBlogs,h=i.allNewPosts,b=i.hasLessThanZeroPostsDifference,e=i.length,o=i.newPosts,nt=i.sfwNewBlogs,tt=i.sfwNewPosts,rt=i.sfwHaveLessThanZeroPostsDifference),v=e||o?(f?nt!==s:e!==s)?v=String.format(u("two3"),f?s:e,f?nt:s):e.toLocaleString():u("noNewPost"),e||o?((f?tt!==h:o!==h)?(c=f?h:o,l=f?tt:h,d=f?p:b,g=f?rt:p):(d=g=b,c=l=o),y=d?r("lessThanZero",c):c.toLocaleString(),c!==l&&(y=String.format(u("two3"),y,g?r("lessThanZero",l):l.toLocaleString())),a.append(String.format(yt(u("newBlogs")),$(document.createElement("div")).append($(document.createElement("span")).addClass("data").text(v)).html(),$(document.createElement("div")).append($(document.createElement("span")).addClass("data").text(y)).html()))):a.append($(document.createTextNode(v))),(k=w.data("lastViewedDate"))&&k.getTime()&&(it=$.now()-k.getTime(),(!window.sessionStorage.getItem("loaded")||it>=IDLE_INTERVAL)&&a.append($(document.createElement("br"))).append(r("lastViewed",$(document.createElement("div")).append($(document.createElement("span")).addClass("data").text(ut(it))).html()))),yf(a.html(),undefined,function(n){t&&t($.extend({},n,{newBlogs:e,newPosts:o}))})},we=function(){var t=$("#options_theme"),i=$("#options_avatarSize"),r=$("#options_postType"),f=$("#options_postsPerPage"),e=$(".optionsDialog").find("[name=options_imageSize]"),o=$(".optionsDialog").find("[name=options_downloadSynchronization]"),s=function(){return $.extend({},n,{avatarSize:parseInt(i.val()),postType:r.val(),postsPerPage:parseInt(f.val()),imageSize:e.filter(":checked").val(),downloadSynchronization:o.filter(":checked").val(),showMissingDownloads:$("#options_showMissingDownloads").prop("checked"),preloadImages:$("#options_preloadImages").prop("checked"),customVideoControls:$("#options_customVideoControls").prop("checked"),customGifControls:$("#options_customGifControls").prop("checked"),enableFullScreenViewer:$("#options_fullScreenViewer").prop("checked"),enableFullScreenViewerFullScreen:$("#options_fullScreenViewerFullScreen").prop("checked"),showTags:$("#options_showTags").prop("checked"),showAllImageSizes:$("#options_showAllImageSizes").prop("checked"),showNotes:$("#options_showNotes").prop("checked"),sortByPosts:$("#options_sortByPosts").prop("checked"),embedLinks:$("#options_embedLinks").prop("checked"),embedVideos:$("#options_embedVideos").prop("checked"),enableImageSearch:$("#options_enableImageSearch").prop("checked"),peekMode:$("#options_peekMode").prop("checked"),nsfw:$("#options_nsfw").prop("checked"),vibrateOnCheckCompletion:$("#options_vibrateOnCheckCompletion").prop("checked"),autoUpdatePostCountMismatches:$("#options_autoUpdatePostCountMismatches").prop("checked"),hideOldies:$("#options_hideOldies").prop("checked"),nativeDownload:$("#options_nativeDownload").prop("checked")})},h=function(n){t.val(n.theme);i.val(n.avatarSize);r.val(n.postType);f.val(n.postsPerPage);e.val([n.imageSize]);o.val([n.downloadSynchronization]);$("#options_showMissingDownloads").prop("checked",n.showMissingDownloads);$("#options_preloadImages").prop("checked",n.preloadImages);$("#options_customVideoControls").prop("checked",n.customVideoControls);$("#options_customGifControls").prop("checked",n.customGifControls);$("#options_fullScreenViewer").prop("checked",n.enableFullScreenViewer);$("#options_fullScreenViewerFullScreen").prop("checked",n.enableFullScreenViewerFullScreen);$("#options_showTags").prop("checked",n.showTags);$("#options_showAllImageSizes").prop("checked",n.showAllImageSizes);$("#options_showNotes").prop("checked",n.showNotes);$("#options_sortByPosts").prop("checked",n.sortByPosts);$("#options_embedLinks").prop("checked",n.embedLinks);$("#options_embedVideos").prop("checked",n.embedVideos);$("#options_enableImageSearch").prop("checked",n.enableImageSearch);$("#options_peekMode").prop("checked",n.peekMode);$("#options_nsfw").prop("checked",n.nsfw);$("#options_vibrateOnCheckCompletion").prop("checked",n.vibrateOnCheckCompletion).prop("disabled",!window.navigator.vibrate);$("#options_autoUpdatePostCountMismatches").prop("checked",n.autoUpdatePostCountMismatches);$("#options_hideOldies").prop("checked",n.hideOldies);$("#options_nativeDownload").prop("checked",n.nativeDownload);$("#options_nsfw").parent().add($("#options_nsfw").parent().prev())[OFFICE_MODE!==2?"show":"hide"]()},c=function(){t.selectmenu("refresh");i.selectmenu("refresh");r.selectmenu("refresh");f.selectmenu("refresh")};h(n);a($(".optionsDialog"),{buttons:[{click:function(){$.when(pf(s())).then(function(i){h(i);c();n.theme=parseInt(t.val());pt();di()})}},{click:function(){$(this).dialog("close");ou(s())},text:u("ok")},{click:function(){$(this).dialog("close")},text:u("cancel")}],maxHeight:$(window).height()*.9,maxWidth:$(window).width()*.9,open:function(){c();$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").find("button").eq(0).removeClass("ui-button-text-only").addClass("ui-button-icon-only").append($(document.createElement("span")).addClass("ui-icon").addClass("ui-icon-heart")).find(".ui-button-text").html("&nbsp;")},width:"auto"})},be=function(){var n=function(n){$(n).closest(".ui-dialog").find(".ui-dialog-buttonpane").find(".clearButton").button(h&&h.length?"enable":"disable")},t=function(){$(".readLaterDialog").find(".urlList").empty().append($.map(h||[],function(t){var i,f=window.location.sameProtocol(t);return $(document.createElement("li")).append(i=dt({icon:"ui-icon-info",items:[{click:function(){tu(window.location.noProtocol(f),!0,!1,function(){$(i).closest(".ui-dialog-content").dialog("close")})},icon:"ui-icon-info"},{click:function(){$.when($.confirm(r("confirmRemoveFromReadLater",t),undefined,[u("yes"),u("no")])).then(function(){$.when(ef(t)).then(function(){n(i);$(i).closest("li").fadeOut("fast",function(){$(this).remove()})})})},icon:"ui-icon-circle-close"}]}).find(".ui-button-text").html("&nbsp;").end()).append(rt($(document.createElement("a")).attr({href:f}).text(t).on({click:function(n){return $.when(sr(window.location.noProtocol(f))).then(function(t){$(n.target).closest(".ui-dialog-content").dialog("close");vt(t)}),n.preventAll()}})))}))};a($(".readLaterDialog").empty().append($(document.createElement("ul")).addClass("urlList")),{buttons:[{"class":"addButton smallDialogButton",click:function(){var i=this;$.when($.prompt("text",".tumblr.com",undefined,[u("ok"),u("cancel")])).then(function(r){$.when(fr(r)).then(function(){t();n(i)})})},text:u("add")},{"class":"clearButton smallDialogButton",click:function(){var i=this,r=$(i);$.when($.confirm(u("confirmClearReadLater"),undefined,[u("yes"),u("no")])).then(function(){tr(undefined,!0);t();n(i)})},text:u("deleteAll")},{"class":"smallDialogButton",click:function(){$(this).dialog("close")},text:u("ok")}],destroyOnClose:!0,maxHeight:$(window).height()*.8,minHeight:$(window).height()*.65,minWidth:$(window).width()*.5,open:function(){t();$(this).closest(".ui-dialog").find(".ui-dialog-buttonpane").find(".addButton").button("option","icons",{primary:"ui-icon-plus"}).end().find(".clearButton").button("option","icons",{primary:"ui-icon-trash"});n(this)},position:{my:"top",at:"top+{0}".format(Math.ceil($(window).height()*.05))},title:u("readLaterTitle")})},yf=function(n,t,i){return $.when(ni()).then(function(){return $.toast({"class":$.trim("statusToast clickable ui-state-focus "+(t||String.empty)),slow:!0,text:n}).on({click:function(n){return i&&i(n),n.preventAll()}}).find(".blogLink").on({click:function(n){var t=$(n.target).attr("blog");$("#blogs").find(".blog").each(function(n,i){if((i=$(i)).data("info").url===t)return sf(i),!0})}})})},pf=function(n){return $.Deferred(function(t){a($(".usageModeDialog").data({options:n}),{close:function(){t.resolve($(this).data("options"))},dialogClass:"no-title centerButtons",open:function(){var i,t;$(this).find(".ui-button").each(function(r,u){var f=$(u),e=!1,h=f.data("mode"),o,s;if(s=h.options){e=!0;for(o in s)if(s[o]!==n[o]){e=!1;break}}else i||(i=f);f[e?"addClass":"removeClass"]("ui-state-highlight");e&&!t&&(t=f)});!t&&i&&(t=i);t&&t.focus()},width:"auto"})})},wf=function(t,i){t.sort(function(t,r){return(i&&(t=t.data("info"),r=r.data("info")),!t.exists&&r.exists)?1:t.exists&&!r.exists?-1:!t.isNew&&r.isNew?1:t.isNew&&!r.isNew?-1:n.sortByPosts&&t.exists&&r.exists&&t.isNew&&r.isNew&&t.postsDifference!==r.postsDifference?t.postsDifference<r.postsDifference?1:-1:(t=(t.title||t.name).toLowerCase(),r=(r.title||r.name).toLowerCase(),t<r?-1:t>r?1:0)})},ur=function(t,i){var r;t=$(t);!t.hasClass("ui-state-error")&&t.attr("src")===t.data("src")&&(t.hasClass("loading")||t.hasClass("loaded"))||(t.is("img")?(t.removeClass("ui-state-error").removeClass("loaded").addClass("ui-state-highlight").addClass("loading"),nu(t,!0)):i=!0,wi(r=t.data("src"))&&n.customGifControls&&!t.closest(".fullScreen").length?kf(t):(t=t.add(lr(t)),i?vr({image:t,src:r},{}):df(t,r,i)))},ke=function(){var t=function(){delete f.errorsSuspended;delete f.messagesSuspended};return f.errorsSuspended=f.messagesSuspended=!0,$.when(f.getItem(TABLE_USELESS)).always(function(i){return br(i),$.when(f.getItem(TABLE_READLATER)).always(function(i){var e;f.errorsSuspended=!1;tr(i);n.downloadSynchronization!=="skip"&&$.when(c.getDate()).then(function(n){e=n}).always(function(){return $.toast.message(u("synchronizingDownloads")),$.when(f.getItem(TABLE_DOWNLOADS+"/"+VALUE_DOWNLOADS_DATE)).then(function(i){return i=new Date(i),t(),!e||i.getTime()!==e.getTime()?$.when(n.downloadSynchronization==="synchronize"||$.confirm(u("requireDownloadsSynchronization"),undefined,[u("yes"),u("no")])).then(function(){return $.toast.message(u("downloadingDownloads")),$.when(f.list(TABLE_DOWNLOADS)).then(function(n){$.when(c.store(n)).then(function(){$.when(c.save()).then(function(){$.when(c.getCount()).then(function(n){$.toast.message(r("downloadsSynchronized",n))})})})})}):void 0},t)})})})},oi=function(n){for(n=n.replace(/\\|\/|\:|\*|\?|\"|\||\<|\>|[^\x20-\x7f]/g,"-");n.length&&(n[0]===" "||n[0]==="-");)n=n.substr(1);while(n.length&&(n[n.length-1]===" "||n[n.length-1]==="-"))n=n.substr(0,n.length-1);for(n[0]==="."&&(n="-"+n.substr(1));n[n.length-1]===".";)n=n.substr(0,n.length-1);return n};se()})