"use strict";window.tumblr=function(n){var o="https://api.tumblr.com/v2/blog/{0}/{1}",l="https://a.tumblr.com/{0}o1.mp3",s=n.api_key,u=n.oauth_secret,f=n.oauth_token,e=n.oauth_token_secret,h=OAuth({consumer:{key:s,secret:u},signature_method:"HMAC-SHA1",hash_function:function(n,t){return CryptoJS.HmacSHA1(n,t).toString(CryptoJS.enc.Base64)}}),i=function(n){var t=[];return n&&n.length&&(t=$(document.createElement("div")).html(n.replace(/ src="/gi,' data-src="')).find("img").map(function(n,t){var r,u,s,i,f,e=(t=$(t)).data("src"),h=t.attr("srcset"),o;if(window.tumblr.isPhotoURL(e,i={}))return i=i.matches,s=parseInt(t.data("orig-height"))||parseInt(t.parent().data("orig-height"))||0,o=parseInt(t.data("orig-width"))||parseInt(t.parent().data("orig-width"))||0,r=[f={height:s,url:e=window.location.sameProtocol(e),width:o}],i&&i.length>1&&!!(u=parseInt(i[i.length-1]))&&u!==1280&&o>u&&(f.width=u,f.height=Math.floor(f.height*u/o),i.isPhoto&&r.push(f={height:s,url:e=e.replace("_"+u+".","_1280."),width:o})),h&&h.length&&($(h.split(",")).each(function(n,t){let e=t.split(" "),u=e.pop(),o=window.location.sameProtocol(e.pop()),i,s=!1;if(u=parseInt(u.substr(0,u.length-1))){for(var f=0;f<r.length;f++)if(r[f].width===u){s=!0;break}s||(i=o.split("/"),i.pop(),i=i.pop(),i=i.split("_")[0],i=parseInt(i.split("x").pop()),r.push({height:i,url:o,width:u}))}}),r.sort(v)),{alt_sizes:r,download_url:e,original_size:f,photoID:window.guid()}})),$.makeArray(t)},c=function(n,t,i){var r,u=this.photos[n];return $(u.alt_sizes).each(function(n){if(this.width<=t&&(!i||this.height<=i))return r=n,!1}),r===undefined&&(r=u.alt_sizes.length-1),r},a=function(n,i,r){var u=$.Deferred(),c=function(){return $.Deferred(function(u){var o,c=function(i,f,e){var s=window.formatAjaxError(f,e),h=function(){t.ignoreErrors||r&&(r.disabled||r.login_required&&!t.isLoginSupported)||$.toast.error(String.format("{0}: {1}",n,s));window.console&&window.console.log&&window.console.log(s);u.reject.apply(this,c)},c=arguments;f==="parsererror"&&t.proxy?($.toast.warning(s),t.proxy.ajax({data:o,dataType:"json",url:n}).then(u.resolve,function(){h()})):h()};r&&r.login_required&&t.isLoginSupported?$.ajax({data:i,headers:h.toHeader(h.authorize({data:i,url:n,method:"GET"},{key:f,secret:e})),url:n}).then(u.resolve,c):$.ajax({crossDomain:!0,data:o=$.extend({},i,{api_key:s,_:$.now()}),dataType:"jsonp",url:n}).then(u.resolve,c)}).promise()},o=function(){return $.when(c()).then(function(n){u.resolve(n)},function(){u.reject()})};return DEBUG?window.setTimeout(function(){o()},DEBUG_TIMEOUT):o(),u.promise()},r=function(n,t,i,r){return a(String.format(o,n,t),i,r)},v=function(n,t){return-(n.width-t.width)},t={getBlog:function(n){var s={},e,h,u,f;for($.isPlainObject(n)||(n={url:n});n.url.length&&n.url[n.url.length-1]==="/";)n.url=n.url.substr(0,n.url.length-1);for(n.url+="/",u=n.name||window.location.noProtocol(n.url);u.length&&u[u.length-1]==="/";)u=u.substr(0,u.length-1);for(n.name=u,f=0;f<tumblr.AVATAR_SIZES.length;f++)s[tumblr.AVATAR_SIZES[f]]=window.location.sameProtocol(String.format(o,n.name,"avatar/"+tumblr.AVATAR_SIZES[f]));return e=$.extend({},n),delete e.url,{data:n,getFollowers:function(){return r(n.name,"followers",undefined,this.data)},getInfo:function(i){i&&!this.data.login_required&&(this.data.login_required=!0);var u=$.Deferred(),f=function(t){u.resolve({blogURL:n.url,dataLength:t||0,name:n.name,url:n.url})};return $.when(r(n.name,"info",undefined,this.data)).then(function(i){var r=window.JSON.stringify(i).length;i.meta.status===200?u.resolve(h=$.extend({},i.response.blog,{archiveURL:window.tumblr.getArchiveURL(n.url),avatarURLs:s,blogURL:n.url,dataLength:r,description:i.response.blog.description.purify(),exists:!0,name:n.name,updated:new Date(i.response.blog.updated*1e3),url:i.response.blog.url.match(/www\.tumblr\.com\/blog\/view\//gi)?n.url:i.response.blog.url},e,{title:i.response.blog.title||n.name})):(t.ignoreErrors||$.toast.error(String.format("{0}: {1}",n.url,i.meta.msg)),f(r))},function(){f()}),u.promise()},getLikes:function(){return r(n.name,"likes",undefined,this.data)},getPosts:function(t,u,f,e,o,s,a){var v={limit:e,notes_info:!!a,reblog_info:!!s,offset:t?t*e:0};return o&&o.length&&(v.tag=o,f=undefined),$.when(r(n.name,"posts"+(f?"/"+f:""),v,this.data)).then(function(n){var t,r=0;return u&&(f?(u.posts_per_type=u.posts_per_type||{},u.posts_per_type[f]=n.response.total_posts):u.posts=n.response.total_posts,u.updated=new Date(n.response.blog.updated*1e3)),t=$(n.response.posts).map(function(n){var e,o,f,t;n-=r;t=$.extend({},this,{blog:u||h,fullIndex:v.offset+n,index:n,summary:(this.summary||String.empty).purify(),timestamp:new Date(this.timestamp*1e3)});this.dismissal!==undefined&&(delete t.dismissal,delete t.index,delete t.fullIndex,t.sticky=!0,r++);switch(this.type){case"audio":(e=t.audio_url)&&e.length&&(o=window.location.noHash(e.split("/").pop()),o.indexOf(".")<0&&(e=String.format(l,o)),t.download_url=t.audio_url=window.location.sameProtocol(e),t.album_art&&t.album_art.length&&(t.album_art=window.location.sameProtocol(t.album_art)));break;case"photo":$(t.photos).each(function(n){var i=this;i.index=n;i.original_size.url.match("_1280.")||($(i.alt_sizes).each(function(){if(this.url.match("_1280."))return i.original_size.url=this.url,i.corrected=!0,!1}),i.corrected||i.original_size.url.match("_500.")&&$(i.alt_sizes).each(function(n){if(this.url.match("_500.")&&n)return i.original_size.url=i.alt_sizes[0].url=this.url.replace("_500.","_1280."),i.corrected=!0,!1}));i.download_url=i.original_size.url=window.location.sameProtocol(i.original_size.url);i.photoID=t.id.toString()+"_"+i.index.toString();$(i.alt_sizes).each(function(){this.url=window.location.sameProtocol(this.url)});i.corrected&&(t.corrected=!0)});t.original_photos=t.photos;t.getBestFitPhotoIndex=c;break;case"video":default:t.video_url&&t.video_url.length?t.video_url=window.location.sameProtocol(t.video_url):(this.player&&this.player.length?f=$(document.createElement("div")).html(this.player[this.player.length-1].embed_code).find("video>source"):(f=this.body,f&&f.length||(f=this.answer),f&&f.length&&(f=$(document.createElement("div")).html(f.replace(/ src="/gi,' data-src="')),f=f.find("video>source").add(f.find("video[data-src]")))),f&&f.length&&(t.videoType=f.attr("type"),t.video_url=window.location.sameProtocol(f.attr("src")||f.data("src"))));(t.download_url=t.video_url)&&(t.actual_type="video")}return t.photos=(t.photos||[]).concat(i(this.body)).concat(i(this.caption)).concat(i(this.answer)).concat(i(this.description)),t.photos&&(t.photos.length?t.getBestFitPhotoIndex||(t.getBestFitPhotoIndex=c):delete t.photos),t}).get(),t.dataLength=window.JSON.stringify(n).length,t})},name:n.name,url:n.url}},ignoreErrors:!1,isLoginSupported:window.CryptoJS!==undefined&&u&&u.length&&f&&f.length&&e&&e.length};return t};window.tumblr.AVATAR_SIZES=[16,24,30,40,48,64,96,128,512];window.tumblr.MAX_POSTS_PER_PAGE=20;window.tumblr.MEDIAURL1=/\d{2}\.media\.tumblr\.com\/.*\/.*\/s(\d{1,4})x(\d{1,4})\//i;window.tumblr.MEDIAURL2=/\d{2}\.media\.tumblr\.com\//i;window.tumblr.PHOTOURL=/\.tumblr\.com\/.*tumblr_.*_(\d{1,4})\./i;window.tumblr.POST_TYPES=[{description:"All posts",value:""},{description:"Photos",value:"photo"},{description:"Videos",value:"video"},{description:"Texts",value:"text"},{description:"Answers",value:"answer"},{description:"Quotes",value:"quote"},{description:"Links",value:"link"},{description:"Chats",value:"chat"},{description:"Audio",value:"audio"}];window.tumblr.getArchiveURL=function(n){if(n&&n.length){while(n.slice(-1)==="/")n=n.substr(0,n.length-1);return window.location.sameProtocol(n+"/archive/")}};window.tumblr.isPhotoURL=function(n){var t=n.match(window.tumblr.PHOTOURL);return t?(arguments.length>1&&(arguments[1].isPhoto=!0,arguments[1].matches=t),!0):(t=n.match(window.tumblr.MEDIAURL1),t)?(arguments.length>1&&(t.pop(),arguments[1].matches=t),!0):!!n.match(window.tumblr.MEDIAURL2)}