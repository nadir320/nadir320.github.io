"use strict";(function(){var v="tetris-game-state",f="session",p="tetris-style",i=Array.prototype.slice.call(window.document.getElementsByTagName("script")).pop();(function(){Array.prototype.findIndex||(Array.prototype.findIndex=function(n){for(var i=this,t=0,r=this.length;t<r;t++)if(n.call(i,this[t],t))return t;return-1});Array.from||(Array.from=function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i});var n=i.getAttribute("storage");n&&n.length&&(f=n);f+="Storage"})();var y=function(n,t){Array.from(typeof n.length!="undefined"?n:[n]).forEach(function(n){n.addEventListener("click",t)})},e=function(n,t,i){y(n.querySelectorAll("."+t),i)},w=function(n,t,i){y(n.getElementsByTagName(t),i)},c=function(n){Array.from(n.childNodes).forEach(function(n){n.parentElement.removeChild(n)})},tt=function(n){var t={};return Object.keys(n).forEach(function(i){t[i]=n[i]}),t},o=function(n){n.classList.add("hidden")},r=function(n){return!n.classList.contains("hidden")},u=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.max(t,i);return t},t=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.min(t,i);return t},n=function(n){return Object.keys(l()).findIndex(function(t){return t.toLowerCase()===n.toLowerCase()})>=0},l=function(n){var t=(n=n||window.location.href).indexOf("?"),i={};return t>=0&&(n=n.substr(t+1),t=n.indexOf("#"),t>=0&&(n=n.substr(0,t)),n.split("&").forEach(function(n){var t=n.indexOf("="),r=n.substr(0,t),u=n.substr(t+1);i[r||u]=r?window.decodeURIComponent(u):undefined})),i},b=function(n){var t=k(n);if(t&&t.length)try{return window.JSON.parse(t)}catch(i){}},k=function(n){try{var t=window[f];if(t&&t.getItem)return t.getItem(n)}catch(i){}},a=function(n,t){var i;t&&(i=document.getElementById(t))?i.innerText=n:(i=document.createElement("style"),i.setAttribute("type","text/css"),t&&i.setAttribute("id",t),i.innerText=n,document.querySelector("head").appendChild(i))},s=function(n){n.classList.remove("hidden")},d=function(n,t){typeof t!="undefined"&&(t=window.JSON.stringify(t));g(n,t)},g=function(n,t){try{var i=window[f];i&&(typeof t!="undefined"?i.setItem&&i.setItem(n,t):i.removeItem&&i.removeItem(n))}catch(r){}},it=n("debug"),nt=n("cw"),h;(function(){var n={get baseMoveTime(){return 600},get boardHeight(){return 20},get boardWidth(){return 10},levelMoveTime:function(n){var t;switch(n){case 1:t=500;break;case 2:t=400;break;case 3:t=340;break;case 4:t=280;break;case 5:t=220;break;case 6:t=160;break;case 7:t=110;break;case 8:t=90;break;default:t=70}return t},get levels(){return 25},get linesPerLevel(){return 10},get moveTimeStep(){return 50},get padding(){return 8},get randomTiles(){return 4},get tileHeight(){return 30},get tileWidth(){return 30}},i={I:{name:"I",basePosition:[[0,0],[0,1],[0,2],[0,3]],baseRotation:1},J:{name:"J",basePosition:[[0,0],[0,1],[0,2],[1,2]],baseRotation:3},L:{name:"L",basePosition:[[0,0],[0,1],[0,2],[1,0]],baseRotation:1},O:{name:"O",basePosition:[[0,0],[0,1],[1,0],[1,1]],baseRotation:0},S:{name:"S",basePosition:[[1,0],[1,1],[0,1],[0,2]],baseRotation:1},T:{name:"T",basePosition:[[0,0],[0,1],[0,2],[1,1]],baseRotation:0},Z:{name:"Z",basePosition:[[0,0],[0,1],[1,1],[1,2]],baseRotation:1}},f=function(){var n=Object.keys(i);return i[n[Math.floor(Math.random()*n.length)]]},e=function(n,t,i){var r;switch(n){case"I":switch(i){case 0:case 2:r=[[t[0][0]+2,t[0][1]+-2],[t[1][0]+1,t[1][1]+-1],[t[2][0]+0,t[2][1]+0],[t[3][0]+-1,t[3][1]+1],];break;case 1:case 3:r=[[t[0][0]+-2,t[0][1]+2],[t[1][0]+-1,t[1][1]+1],[t[2][0]+0,t[2][1]+0],[t[3][0]+1,t[3][1]+-1],]}break;case"J":switch(i){case 0:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+1],[t[3][0]+2,t[3][1]+0],];break;case 1:r=[[t[0][0]+-1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+0,t[3][1]+-2],];break;case 2:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+-1],[t[3][0]+-2,t[3][1]+-0],];break;case 3:r=[[t[0][0]+1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+0,t[3][1]+2],]}break;case"L":switch(i){case 0:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+1],[t[3][0]+0,t[3][1]+-2],];break;case 1:r=[[t[0][0]+-1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+-2,t[3][1]+0],];break;case 2:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+-1],[t[3][0]+0,t[3][1]+2],];break;case 3:r=[[t[0][0]+1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+2,t[3][1]+0],]}break;case"O":r=t;break;case"S":switch(i){case 0:case 2:r=[[t[0][0]+0,t[0][1]+-2],[t[1][0]+1,t[1][1]+-1],[t[2][0]+0,t[2][1]+0],[t[3][0]+1,t[3][1]+1],];break;case 1:case 3:r=[[t[0][0]+0,t[0][1]+2],[t[1][0]+-1,t[1][1]+1],[t[2][0]+0,t[2][1]+0],[t[3][0]+-1,t[3][1]+-1],]}break;case"T":switch(i){case 0:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+1],[t[3][0]+1,t[3][1]+-1],];break;case 1:r=[[t[0][0]+-1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+-1,t[3][1]+-1],];break;case 2:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+-1],[t[3][0]+-1,t[3][1]+1],];break;case 3:r=[[t[0][0]+1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+1,t[3][1]+1],]}break;case"Z":switch(i){case 0:case 2:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+2,t[3][1]+0],];break;case 1:case 3:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+-2,t[3][1]+0],]}}return r},r;Object.keys(i).forEach(function(n){i[n].rotate=function(t,i){return e(n,t,i)}});r=function(r){var a,h=0,c,o,l=function(n){return(n||o).map(function(n){return n[1]})},p=function(n){return(n||o).map(function(n){return n[0]})},y=function(n){var t=o.filter(function(n){return n[0]>=0}).map(function(t){return n.apply(this,t)});t.filter(function(n){return!n}).length&&(c=!0)},v=function(n,i,r){var f,o,s;if(n=n.slice(),r)for(f=0;f<r;f++)n=e(a,n,f+1);return o=l(n),s=Math.floor((i-u(o)-t(o)+1)/2)-1,s&&(n=n.map(function(n){return[n[0],n[1]+s]})),n},s;return r?r.tiles?(s=i[r.className],h=r.rotation,c=r.locked):(s=i[r],h=s.baseRotation):(s=f(),h=s.baseRotation),a=s.name,o=r&&r.tiles?r.tiles:v(s.basePosition,n.boardWidth,s.baseRotation),{className:a,createPreview:function(i){for(var f,r,o=v(s.basePosition,4,i?h:0),c=l(o),y=p(o),w=t(c),b=t(y),d=u(c)-w+1,g=u(y)-b+1,k=document.createElement("div"),e=0;e<g;e++)for(f=0;f<d;f++)o.filter(function(n){return n[0]===e+b&&n[1]===f+w}).length&&(r=document.createElement("div"),r.classList.add(a),r.style.gridColumn=f+1,r.style.gridRow=e+1,r.style.width=n.tileWidth+"px",r.style.height=n.tileHeight+"px",k.appendChild(r));return k},createPreviewImage:function(t,i){var u=document.createElement("canvas"),r,f;return u.setAttribute("width",n.tileWidth*4),u.setAttribute("height",n.tileHeight*4),r=u.getContext("2d"),r.fillStyle=t,r.strokeStyle=t,f=v(s.basePosition,4,i?h:0),f.forEach(function(t){var i=[t[1]*n.tileWidth,t[0]*n.tileHeight,n.tileWidth,n.tileHeight];r.fillRect.apply(r,i);r.strokeRect.apply(r,i)}),u.toDataURL()},drop:function(){var t=this,n;c||(n=t.getShadow(),n&&(o=n),y(this.findEmptyTiles))},getShadow:function(){var n=this,i=t(o.map(function(t){return n.findEmptyTiles.apply(n,t)}));if(i)return o.map(function(n){return[n[0]+i,n[1]]})},get locked(){return c},isTileVisible:function(n){return o[n][0]>=0},moveDown:function(){y(this.findEmptyTiles);c||(o=o.map(function(n){return[n[0]+1,n[1]]}))},moveLeft:function(){if(!c){var n=this,i=t(l());i>0&&o.filter(function(t){return!n.isTileEmpty(t[0],t[1]-1)}).length===0&&(o=o.map(function(n){return[n[0],n[1]-1]}))}},moveRight:function(){if(!c){var t=this,i=u(l());i<n.boardWidth-1&&o.filter(function(n){return!t.isTileEmpty(n[0],n[1]+1)}).length===0&&(o=o.map(function(n){return[n[0],n[1]+1]}))}},rotate:function(i){var f;if(!c)if(nt||i){var e=(h+1)%4,r=s.rotate(o,e),a=l(r),v=this;t(a)>=0&&u(a)<n.boardWidth&&r.filter(function(n){return n[0]>=0&&!v.isTileEmpty.apply(this,n)}).length===0&&(h=e,o=r)}else for(f=0;f<3;f++)this.rotate(!0)},get rotation(){return h},get tiles(){return o.slice()}}},function(){for(var r=[".level-container { background-color: whitesmoke; }"],t,i=1;i<=n.levels;i++)t=Math.min(Math.max(Math.floor(255-(i-1)/n.levels*255),0),255),r.push('.level-container[level="'+i+'"] { background-color: rgba('+t+", "+t+", "+t+", 1); background: radial-gradient(circle, rgba("+t+", "+t+", "+t+", 1) 0%, rgba(255, 255, 255, 1) 100%); }");a(r.join(" "),p)}();h=function(t,u,e,o){var g,ct=0,l,it,vt,lt,p,w,k,at=[],rt,y,ut={},a=u&&u.paused,h,ft=0,et,ot,nt=0,s,yt;Object.keys(i).forEach(function(n){var t=i[n];ut[t.name]=0});var st=function(n,t){return n+"°"+t},bt=function(){if(ft&&(ot||nt||(ot=!0),!et)){var t=Object.keys(h).map(function(n){return h[n]}).filter(function(n){return n.className}),i=t.filter(function(n){return n.baseTile});i.filter(function(t){for(var r,u,f,i=t.row+1;i<n.boardHeight;i++)if(b(i,t.column))return!0;for(u=b(t.row-1,t.column),f=!1,i=t.row-2;i>=0;i--)if(r=b(i,t.column),r!==u){if(f)return!0;u=r}return!1}).length===0&&t.filter(function(t){for(var i=t.row+1;i<n.boardHeight;i++)if(b(i,t.column))return!0;return!1}).length===0&&(et=!0)}},tt=function(){if(ht(),s&&s.locked){vt=it=Date.now();s.tiles.forEach(function(n,t){if(s.isTileVisible(t)){var i=kt.apply(this,n);i.className=s.className;i.locked=!0}});var r=Object.keys(h).map(n=>h[n]).reduce(function(n,t){return(n[t.row]||(n[t.row]=function(){var n=[];return n.row=t.row,n}())).push(t),n},[]),i=r.filter(function(t){return t.filter(function(n){return n.className}).length==n.boardWidth}).map(function(n){return n.row});i.length&&(function(){var t,n;for(at.push(i.length),i.sort(function(n,t){return t-n}),t=0,n=i[0];n>=0;n--){while(i.includes(n-t))t++;r[n].forEach(function(i){var u=n-t>=0?r[n-t].filter(function(n){return n.column===i.column}).pop():{};i.className=u.className;i.locked=u.locked;i.baseTile&&(i.baseTile=!1,nt--)})}bt()}(),Math.floor(k/n.linesPerLevel)!==Math.floor((k+i.length)/n.linesPerLevel)&&(p++,w=u.slow?Math.max(n.moveTimeStep,w-n.moveTimeStep):n.levelMoveTime(p)),k+=i.length,ht());wt();t.dispatchEvent(new Event("game.changed"));l&&t.dispatchEvent(new Event("game.lost"))}d(v,l?undefined:{allTiles:Object.keys(h).reduce(function(n,t){var i=h[t];return n[t]={baseTile:i.baseTile,className:i.className,column:i.column,locked:i.locked,row:i.row},n},{}),baseCleared:et,baseRemoved:ot,baseLines:u&&u.lines||0,baseTiles:ft,elapsed:ct,level:p,lineHistory:at,lines:k,nextPiece:y.className,piece:s,pieceStats:ut,pieces:rt,remainingBaseTiles:nt,start:g})},pt=function(n,t){var r=Object.keys(h).map(function(n){return h[n]}).filter(function(i){return i.column==t&&!i.className&&i.row>n}).map(function(n){return n.row}),i;if(n<0)for(i=-1;i>n;i--)r.splice(0,0,i);for(r.sort(function(n,t){return n-t}),i=0;i<r.length;i++)if(r[i]!==n+i+1)return i;return r.length},kt=function(n,t){return h[st(n,t)]},wt=function(){var n=function(){var n=new r;return n.findEmptyTiles=pt,n.isTileEmpty=b,n};y||(y=n());s=y;ut[s.className]++;rt++;y=n();ht();y.tiles.filter(function(n){return!b.apply(this,n)}).length>0&&(l=Date.now(),ht())},b=function(n,t){return n<0||!kt(n,t).className},ht=function(){var n;Array.from(document.getElementsByClassName("level-container")).forEach(function(n){p>1?n.setAttribute("level",p):n.removeAttribute("level")});Object.keys(h).forEach(function(n){var i=h[n],t=i.tile.classList;t.remove("I");t.remove("J");t.remove("L");t.remove("O");t.remove("S");t.remove("T");t.remove("Z");t.remove("locked");t.remove("base-tile");t.remove("shadow");i.className&&t.add(i.className);i.locked&&t.add("locked");i.baseTile&&t.add("base-tile")});s&&(s.tiles.forEach(function(n,t){s.isTileVisible(t)&&h[st(n[0],n[1])].tile.classList.add(s.className)}),u&&u.shadow&&(n=s.getShadow())&&n.filter(function(n){return s.tiles.filter(function(t){return t[0]===n[0]&&t[1]===n[1]}).length===0}).forEach(function(n){h[st(n[0],n[1])].tile.classList.add("shadow")}))};return function(){var v,d;if(c(t),t.style.padding=n.padding+"px",t.style.width=n.tileWidth*n.boardWidth+2*n.padding+"px",t.style.height=n.tileHeight*n.boardHeight+2*n.padding+"px",v=document.createElement("div"),v.classList.add("level-container"),h={},function(){for(var r,t,i=0;i<n.boardHeight;i++)for(r=0;r<n.boardWidth;r++)t=document.createElement("div"),t.classList.add("tile"),u.fade&&t.classList.add("fade"),t.style.gridColumn=r+1,t.style.gridRow=i+1,t.style.width=n.tileWidth+"px",t.style.height=n.tileHeight+"px",v.appendChild(t),h[st(i,r)]={row:i,column:r,tile:t}}(),o&&o.start?(Object.keys(o.allTiles).map(function(n){return o.allTiles[n]}).forEach(function(n){var t=h[st(n.row,n.column)];t.baseTile=!!n.baseTile;n.className&&(t.className=n.className);t.locked=!!n.locked}),y=new r(o.nextPiece),y.findEmptyTiles=pt,y.isTileEmpty=b,s=new r(o.piece),s.findEmptyTiles=pt,s.isTileEmpty=b):u&&u.lines>0&&function(){for(var t,o,r,s,c=Math.min(u.lines,n.boardHeight-4),e=0;e<c;e++)for(t=Object.keys(h).map(function(n){return h[n]}).filter(function(t){return t.row===n.boardHeight-e-1}),o=0;o<n.randomTiles;o++){r=Math.floor(Math.random()*t.length);do s=f().name;while(s===i.Z.name);t[r].className=s;t[r].baseTile=!0;t.splice(r,1);ft++;nt++}}(),t.appendChild(v),o&&o.start?(et=o.baseCleared,ot=o.baseRemoved,ft=o.baseTiles,ct=o.elapsed,p=o.level,at=o.lineHistory,k=o.lines,ut=o.pieceStats,rt=o.pieces,nt=o.remainingBaseTiles,g=o.start):(rt=k=0,p=1),u.slow)for(w=n.baseMoveTime,d=1;d<p;d++)w=Math.max(n.moveTimeStep,w-n.moveTimeStep);else w=n.levelMoveTime(p);ht();a||(g=Date.now(),wt());e&&e();yt=window.setInterval(function(){if(!l&&!a){g||(g=Date.now(),wt(),bt(),t.dispatchEvent(new Event("game.changed")));var n=Date.now();lt&&(ct+=n-lt);(!it||n-it>=w)&&(it&&s.moveDown(),it=n,tt());lt=n}},50)}(),{get baseCleared(){return et},get baseLines(){return ft/n.randomTiles},get baseRemoved(){return ot},board:{get width(){return n.boardWidth*n.tileWidth},get height(){return n.boardHeight*n.tileHeight}},get constants(){return n},dropPiece:function(){a||l||!s||(!vt||Date.now()-vt>=w/2)&&(s.drop(),tt())},get elapsed(){return ct},get end(){return l},getNextPiecePreview:function(n){if(y)return y.createPreview(n)},get level(){return p},get lineHistory(){return at},get lines(){return k},movePieceDown:function(){a||l||!s||(s.moveDown(),tt())},movePieceLeft:function(){a||l||!s||(s.moveLeft(),tt())},movePieceRight:function(){a||l||!s||(s.moveRight(),tt())},pause:function(){a||l||(a=!0,t.dispatchEvent(new Event("game.paused")))},get paused(){return a},get pieces(){return rt},get pieceStats(){return ut},get remainingBaseLines(){return nt/n.randomTiles},resume:function(){a&&!l&&(lt=Date.now(),a=!1,t.dispatchEvent(new Event("game.resumed")))},rotatePiece:function(){a||l||!s||(s.rotate(),tt())},get start(){return g},stop:function(){l=Date.now();window.clearInterval(yt);yt=undefined}}};h.createPreviews=function(){return Object.keys(i).map(function(n){var t=i[n];return{name:t.name,preview:new r(t.name).createPreview()}})}})(),function(){var yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",pt=decodeURIComponent("%E3%85%A4"),y,wt=!n("no-fade")&&!parseInt(i.getAttribute("no-fade")),ot,ut=n("safe")||!!parseInt(i.getAttribute("safe")),st,bt=!!n("touch")||!!parseInt(i.getAttribute("touch")),u=document.querySelector(".board"),f=document.getElementById("message"),k=document.querySelector(".scaler"),ht=document.querySelector(".status");(function(){typeof ShadowRoot=="undefined"&&f.classList.add("compatible");n("animate")&&document.querySelector("body").classList.add("animate")})();var t,ft,ct=function(n){Array.from(n.getElementsByTagName("div")).forEach(function(n){n.parentElement&&n.classList.add("tile")})},lt=function(){r(f)?(d(),g()):t?rt(document.getElementById("askNewMessage").value):g()},nt=function(n){if(Array.from(document.getElementsByClassName("boss")).forEach(function(t){(n?s:o)(t)}),y!==n){var i=document.querySelector("[rel='shortcut icon']");(y=n)?(t&&t.pause(),st=document.title,document.title=pt,i&&(ot=i.getAttribute("href"),i.setAttribute("href",yt))):(document.title=st,i&&i.setAttribute("href",ot))}},tt=function(){et&&et();Array.from(document.getElementsByClassName("level")).forEach(function(n){n.innerText=t?t.level:undefined});Array.from(document.getElementsByClassName("lines")).forEach(function(n){n.innerText=(t?t.lines:0).toLocaleString()});Array.from(document.getElementsByClassName("line-details")).forEach(function(n){var i="";t&&t.lines&&(i=t.lineHistory.reduce(function(n,t){return n[t]=(n[t]||0)+1,n},[]).map(function(n,t){return{index:t,value:n}}),i.sort(function(n,t){return t.index-n.index}),i=i.filter(function(n){return n.value}).map(function(n){return n.index+": "+n.value.toLocaleString()}).join(" - "));n.innerText=i});Array.from(document.getElementsByClassName("pieces")).forEach(function(n){n.innerText=t?t.pieces:undefined});Array.from(document.getElementsByClassName("base-lines-row")).forEach(function(n){n.classList[t&&t.baseLines?"remove":"add"]("removed")});t&&t.baseLines&&Array.from(document.getElementsByClassName("base-lines")).forEach(function(n){n.innerText=t?t.remainingBaseLines.toLocaleString()+"/"+t.baseLines.toLocaleString():undefined;n.classList[t&&t.baseCleared?"add":"remove"]("base-cleared");n.classList[t&&t.baseRemoved?"add":"remove"]("base-removed")});Array.from(document.getElementsByClassName("next-piece-row")).forEach(function(n){n.classList[t&&t.start?"remove":"add"]("removed")});Array.from(document.getElementsByClassName("next-piece")).forEach(function(n){var i=t?t.getNextPiecePreview(!0):undefined;typeof i=="string"?n.setAttribute("src",i):(c(n),i&&(ct(i),n.appendChild(i)))});var n;Array.from(document.getElementsByClassName("piece-stats-row")).forEach(function(n){n.classList[t&&t.start?"remove":"add"]("removed")});t&&(n=t.pieceStats,Array.from(document.getElementsByClassName("piece-stats")).forEach(function(t){Array.from(t.getElementsByClassName("stat-table")).forEach(function(t){var i=Array.from(t.getElementsByClassName("stat-row"));i.forEach(function(t){Array.from(t.getElementsByClassName("stat-value")).forEach(function(i){i.innerText=n[t.dataset.type]})});i.sort(function(t,i){return n[i.dataset.type]-n[t.dataset.type]});i.forEach(function(n){t.appendChild(n)})})}))},at=function(){Array.from(document.getElementsByClassName("pause")).forEach(function(n){s(n)})},vt=function(){Array.from(document.getElementsByClassName("pause")).forEach(function(n){o(n)})},d=function(){o(f);o(document.getElementById("messageBackdrop"));u.focus()},g=function(i,r){t&&(t.stop(),t=undefined,u.removeEventListener("game.changed",tt));var f=0;i||(f=parseInt(Array.from(document.querySelectorAll("[name=initial-lines]")).filter(function(n){return n.checked}).pop().value));t=new h(u,{fade:wt,lines:f||0,paused:r,shadow:!n("no-shadow"),slow:!!n("slow")},function(){u.addEventListener("game.changed",tt);r?at():vt();setTimeout(function(){ft();tt()})},i)},it=function(){t&&(t.paused?y||t.resume():t.pause())},et=function(){var n=0,i,r="";t&&t.start&&(n=t.elapsed);n=Math.floor(n/1e3);n>=3600&&(r=Math.floor(n/3600)+":",n%=3600);i=Math.floor(n/60);n%=60;r.length&&i<10&&(i="0"+i);r+=i+":";n<10&&(n="0"+n);Array.from(document.getElementsByClassName("time")).forEach(function(t){t.innerText=r+n})},rt=function(n){y||(t&&t.pause(),document.getElementById("messageText").innerText=n,s(document.getElementById("messageBackdrop")),s(f),window.setTimeout(function(){try{document.querySelector("[name=initial-lines]:checked").focus()}catch(n){}}))},p=function(n){switch(n.which){case 13:r(f)?(d(),g()):t&&(t.paused?y||t.resume():t.dropPiece());break;case 19:case 80:r(f)||it();break;case 27:r(f)?d():ut?it():nt(!0);break;case 32:!r(f)&&t&&(t.paused?y||t.resume():t.dropPiece());break;case 37:case 65:t&&t.movePieceLeft();break;case 38:case 75:case 87:t&&t.rotatePiece();break;case 39:case 68:t&&t.movePieceRight();break;case 40:case 83:t&&t.movePieceDown();break;case 66:nt(!y);break;case 71:rt((new Date).toLocaleString());break;case 113:lt()}};(function(){u.addEventListener("game.changed",tt);u.addEventListener("game.won",function(){rt(document.getElementById("wonMessage").value)});u.addEventListener("game.lost",function(){rt(document.getElementById("lostMessage").value)});u.addEventListener("game.paused",at);u.addEventListener("game.resumed",vt);e(ht,"newGame",lt);e(ht,"pauseGame",it);document.getElementById("messageBackdrop").addEventListener("click",function(){d()});w(f,"button",d);e(f,"newGame",function(){g()});e(document,"pause",function(){y||it()});bt&&function(){var i=document.createElement("div"),n=[2,5,3,1],r=n.reduce(function(n,t){return n+t},0),u,t;for(i.classList.add("touch-container"),u=function(n){var t=document.createElement("div");t.classList.add("touch");t.classList.add(n);i.appendChild(t)},t=0;t<5;t++)u("touch-"+(t+1));a([".touch-container { grid-template-rows: "+n.map(function(n){return n+"fr"}).join(" ")+" }",".touch-1 { grid-area: 1 / 1 / span 1 / span 2}",".touch-2 { grid-area: 2 / 1 / span 1 / span 1}",".touch-3 { grid-area: 2 / 2 / span 1 / span 1}",".touch-4 { grid-area: 3 / 1 / span 1 / span 2}",".touch-5 { grid-area: 4 / 1 / span 1 / span 2}"].join(" "));document.body.appendChild(i);document.addEventListener("touchstart",function(t){var u=document.body.clientWidth,i=document.body.clientHeight;Array.from(t.touches).forEach(function(t){t.clientY<=i*n[0]/r?p({which:38}):t.clientY>=i*(n[0]+n[1])/r?p({which:13}):t.clientY>=i*(n[0]+n[1]+n[2])/r?p({which:40}):t.clientX<=u/2?p({which:37}):p({which:39})})})}()})();document.addEventListener("keydown",p);(ft=function(){if(t){var i=(window.innerWidth-2*t.constants.padding)/t.board.width,r=(window.innerHeight-2*t.constants.padding)/t.board.height,n=1;u.clientHeight&&((i<1||r<1)&&(n=Math.min(i,r)),k.style["-ms-transform"]=k.style["-moz-transform"]=k.style["-o-transform"]=k.style["-webkit-transform"]=k.style.transform=n<1?"scale("+n+")":"")}})();window.addEventListener("resize",ft);window.addEventListener("blur",function(){ut?t&&t.pause():nt(!0)});document.addEventListener("visibilitychange",function(){document.hidden&&(ut?t&&t.pause():nt(!0))},!1);window.setInterval(et,100);document.addEventListener("DOMContentLoaded",function(){var n=b(v),u=parseInt(n&&n.baseLines)||parseInt(l().base)||0,f=document.getElementById("initial-lines"),t,r;[0,4,7,10,13].forEach(function(n){var i=document.createElement("label"),t=document.createElement("input");t.setAttribute("type","radio");t.setAttribute("name","initial-lines");t.value=n;n===u&&(t.checked=!0);i.appendChild(t);i.appendChild(document.createTextNode(n.toLocaleString()));f.appendChild(i)});t=l().bossColor||i.getAttribute("boss-color");typeof t!="undefined"&&a(".boss { background-color: "+t+" !important; }");r=h.createPreviews();Array.from(document.getElementsByClassName("piece-stats")).forEach(function(n){c(n);var t=document.createElement("table");t.classList.add("stat-table");r.forEach(function(n){ct(n.preview);n.preview.classList.add("preview");var i=document.createElement("tr"),r=document.createElement("td");i.classList.add("stat-row");i.dataset.type=n.name;r.appendChild(n.preview);i.appendChild(r);r=document.createElement("td");r.classList.add("stat-value");i.appendChild(r);t.appendChild(i)});n.appendChild(t)});g(n,!0)})}()})()