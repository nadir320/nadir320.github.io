"use strict";(function(){var a="tetris-game-state",r="session",p="tetris-style",s=Array.prototype.slice.call(window.document.getElementsByTagName("script")).pop();(function(){Array.prototype.findIndex||(Array.prototype.findIndex=function(n){for(var i=this,t=0,r=this.length;t<r;t++)if(n.call(i,this[t],t))return t;return-1});Array.from||(Array.from=function(n){for(var i=[],t=0,r=n.length;t<r;t++)i.push(n[t]);return i});var n=s.getAttribute("storage");n&&n.length&&(r=n);r+="Storage"})();var v=function(n,t){Array.from(typeof n.length!="undefined"?n:[n]).forEach(function(n){n.addEventListener("click",t)})},u=function(n,t,i){v(n.querySelectorAll("."+t),i)},w=function(n,t,i){v(n.getElementsByTagName(t),i)},h=function(n){Array.from(n.childNodes).forEach(function(n){n.parentElement.removeChild(n)})},tt=function(n){var t={};return Object.keys(n).forEach(function(i){t[i]=n[i]}),t},f=function(n){n.classList.add("hidden")},c=function(n){return!n.classList.contains("hidden")},t=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.max(t,i);return t},n=function(n){for(var t=undefined,i,r=0,u=n.length;r<u;r++)i=n[r],t=t===undefined?i:Math.min(t,i);return t},i=function(n){return Object.keys(l()).findIndex(function(t){return t.toLowerCase()===n.toLowerCase()})>=0},l=function(n){var t=(n=n||window.location.href).indexOf("?"),i={};return t>=0&&(n=n.substr(t+1),t=n.indexOf("#"),t>=0&&(n=n.substr(0,t)),n.split("&").forEach(function(n){var t=n.indexOf("="),r=n.substr(0,t),u=n.substr(t+1);i[r||u]=r?window.decodeURIComponent(u):undefined})),i},b=function(n){var t=k(n);if(t&&t.length)try{return window.JSON.parse(t)}catch(i){}},k=function(n){try{var t=window[r];if(t&&t.getItem)return t.getItem(n)}catch(i){}},y=function(n,t){var i;t&&(i=document.getElementById(t))?i.innerText=n:(i=document.createElement("style"),i.setAttribute("type","text/css"),t&&i.setAttribute("id",t),i.innerText=n,document.querySelector("head").appendChild(i))},e=function(n){n.classList.remove("hidden")},d=function(n,t){typeof t!="undefined"&&(t=window.JSON.stringify(t));g(n,t)},g=function(n,t){try{var i=window[r];i&&(typeof t!="undefined"?i.setItem&&i.setItem(n,t):i.removeItem&&i.removeItem(n))}catch(u){}},it=i("debug"),nt=i("cw"),o;(function(){var i={get baseMoveTime(){return 600},get boardHeight(){return 20},get boardWidth(){return 10},get levels(){return 25},get linesPerLevel(){return 10},get moveTimeStep(){return 50},get padding(){return 8},get randomTiles(){return 4},get tileHeight(){return 30},get tileWidth(){return 30}},r={I:{name:"I",basePosition:[[0,0],[0,1],[0,2],[0,3]],baseRotation:1},J:{name:"J",basePosition:[[0,0],[0,1],[0,2],[1,2]],baseRotation:3},L:{name:"L",basePosition:[[0,0],[0,1],[0,2],[1,0]],baseRotation:1},O:{name:"O",basePosition:[[0,0],[0,1],[1,0],[1,1]],baseRotation:0},S:{name:"S",basePosition:[[1,0],[1,1],[0,1],[0,2]],baseRotation:1},T:{name:"T",basePosition:[[0,0],[0,1],[0,2],[1,1]],baseRotation:0},Z:{name:"Z",basePosition:[[0,0],[0,1],[1,1],[1,2]],baseRotation:1}},f=function(){var n=Object.keys(r);return r[n[Math.floor(Math.random()*n.length)]]},e=function(n,t,i){var r;switch(n){case"I":switch(i){case 0:case 2:r=[[t[0][0]+2,t[0][1]+-2],[t[1][0]+1,t[1][1]+-1],[t[2][0]+0,t[2][1]+0],[t[3][0]+-1,t[3][1]+1],];break;case 1:case 3:r=[[t[0][0]+-2,t[0][1]+2],[t[1][0]+-1,t[1][1]+1],[t[2][0]+0,t[2][1]+0],[t[3][0]+1,t[3][1]+-1],]}break;case"J":switch(i){case 0:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+1],[t[3][0]+2,t[3][1]+0],];break;case 1:r=[[t[0][0]+-1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+0,t[3][1]+-2],];break;case 2:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+-1],[t[3][0]+-2,t[3][1]+-0],];break;case 3:r=[[t[0][0]+1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+0,t[3][1]+2],]}break;case"L":switch(i){case 0:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+1],[t[3][0]+0,t[3][1]+-2],];break;case 1:r=[[t[0][0]+-1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+-2,t[3][1]+0],];break;case 2:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+-1],[t[3][0]+0,t[3][1]+2],];break;case 3:r=[[t[0][0]+1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+2,t[3][1]+0],]}break;case"O":r=t;break;case"S":switch(i){case 0:case 2:r=[[t[0][0]+0,t[0][1]+-2],[t[1][0]+1,t[1][1]+-1],[t[2][0]+0,t[2][1]+0],[t[3][0]+1,t[3][1]+1],];break;case 1:case 3:r=[[t[0][0]+0,t[0][1]+2],[t[1][0]+-1,t[1][1]+1],[t[2][0]+0,t[2][1]+0],[t[3][0]+-1,t[3][1]+-1],]}break;case"T":switch(i){case 0:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+1],[t[3][0]+1,t[3][1]+-1],];break;case 1:r=[[t[0][0]+-1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+-1,t[3][1]+-1],];break;case 2:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+-1],[t[3][0]+-1,t[3][1]+1],];break;case 3:r=[[t[0][0]+1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+1,t[3][1]+1],]}break;case"Z":switch(i){case 0:case 2:r=[[t[0][0]+-1,t[0][1]+-1],[t[1][0]+0,t[1][1]+0],[t[2][0]+1,t[2][1]+-1],[t[3][0]+2,t[3][1]+0],];break;case 1:case 3:r=[[t[0][0]+1,t[0][1]+1],[t[1][0]+0,t[1][1]+0],[t[2][0]+-1,t[2][1]+1],[t[3][0]+-2,t[3][1]+0],]}}return r},u;Object.keys(r).forEach(function(n){r[n].rotate=function(t,i){return e(n,t,i)}});u=function(u){var a,h=0,c,o,l=function(n){return(n||o).map(function(n){return n[1]})},p=function(n){return(n||o).map(function(n){return n[0]})},y=function(n){var t=o.filter(function(n){return n[0]>=0}).map(function(t){return n.apply(this,t)});t.filter(function(n){return!n}).length&&(c=!0)},v=function(i,r,u){var f,o,s;if(i=i.slice(),u)for(f=0;f<u;f++)i=e(a,i,f+1);return o=l(i),s=Math.floor((r-t(o)-n(o)+1)/2)-1,s&&(i=i.map(function(n){return[n[0],n[1]+s]})),i},s;return u?u.tiles?(s=r[u.className],h=u.rotation,c=u.locked):(s=r[u],h=s.baseRotation):(s=f(),h=s.baseRotation),a=s.name,o=u&&u.tiles?u.tiles:v(s.basePosition,i.boardWidth,s.baseRotation),{className:a,createPreview:function(r){for(var f,u,o=v(s.basePosition,4,r?h:0),c=l(o),y=p(o),w=n(c),b=n(y),d=t(c)-w+1,g=t(y)-b+1,k=document.createElement("div"),e=0;e<g;e++)for(f=0;f<d;f++)o.filter(function(n){return n[0]===e+b&&n[1]===f+w}).length&&(u=document.createElement("div"),u.classList.add(a),u.style.gridColumn=f+1,u.style.gridRow=e+1,u.style.width=i.tileWidth+"px",u.style.height=i.tileHeight+"px",k.appendChild(u));return k},createPreviewImage:function(n,t){var u=document.createElement("canvas"),r,f;return u.setAttribute("width",i.tileWidth*4),u.setAttribute("height",i.tileHeight*4),r=u.getContext("2d"),r.fillStyle=n,r.strokeStyle=n,f=v(s.basePosition,4,t?h:0),f.forEach(function(n){var t=[n[1]*i.tileWidth,n[0]*i.tileHeight,i.tileWidth,i.tileHeight];r.fillRect.apply(r,t);r.strokeRect.apply(r,t)}),u.toDataURL()},drop:function(){var t=this,n;c||(n=t.getShadow(),n&&(o=n),y(this.findEmptyTiles))},getShadow:function(){var t=this,i=n(o.map(function(n){return t.findEmptyTiles.apply(t,n)}));if(i)return o.map(function(n){return[n[0]+i,n[1]]})},get locked(){return c},isTileVisible:function(n){return o[n][0]>=0},moveDown:function(){y(this.findEmptyTiles);c||(o=o.map(function(n){return[n[0]+1,n[1]]}))},moveLeft:function(){if(!c){var t=this,i=n(l());i>0&&o.filter(function(n){return!t.isTileEmpty(n[0],n[1]-1)}).length===0&&(o=o.map(function(n){return[n[0],n[1]-1]}))}},moveRight:function(){if(!c){var n=this,r=t(l());r<i.boardWidth-1&&o.filter(function(t){return!n.isTileEmpty(t[0],t[1]+1)}).length===0&&(o=o.map(function(n){return[n[0],n[1]+1]}))}},rotate:function(r){var f;if(!c)if(nt||r){var e=(h+1)%4,u=s.rotate(o,e),a=l(u),v=this;n(a)>=0&&t(a)<i.boardWidth&&u.filter(function(n){return n[0]>=0&&!v.isTileEmpty.apply(this,n)}).length===0&&(h=e,o=u)}else for(f=0;f<3;f++)this.rotate(!0)},get rotation(){return h},get tiles(){return o.slice()}}},function(){for(var r=[".level-container { background-color: whitesmoke; }"],n,t=1;t<=i.levels;t++)n=Math.min(Math.max(Math.floor(255-(t-1)/i.levels*255),0),255),r.push('.level-container[level="'+t+'"] { background-color: rgba('+n+", "+n+", "+n+"); }");y(r.join(" "),p)}();o=function(n,t,e,o){var g,ct=0,l,it,vt,lt,p,b,k,at=[],rt,y,ut={},v=t&&t.paused,c,ft=0,et,ot,nt=0,s,yt;Object.keys(r).forEach(function(n){var t=r[n];ut[t.name]=0});var st=function(n,t){return n+"°"+t},bt=function(){if(ft&&(ot||nt||(ot=!0),!et)){var n=Object.keys(c).map(function(n){return c[n]}).filter(function(n){return n.className}),t=n.filter(function(n){return n.baseTile});t.filter(function(n){for(var r,u,f,t=n.row+1;t<i.boardHeight;t++)if(w(t,n.column))return!0;for(u=w(n.row-1,n.column),f=!1,t=n.row-2;t>=0;t--)if(r=w(t,n.column),r!==u){if(f)return!0;u=r}return!1}).length===0&&n.filter(function(n){for(var t=n.row+1;t<i.boardHeight;t++)if(w(t,n.column))return!0;return!1}).length===0&&(et=!0)}},tt=function(){if(ht(),s&&s.locked){vt=it=Date.now();s.tiles.forEach(function(n,t){if(s.isTileVisible(t)){var i=kt.apply(this,n);i.className=s.className;i.locked=!0}});var u=Object.keys(c).map(n=>c[n]).reduce(function(n,t){return(n[t.row]||(n[t.row]=function(){var n=[];return n.row=t.row,n}())).push(t),n},[]),r=u.filter(function(n){return n.filter(function(n){return n.className}).length==i.boardWidth}).map(function(n){return n.row});r.length&&(function(){var t,n;for(at.push(r.length),r.sort(function(n,t){return t-n}),t=0,n=r[0];n>=0;n--){while(r.includes(n-t))t++;u[n].forEach(function(i){var r=n-t>=0?u[n-t].filter(function(n){return n.column===i.column}).pop():{};i.className=r.className;i.locked=r.locked;i.baseTile&&(i.baseTile=!1,nt--)})}bt()}(),Math.floor(k/i.linesPerLevel)!==Math.floor((k+r.length)/i.linesPerLevel)&&(p++,b=Math.max(i.moveTimeStep,b-i.moveTimeStep)),k+=r.length,ht());wt();n.dispatchEvent(new Event("game.changed"));l&&n.dispatchEvent(new Event("game.lost"))}d(a,l?undefined:{allTiles:Object.keys(c).reduce(function(n,t){var i=c[t];return n[t]={baseTile:i.baseTile,className:i.className,column:i.column,locked:i.locked,row:i.row},n},{}),baseCleared:et,baseRemoved:ot,baseLines:t&&t.lines||0,baseTiles:ft,elapsed:ct,level:p,lineHistory:at,lines:k,nextPiece:y.className,piece:s,pieceStats:ut,pieces:rt,remainingBaseTiles:nt,start:g})},pt=function(n,t){var r=Object.keys(c).map(function(n){return c[n]}).filter(function(i){return i.column==t&&!i.className&&i.row>n}).map(function(n){return n.row}),i;if(n<0)for(i=-1;i>n;i--)r.splice(0,0,i);for(r.sort(function(n,t){return n-t}),i=0;i<r.length;i++)if(r[i]!==n+i+1)return i;return r.length},kt=function(n,t){return c[st(n,t)]},wt=function(){var n=function(){var n=new u;return n.findEmptyTiles=pt,n.isTileEmpty=w,n};y||(y=n());s=y;ut[s.className]++;rt++;y=n();ht();y.tiles.filter(function(n){return!w.apply(this,n)}).length>0&&(l=Date.now(),ht())},w=function(n,t){return n<0||!kt(n,t).className},ht=function(){var n;Array.from(document.getElementsByClassName("level-container")).forEach(function(n){p>1?n.setAttribute("level",p):n.removeAttribute("level")});Object.keys(c).forEach(function(n){var i=c[n],t=i.tile.classList;t.remove("I");t.remove("J");t.remove("L");t.remove("O");t.remove("S");t.remove("T");t.remove("Z");t.remove("locked");t.remove("base-tile");t.remove("shadow");i.className&&t.add(i.className);i.locked&&t.add("locked");i.baseTile&&t.add("base-tile")});s&&(s.tiles.forEach(function(n,t){s.isTileVisible(t)&&c[st(n[0],n[1])].tile.classList.add(s.className)}),t&&t.shadow&&(n=s.getShadow())&&n.filter(function(n){return s.tiles.filter(function(t){return t[0]===n[0]&&t[1]===n[1]}).length===0}).forEach(function(n){c[st(n[0],n[1])].tile.classList.add("shadow")}))};return function(){var r,a;for(h(n),n.style.padding=i.padding+"px",n.style.width=i.tileWidth*i.boardWidth+2*i.padding+"px",n.style.height=i.tileHeight*i.boardHeight+2*i.padding+"px",r=document.createElement("div"),r.classList.add("level-container"),c={},function(){for(var u,n,t=0;t<i.boardHeight;t++)for(u=0;u<i.boardWidth;u++)n=document.createElement("div"),n.classList.add("tile"),n.classList.add("fade"),n.style.gridColumn=u+1,n.style.gridRow=t+1,n.style.width=i.tileWidth+"px",n.style.height=i.tileHeight+"px",r.appendChild(n),c[st(t,u)]={row:t,column:u,tile:n}}(),o&&o.start?(Object.keys(o.allTiles).map(function(n){return o.allTiles[n]}).forEach(function(n){var t=c[st(n.row,n.column)];t.baseTile=!!n.baseTile;n.className&&(t.className=n.className);t.locked=!!n.locked}),y=new u(o.nextPiece),y.findEmptyTiles=pt,y.isTileEmpty=w,s=new u(o.piece),s.findEmptyTiles=pt,s.isTileEmpty=w):t&&t.lines>0&&function(){for(var n,e,r,o=Math.min(t.lines,i.boardHeight-4),u=0;u<o;u++)for(n=Object.keys(c).map(function(n){return c[n]}).filter(function(n){return n.row===i.boardHeight-u-1}),e=0;e<i.randomTiles;e++)r=Math.floor(Math.random()*n.length),n[r].className=f().name,n[r].baseTile=!0,n.splice(r,1),ft++,nt++}(),n.appendChild(r),o&&o.start?(et=o.baseCleared,ot=o.baseRemoved,ft=o.baseTiles,ct=o.elapsed,p=o.level,at=o.lineHistory,k=o.lines,ut=o.pieceStats,rt=o.pieces,nt=o.remainingBaseTiles,g=o.start):(rt=k=0,p=1),b=i.baseMoveTime,a=1;a<p;a++)b=Math.max(i.moveTimeStep,b-i.moveTimeStep);ht();v||(g=Date.now(),wt());e&&e();yt=window.setInterval(function(){if(!l&&!v){g||(g=Date.now(),wt(),bt(),n.dispatchEvent(new Event("game.changed")));var t=Date.now();lt&&(ct+=t-lt);(!it||t-it>=b)&&(it&&s.moveDown(),it=t,tt());lt=t}},50)}(),{get baseCleared(){return et},get baseLines(){return ft/i.randomTiles},get baseRemoved(){return ot},board:{get width(){return i.boardWidth*i.tileWidth},get height(){return i.boardHeight*i.tileHeight}},get constants(){return i},dropPiece:function(){v||l||!s||(!vt||Date.now()-vt>=b/2)&&(s.drop(),tt())},get elapsed(){return ct},get end(){return l},getNextPiecePreview:function(n){if(y)return y.createPreview(n)},get level(){return p},get lineHistory(){return at},get lines(){return k},movePieceDown:function(){v||l||!s||(s.moveDown(),tt())},movePieceLeft:function(){v||l||!s||(s.moveLeft(),tt())},movePieceRight:function(){v||l||!s||(s.moveRight(),tt())},pause:function(){v||l||(v=!0,n.dispatchEvent(new Event("game.paused")))},get paused(){return v},get pieces(){return rt},get pieceStats(){return ut},get remainingBaseLines(){return nt/i.randomTiles},resume:function(){v&&!l&&(lt=Date.now(),v=!1,n.dispatchEvent(new Event("game.resumed")))},rotatePiece:function(){v||l||!s||(s.rotate(),tt())},get start(){return g},stop:function(){l=Date.now();window.clearInterval(yt);yt=undefined}}};o.createPreviews=function(){return Object.keys(r).map(function(n){var t=r[n];return{name:t.name,preview:new u(t.name).createPreview()}})}})(),function(){var vt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",yt=decodeURIComponent("%E3%85%A4"),r,et,rt=i("safe")||!!parseInt(s.getAttribute("safe")),ot,t=document.querySelector(".board"),v=document.getElementById("message"),p=document.querySelector(".scaler"),st=document.querySelector(".status");(function(){typeof ShadowRoot=="undefined"&&v.classList.add("compatible");i("animate")&&document.querySelector("body").classList.add("animate")})();var n,ut,ht=function(n){Array.from(n.getElementsByTagName("div")).forEach(function(n){n.parentElement&&n.classList.add("tile")})},ct=function(){c(v)?(k(),d()):n?(it(document.getElementById("askNewMessage").value),window.setTimeout(function(){document.querySelector("[name=initial-lines]:checked").focus()})):d()},g=function(t){if(Array.from(document.getElementsByClassName("boss")).forEach(function(n){(t?e:f)(n)}),r!==t){var i=document.querySelector("[rel='shortcut icon']");(r=t)?(n&&n.pause(),ot=document.title,document.title=yt,i&&(et=i.getAttribute("href"),i.setAttribute("href",vt))):(document.title=ot,i&&i.setAttribute("href",et))}},nt=function(){ft&&ft();Array.from(document.getElementsByClassName("level")).forEach(function(t){t.innerText=n?n.level:undefined});Array.from(document.getElementsByClassName("lines")).forEach(function(t){t.innerText=(n?n.lines:0).toLocaleString()});Array.from(document.getElementsByClassName("line-details")).forEach(function(t){var i="";n&&n.lines&&(i=n.lineHistory.reduce(function(n,t){return n[t]=(n[t]||0)+1,n},[]).map(function(n,t){return{index:t,value:n}}),i.sort(function(n,t){return t.index-n.index}),i=i.filter(function(n){return n.value}).map(function(n){return n.index+": "+n.value.toLocaleString()}).join(" - "));t.innerText=i});Array.from(document.getElementsByClassName("pieces")).forEach(function(t){t.innerText=n?n.pieces:undefined});Array.from(document.getElementsByClassName("base-lines-row")).forEach(function(t){t.classList[n&&n.baseLines?"remove":"add"]("removed")});n&&n.baseLines&&Array.from(document.getElementsByClassName("base-lines")).forEach(function(t){t.innerText=n?n.remainingBaseLines.toLocaleString()+"/"+n.baseLines.toLocaleString():undefined;t.classList[n&&n.baseCleared?"add":"remove"]("base-cleared");t.classList[n&&n.baseRemoved?"add":"remove"]("base-removed")});Array.from(document.getElementsByClassName("next-piece-row")).forEach(function(t){t.classList[n&&n.start?"remove":"add"]("removed")});Array.from(document.getElementsByClassName("next-piece")).forEach(function(t){var i=n?n.getNextPiecePreview(!0):undefined;typeof i=="string"?t.setAttribute("src",i):(h(t),i&&(ht(i),t.appendChild(i)))});var t;Array.from(document.getElementsByClassName("piece-stats-row")).forEach(function(t){t.classList[n&&n.start?"remove":"add"]("removed")});n&&(t=n.pieceStats,Array.from(document.getElementsByClassName("piece-stats")).forEach(function(n){Array.from(n.getElementsByClassName("stat-table")).forEach(function(n){var i=Array.from(n.getElementsByClassName("stat-row"));i.forEach(function(n){Array.from(n.getElementsByClassName("stat-value")).forEach(function(i){i.innerText=t[n.dataset.type]})});i.sort(function(n,i){return t[i.dataset.type]-t[n.dataset.type]});i.forEach(function(t){n.appendChild(t)})})}))},lt=function(){Array.from(document.getElementsByClassName("pause")).forEach(function(n){e(n)})},at=function(){Array.from(document.getElementsByClassName("pause")).forEach(function(n){f(n)})},k=function(){f(v);f(document.getElementById("messageBackdrop"));t.focus()},d=function(r,u){n&&(n.stop(),n=undefined,t.removeEventListener("game.changed",nt));var f=0;r||(f=parseInt(Array.from(document.querySelectorAll("[name=initial-lines]")).filter(function(n){return n.checked}).pop().value));n=new o(t,{lines:f||0,paused:u,shadow:!i("noShadow")},function(){t.addEventListener("game.changed",nt);u?lt():at();setTimeout(function(){ut();nt()})},r)},tt=function(){n&&(n.paused?r||n.resume():n.pause())},ft=function(){var t=0,i,r="";n&&n.start&&(t=n.elapsed);t=Math.floor(t/1e3);t>=3600&&(r=Math.floor(t/3600)+":",t%=3600);i=Math.floor(t/60);t%=60;r.length&&i<10&&(i="0"+i);r+=i+":";t<10&&(t="0"+t);Array.from(document.getElementsByClassName("time")).forEach(function(n){n.innerText=r+t})},it=function(t){r||(n&&n.pause(),document.getElementById("messageText").innerText=t,e(document.getElementById("messageBackdrop")),e(v))};(function(){t.addEventListener("game.changed",nt);t.addEventListener("game.won",function(){it(document.getElementById("wonMessage").value)});t.addEventListener("game.lost",function(){it(document.getElementById("lostMessage").value)});t.addEventListener("game.paused",lt);t.addEventListener("game.resumed",at);u(st,"newGame",ct);u(st,"pauseGame",tt);document.getElementById("messageBackdrop").addEventListener("click",function(){k()});w(v,"button",k);u(v,"newGame",function(){d()});u(document,"pause",function(){r||tt()})})();document.addEventListener("keydown",function(t){switch(t.which){case 13:c(v)?(k(),d()):n&&(n.paused?r||n.resume():n.dropPiece());break;case 19:case 80:tt();break;case 27:c(v)?k():rt?tt():g(!0);break;case 32:n&&(n.paused?r||n.resume():n.dropPiece());break;case 37:case 65:n&&n.movePieceLeft();break;case 38:case 75:case 87:n&&n.rotatePiece();break;case 39:case 68:n&&n.movePieceRight();break;case 40:case 83:n&&n.movePieceDown();break;case 66:g(!r);break;case 71:it((new Date).toLocaleString());break;case 113:ct()}});(ut=function(){if(n){var r=(window.innerWidth-2*n.constants.padding)/n.board.width,u=(window.innerHeight-2*n.constants.padding)/n.board.height,i=1;t.clientHeight&&((r<1||u<1)&&(i=Math.min(r,u)),p.style["-ms-transform"]=p.style["-moz-transform"]=p.style["-o-transform"]=p.style["-webkit-transform"]=p.style.transform=i<1?"scale("+i+")":"")}})();window.addEventListener("resize",ut);window.addEventListener("blur",function(){rt?n&&n.pause():g(!0)});document.addEventListener("visibilitychange",function(){document.hidden&&(rt?n&&n.pause():g(!0))},!1);window.setInterval(ft,100);document.addEventListener("DOMContentLoaded",function(){var n=b(a),r=parseInt(n&&n.baseLines)||parseInt(l().base)||0,u=document.getElementById("initial-lines"),t,i;[0,4,7,10,13].forEach(function(n){var i=document.createElement("label"),t=document.createElement("input");t.setAttribute("type","radio");t.setAttribute("name","initial-lines");t.value=n;n===r&&(t.checked=!0);i.appendChild(t);i.appendChild(document.createTextNode(n.toLocaleString()));u.appendChild(i)});t=l().bossColor||s.getAttribute("boss-color");typeof t!="undefined"&&y(".boss { background-color: "+t+" !important; }");i=o.createPreviews();Array.from(document.getElementsByClassName("piece-stats")).forEach(function(n){h(n);var t=document.createElement("table");t.classList.add("stat-table");i.forEach(function(n){ht(n.preview);n.preview.classList.add("preview");var i=document.createElement("tr"),r=document.createElement("td");i.classList.add("stat-row");i.dataset.type=n.name;r.appendChild(n.preview);i.appendChild(r);r=document.createElement("td");r.classList.add("stat-value");i.appendChild(r);t.appendChild(i)});n.appendChild(t)});d(n,!0)})}()})()